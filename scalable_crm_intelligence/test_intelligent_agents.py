#!/usr/bin/env python3
"""
Test Intelligent Agents with Brain Context
Tests the new intelligent agents with contextual reasoning and domain expertise
"""

import json
from datetime import datetime
from components.intelligent_agents.intelligent_executive_agent import IntelligentExecutiveAgent
from components.intelligent_agents.intelligent_investment_agent import IntelligentInvestmentAgent
from components.intelligent_agents.intelligent_gap_analysis_agent import IntelligentGapAnalysisAgent

# API keys
TAVILY_API_KEY = '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'
GEMINI_API_KEY = 'AIzaSyDmPm3J2yqzJD1nXvd_5-8i6TX6rygwZ0Y'

def test_intelligent_abbey_capital_analysis():
    """Test intelligent agents on Abbey Capital healthcare analysis"""
    
    print("üß† INTELLIGENT AGENTS TEST: Abbey Capital Healthcare Analysis")
    print("=" * 70)
    print()
    
    company = "Abbey Capital"
    focus_domain = "healthcare"
    
    print(f"üéØ TARGET: {company}")
    print(f"üî¨ DOMAIN: {focus_domain}")
    print(f"‚ùì QUESTION: Find decision makers, investments, and gaps")
    print()
    
    # Initialize intelligent agents
    print("ü§ñ Initializing Intelligent Agents with Brain Context...")
    
    executive_agent = IntelligentExecutiveAgent(TAVILY_API_KEY, GEMINI_API_KEY)
    investment_agent = IntelligentInvestmentAgent(TAVILY_API_KEY, GEMINI_API_KEY)
    gap_agent = IntelligentGapAnalysisAgent(TAVILY_API_KEY, GEMINI_API_KEY)
    
    print("‚úÖ Agents initialized with domain knowledge and pattern recognition")
    print()
    
    start_time = datetime.now()
    
    try:
        # Phase 1: Executive Intelligence
        print("üë• PHASE 1: INTELLIGENT EXECUTIVE ANALYSIS")
        print("-" * 50)
        
        executive_results = executive_agent.analyze_executive_intelligence(company, focus_domain)
        
        print(f"‚úÖ Executive Analysis Complete:")
        print(f"   ‚Ä¢ Executives Found: {executive_results['executives_found']}")
        print(f"   ‚Ä¢ Relevant Sources: {executive_results['relevant_sources']}/{executive_results['total_sources_searched']}")
        print(f"   ‚Ä¢ Confidence Score: {executive_results['confidence_score']:.2f}")
        print()
        
        if executive_results['executives']:
            print("üéØ TOP EXECUTIVES FOUND:")
            for i, exec_info in enumerate(executive_results['executives'][:3], 1):
                print(f"   {i}. {exec_info['name']} - {exec_info['title']}")
                print(f"      Domain Relevance: {exec_info['domain_relevance']:.2f}")
                print(f"      Confidence: {exec_info['confidence']:.2f}")
            print()
        
        print("üìä EXECUTIVE INTELLIGENCE SYNTHESIS:")
        print(executive_results['intelligence_synthesis'])
        print()
        
        # Phase 2: Investment Intelligence
        print("üí∞ PHASE 2: INTELLIGENT INVESTMENT ANALYSIS")
        print("-" * 50)
        
        investment_results = investment_agent.analyze_investment_intelligence(company, focus_domain)
        
        print(f"‚úÖ Investment Analysis Complete:")
        print(f"   ‚Ä¢ Investments Found: {investment_results['investments_found']}")
        print(f"   ‚Ä¢ Portfolio Companies: {len(investment_results['portfolio_companies'])}")
        print(f"   ‚Ä¢ Relevant Sources: {investment_results['relevant_sources']}/{investment_results['total_sources_searched']}")
        print(f"   ‚Ä¢ Confidence Score: {investment_results['confidence_score']:.2f}")
        print()
        
        if investment_results['investments']:
            print("üíé TOP INVESTMENTS FOUND:")
            for i, inv_info in enumerate(investment_results['investments'][:3], 1):
                print(f"   {i}. {inv_info['company']}: {inv_info['amount']}")
                print(f"      Domain Relevance: {inv_info['domain_relevance']:.2f}")
                print(f"      Confidence: {inv_info['confidence']:.2f}")
            print()
        
        if investment_results['portfolio_companies']:
            print("üè¢ TOP PORTFOLIO COMPANIES:")
            for i, comp_info in enumerate(investment_results['portfolio_companies'][:3], 1):
                print(f"   {i}. {comp_info['company']}")
                print(f"      Domain Relevance: {comp_info['domain_relevance']:.2f}")
            print()
        
        print("üìä INVESTMENT INTELLIGENCE SYNTHESIS:")
        print(investment_results['intelligence_synthesis'])
        print()
        
        # Phase 3: Gap Analysis Intelligence
        print("üéØ PHASE 3: INTELLIGENT GAP ANALYSIS")
        print("-" * 50)
        
        # Pass existing portfolio data to gap analysis
        existing_portfolio = investment_results['investments'] + investment_results['portfolio_companies']
        
        gap_results = gap_agent.analyze_gap_intelligence(
            company, 
            focus_domain, 
            existing_portfolio=existing_portfolio
        )
        
        print(f"‚úÖ Gap Analysis Complete:")
        print(f"   ‚Ä¢ Opportunities Found: {gap_results['opportunities_found']}")
        print(f"   ‚Ä¢ Market Insights: {len(gap_results['market_insights'])}")
        print(f"   ‚Ä¢ Relevant Sources: {gap_results['relevant_sources']}/{gap_results['total_sources_searched']}")
        print(f"   ‚Ä¢ Confidence Score: {gap_results['confidence_score']:.2f}")
        print()
        
        if gap_results['opportunities']:
            print("üöÄ TOP OPPORTUNITIES IDENTIFIED:")
            for i, opp_info in enumerate(gap_results['opportunities'][:3], 1):
                print(f"   {i}. {opp_info['opportunity'][:100]}...")
                print(f"      Domain Relevance: {opp_info['domain_relevance']:.2f}")
            print()
        
        print("üìä ADVANCED GAP ANALYSIS:")
        print(gap_results['advanced_gap_analysis'])
        print()
        
        processing_time = (datetime.now() - start_time).total_seconds()
        
        # Comprehensive Results Summary
        print("üéâ INTELLIGENT ANALYSIS COMPLETE!")
        print("=" * 70)
        print(f"‚è±Ô∏è Total Processing Time: {processing_time:.2f} seconds")
        print()
        
        print("üìà INTELLIGENCE SUMMARY:")
        print(f"   üë• Executives: {executive_results['executives_found']} found")
        print(f"   üí∞ Investments: {investment_results['investments_found']} found")
        print(f"   üè¢ Companies: {len(investment_results['portfolio_companies'])} found")
        print(f"   üéØ Opportunities: {gap_results['opportunities_found']} found")
        print(f"   üìä Total Relevant Sources: {executive_results['relevant_sources'] + investment_results['relevant_sources'] + gap_results['relevant_sources']}")
        print()
        
        print("üß† INTELLIGENCE QUALITY SCORES:")
        print(f"   üë• Executive Intelligence: {executive_results['confidence_score']:.2f}")
        print(f"   üí∞ Investment Intelligence: {investment_results['confidence_score']:.2f}")
        print(f"   üéØ Gap Analysis Intelligence: {gap_results['confidence_score']:.2f}")
        
        overall_confidence = (
            executive_results['confidence_score'] + 
            investment_results['confidence_score'] + 
            gap_results['confidence_score']
        ) / 3
        print(f"   üéØ Overall Intelligence Score: {overall_confidence:.2f}")
        print()
        
        # Save comprehensive results
        output_file = f"abbey_capital_INTELLIGENT_analysis_{datetime.now().strftime('%Y%m%d_%H%M%S')}.json"
        
        comprehensive_results = {
            "company": company,
            "focus_domain": focus_domain,
            "processing_time_seconds": processing_time,
            "overall_confidence": overall_confidence,
            "executive_intelligence": executive_results,
            "investment_intelligence": investment_results,
            "gap_analysis": gap_results,
            "summary": {
                "executives_found": executive_results['executives_found'],
                "investments_found": investment_results['investments_found'],
                "opportunities_found": gap_results['opportunities_found'],
                "total_relevant_sources": executive_results['relevant_sources'] + investment_results['relevant_sources'] + gap_results['relevant_sources']
            },
            "generated_at": datetime.now().isoformat(),
            "intelligence_method": "contextual_agents_with_brain"
        }
        
        with open(output_file, 'w') as f:
            json.dump(comprehensive_results, f, indent=2, default=str)
        
        print(f"üìÑ Complete intelligent analysis saved to: {output_file}")
        print()
        
        print("üÜö TRANSFORMATION COMPARISON:")
        print("=" * 70)
        print("‚ùå OLD GENERIC SYSTEM:")
        print("   ‚Ä¢ 0 executives found (failed pattern recognition)")
        print("   ‚Ä¢ 0 investments found (no domain context)")
        print("   ‚Ä¢ 0 opportunities found (no intelligence synthesis)")
        print("   ‚Ä¢ Sources: Wikipedia, dictionary definitions, irrelevant content")
        print()
        print("‚úÖ NEW INTELLIGENT SYSTEM:")
        print(f"   ‚Ä¢ {executive_results['executives_found']} executives with domain relevance scoring")
        print(f"   ‚Ä¢ {investment_results['investments_found']} investments with contextual extraction")
        print(f"   ‚Ä¢ {gap_results['opportunities_found']} opportunities with strategic analysis")
        print(f"   ‚Ä¢ Sources: {executive_results['relevant_sources'] + investment_results['relevant_sources'] + gap_results['relevant_sources']} relevant sources with quality filtering")
        print("   ‚Ä¢ Brain Context: Domain knowledge, pattern recognition, intelligent synthesis")
        print()
        
        print("üß† INTELLIGENCE CAPABILITIES DEMONSTRATED:")
        print("   ‚úÖ Domain-specific pattern recognition")
        print("   ‚úÖ Contextual relevance scoring")
        print("   ‚úÖ Intelligent query generation")
        print("   ‚úÖ Multi-agent coordination with synthesis")
        print("   ‚úÖ Strategic gap analysis with LLM reasoning")
        print("   ‚úÖ Quality-filtered source analysis")
        
        return comprehensive_results
        
    except Exception as e:
        print(f"‚ùå Intelligent agent test failed: {e}")
        import traceback
        traceback.print_exc()
        return None

def main():
    """Run intelligent agents test"""
    
    print("üß† INTELLIGENT AGENTS WITH BRAIN CONTEXT")
    print("Testing contextual reasoning and domain expertise")
    print()
    
    results = test_intelligent_abbey_capital_analysis()
    
    if results:
        print("\nüéâ INTELLIGENT AGENTS TEST SUCCESSFUL!")
        print("The system now has true intelligence with contextual reasoning!")
    else:
        print("\n‚ùå Test failed - check logs for details")

if __name__ == "__main__":
    main()
