import{f as _e}from"./DeleteLinkedDocModal-b8adefb7.js";import{_ as ge}from"./ErrorPage-fe62ccf4.js";import{u as ye,_ as be}from"./Icon-54448da3.js";import{_ as he}from"./Resizer-a921d7c8.js";import{A as Ce,a as ae,u as ke,_ as we,b as xe,c as Me,S as Ie}from"./useActiveTabManager-9471f0d7.js";import{E as Ee}from"./Popover-09d356d5.js";import{E as Ve}from"./Email2Icon-ce76423f.js";import{C as $e}from"./CommentIcon-b8ec896b.js";import{D as Le}from"./DetailsIcon-082634e5.js";import{P as te}from"./PhoneIcon-8dce20df.js";import{T as Re}from"./TaskIcon-aba200f0.js";import{N as De}from"./NoteModal-4a6b84b7.js";import{W as Se}from"./WhatsAppIcon-44819d92.js";import{I as Ae}from"./IndicatorIcon-bbfdee29.js";import{C as Te}from"./CameraIcon-a209cbc0.js";import{L as ze}from"./LinkIcon-8e0a4037.js";import{L as qe}from"./LayoutHeader-00b32210.js";import{g as Oe,S as Fe}from"./view-1b5968cf.js";import{_ as oe}from"./CustomActions-2d05dde4.js";import{O as Ue}from"./OrganizationsIcon-e5e2ad62.js";import{C as Ne}from"./ContactsIcon-0fb196bd.js";import{i as Be,E as je,w as Pe,c as We}from"./DragVerticalIcon-8e81a339.js";import{F as Ge}from"./FieldLayout-3d404faf.js";import{_ as le}from"./Link-9116521d.js";import{u as Z,c as Qe,q as He,_ as Ke}from"./modals-3696975e.js";import{u as Xe,b as Ye,s as Je,D as se,e as Ze,v as ea,a as aa,o as ta}from"./index-e1ee9b35.js";import{N as oa,O as la,a7 as ue,a0 as sa,l as h,y as q,X as de,e as W,f as u,g as c,w as p,d as r,t as E,u as t,B as v,b as n,c as O,W as na,a3 as ce,aa as ia,$ as ra,z as ne,a8 as ua,a9 as ie,F as da,a4 as z,n as ca,K as ma,a5 as va,Y as pa,G as fa}from"./index-6bb6ee33.js";import{s as me}from"./statuses-7ae9bb87.js";import{u as _a}from"./helpCenter-a5c12605.js";import{_ as re}from"./Switch.vue_vue_type_script_setup_true_lang-51b6b103.js";import{g as ga}from"./settings-af38891f.js";import{g as ya}from"./global-5f0b21a6.js";import{_ as ba}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-12300e91.js";import{F as ha}from"./FileUploader-ac077fdd.js";import"./CalendarIcon-caa30aa1.js";import"./CallLogModal-6b003caa.js";import"./ArrowUpRightIcon-942cbd47.js";import"./LeadsIcon-bdb177b7.js";import"./DealsIcon-c1675651.js";import"./TaskModal-8a00ae25.js";import"./FadedScrollableDiv-aeace433.js";import"./MultipleAvatar-b4ff0880.js";import"./IconPicker-265d68a5.js";import"./label-a438f940.js";const Ca={class:"mb-6 flex items-center justify-between"},ka={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},wa={class:"flex items-center gap-1"},xa={class:"mb-4 flex items-center gap-2 text-ink-gray-5"},Ma={class:"block text-base"},Ia={class:"ml-6 text-ink-gray-9"},Ea={class:"flex items-center justify-between text-base"},Va={key:1,class:"mt-2.5 text-base"},$a={class:"mb-4 mt-6 flex items-center gap-2 text-ink-gray-5"},La={class:"block text-base"},Ra={class:"ml-6 text-ink-gray-9"},Da={class:"flex items-center justify-between text-base"},Sa={key:1,class:"mt-2.5 text-base"},Aa={key:0,class:"h-px w-full border-t my-6"},Ta={class:"flex justify-end"},za={__name:"ConvertToDealModal",props:oa({lead:{type:Object,required:!0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(C){const F=C,V=la(C,"modelValue"),G=ue(),{statusOptions:Q,getDealStatus:H}=me(),{isManager:K}=Xe(),{user:X}=sa(),{updateOnboardingStep:$}=_a("frappecrm"),L=h(!1),w=h(!1),k=h(""),f=h(""),m=h(""),{triggerConvertToDeal:D}=Z("CRM Lead",F.lead.name),{document:_}=Z("CRM Deal");async function A(){if(m.value="",L.value&&!k.value){m.value=__("Please select an existing contact");return}if(w.value&&!f.value){m.value=__("Please select an existing organization");return}!L.value&&k.value&&(k.value=""),!w.value&&f.value&&(f.value=""),await(D==null?void 0:D(F.lead,_.doc,()=>V.value=!1));let o=await ce("crm.fcrm.doctype.crm_lead.crm_lead.convert_to_deal",{lead:F.lead.name,deal:_.doc,existing_contact:k.value,existing_organization:f.value}).catch(i=>{var x;if(i.exc_type=="MandatoryError"){const l=i.messages.map(g=>{let y=g.split(": ");return y[y.length-1].trim()}).join(", ");l.toLowerCase().includes("required")?m.value=__(l):m.value=__("{0} is required",[l]);return}m.value=__("Error converting to deal: {0}",[(x=i.messages)==null?void 0:x[0]])});o&&(V.value=!1,L.value=!1,w.value=!1,k.value="",f.value="",m.value="",$("convert_lead_to_deal",!0,!1,()=>{localStorage.setItem("firstDeal"+X,o)}),ia("convert_lead_to_deal"),G.push({name:"Deal",params:{dealId:o}}))}const U=q(()=>{var i;let o=Q("deal");return(i=_.doc)!=null&&i.status||(_.doc.status=o[0].value),o}),N=de({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["RequiredFields","CRM Deal"],params:{doctype:"CRM Deal",type:"Required Fields"},auto:!0,transform:o=>{let i=!1,x=o==null?void 0:o.forEach(l=>{var g;(g=l.sections)==null||g.forEach(y=>{var b;(b=y.columns)==null||b.forEach(T=>{var M;(M=T.fields)==null||M.forEach(R=>{i=!0,R.fieldname=="status"&&(R.fieldtype="Select",R.options=U.value,R.prefix=H(_.doc.status).color),R.fieldtype==="Table"&&(_.doc[R.fieldname]=[])})})})});return i?x:[]}});function B(){Qe.value=!0,He.value={doctype:"CRM Deal",onlyRequired:!0},V.value=!1}return(o,i)=>{const x=W("Button"),l=W("ErrorMessage");return u(),c(t(na),{modelValue:V.value,"onUpdate:modelValue":i[5]||(i[5]=g=>V.value=g),options:{size:"xl"}},{"body-header":p(()=>[r("div",Ca,[r("div",null,[r("h3",ka,E(o.__("Convert to Deal")),1)]),r("div",wa,[t(K)()&&!t(Be)?(u(),c(x,{key:0,variant:"ghost",tooltip:o.__("Edit deal's mandatory fields layout"),icon:je,onClick:B},null,8,["tooltip"])):v("",!0),n(x,{icon:"x",variant:"ghost",onClick:i[0]||(i[0]=g=>V.value=!1)})])])]),"body-content":p(()=>{var g,y;return[r("div",xa,[n(Ue,{class:"h-4 w-4"}),r("label",Ma,E(o.__("Organization")),1)]),r("div",Ia,[r("div",Ea,[r("div",null,E(o.__("Choose Existing")),1),n(t(re),{modelValue:w.value,"onUpdate:modelValue":i[1]||(i[1]=b=>w.value=b)},null,8,["modelValue"])]),w.value?(u(),c(le,{key:0,class:"form-control mt-2.5",size:"md",value:f.value,doctype:"CRM Organization",onChange:i[2]||(i[2]=b=>f.value=b)},null,8,["value"])):(u(),O("div",Va,E(o.__("New organization will be created based on the data in details section")),1))]),r("div",$a,[n(Ne,{class:"h-4 w-4"}),r("label",La,E(o.__("Contact")),1)]),r("div",Ra,[r("div",Da,[r("div",null,E(o.__("Choose Existing")),1),n(t(re),{modelValue:L.value,"onUpdate:modelValue":i[3]||(i[3]=b=>L.value=b)},null,8,["modelValue"])]),L.value?(u(),c(le,{key:0,class:"form-control mt-2.5",size:"md",value:k.value,doctype:"Contact",onChange:i[4]||(i[4]=b=>k.value=b)},null,8,["value"])):(u(),O("div",Sa,E(o.__("New contact will be created based on the person's details")),1))]),(g=t(N).data)!=null&&g.length?(u(),O("div",Aa)):v("",!0),(y=t(N).data)!=null&&y.length?(u(),c(Ge,{key:1,tabs:t(N).data,data:t(_).doc,doctype:"CRM Deal"},null,8,["tabs","data"])):v("",!0),n(l,{class:"mt-4",message:m.value},null,8,["message"])]}),actions:p(()=>[r("div",Ta,[n(x,{label:o.__("Convert"),variant:"solid",onClick:A},null,8,["label"])])]),_:1},8,["modelValue"])}}},qa={key:0,class:"flex h-full overflow-hidden"},Oa={class:"flex items-center justify-start gap-5 border-b p-5"},Fa={class:"group relative size-12"},Ua={class:"z-1 absolute bottom-0.5 left-0 right-0.5 flex h-9 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-3 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(12px 0 0 0)","clip-path":"inset(12px 0 0 0)"}},Na={class:"flex flex-col gap-2.5 truncate"},Ba={class:"truncate text-2xl font-medium text-ink-gray-9"},ja={class:"flex gap-1.5"},Pa={key:1,class:"flex flex-1 flex-col justify-between overflow-hidden"},Tt={__name:"Lead",props:{leadId:{type:String,required:!0}},setup(C){const{brand:F}=ga(),{$dialog:V,$socket:G,makeCall:Q}=ya(),{statusOptions:H,getLeadStatus:K}=me(),{doctypeMeta:X}=Ye("CRM Lead"),$=ra(),L=ue(),w=C,k=h(!1),f=h(null),m=h(""),D=h(""),_=h(!1),A=h(!1),U=h(!1),{triggerOnChange:N,assignees:B,document:o,scripts:i,error:x}=Z("CRM Lead",w.leadId),l=q(()=>o.doc||{});ne(x,e=>{var a;e?(m.value=__(e.exc_type=="DoesNotExistError"?"Document not found":"Error occurred"),D.value=__(((a=e.messages)==null?void 0:a[0])||"An error occurred")):(m.value="",D.value="")}),ne(()=>o.doc,async e=>{var a;if((a=i.data)!=null&&a.length){let d=await Je(i.data,{doc:e,$dialog:V,$socket:G,router:L,toast:z,updateField:P,createToast:z.create,deleteDoc:ee,call:ce});o._actions=d.actions||[],o._statuses=d.statuses||[]}},{once:!0});const g=q(()=>{let e=[{label:__("Leads"),route:{name:"Leads"}}];if($.query.view||$.query.viewType){let a=Oe($.query.view,$.query.viewType,"CRM Lead");a&&e.push({label:__(a.label),icon:a.icon,route:{name:"Leads",params:{viewType:$.query.viewType},query:{view:$.query.view}}})}return e.push({label:y.value,route:{name:"Lead",params:{leadId:w.leadId}}}),e}),y=q(()=>{var a,d;let e=((a=X["CRM Lead"])==null?void 0:a.title_field)||"name";return((d=l.value)==null?void 0:d[e])||w.leadId}),b=q(()=>{var a;let e=(a=o.statuses)!=null&&a.length?o.statuses:o._statuses||[];return H("lead",e,ve)});ye(()=>({title:y.value,icon:F.favicon}));const T=q(()=>[{name:"Activity",label:__("Activity"),icon:Ce},{name:"Emails",label:__("Emails"),icon:Ee},{name:"Comments",label:__("Comments"),icon:$e},{name:"Data",label:__("Data"),icon:Le},{name:"Calls",label:__("Calls"),icon:te},{name:"Tasks",label:__("Tasks"),icon:Re},{name:"Notes",label:__("Notes"),icon:De},{name:"Attachments",label:__("Attachments"),icon:ae},{name:"WhatsApp",label:__("WhatsApp"),icon:Se,condition:()=>Pe.value}].filter(a=>a.condition?a.condition():!0)),{tabIndex:M,changeTabTo:R}=ke(T,"lastLeadTab"),Y=de({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","CRM Lead"],params:{doctype:"CRM Lead"},auto:!0});async function ve(e){await N("status",e),o.save.submit()}function P(e,a){a=Array.isArray(e)?"":a;let d=Array.isArray(e)?{}:l.value[e];Array.isArray(e)?e.forEach(j=>l.value[j]=a):l.value[e]=a,o.save.submit(null,{onSuccess:()=>k.value=!0,onError:j=>{var s;Array.isArray(e)?e.forEach(I=>l.value[I]=d[I]):l.value[e]=d,z.error(((s=j.messages)==null?void 0:s[0])||__("Error updating field"))}})}function ee(){_.value=!0}function pe(){let e=T.value[M.value];["Emails","Comments","Activities"].includes(e.name)||f.value.changeTabTo("emails"),fa(()=>f.value.emailBox.show=!0)}function fe(e){o.save.submit(null,{onSuccess:()=>J(e)})}function J(e){e!=null&&e.hasOwnProperty("lead_owner")&&B.reload()}return(e,a)=>{const d=W("Button"),j=W("ErrorMessage");return u(),O(da,null,[n(qe,null,ua({"left-header":p(()=>[n(t(ba),{items:g.value},{prefix:p(({item:s})=>[s.icon?(u(),c(be,{key:0,icon:s.icon,class:"mr-2 h-4"},null,8,["icon"])):v("",!0)]),_:1},8,["items"])]),_:2},[m.value?void 0:{name:"right-header",fn:p(()=>{var s,I;return[(s=t(o)._actions)!=null&&s.length?(u(),c(oe,{key:0,actions:t(o)._actions},null,8,["actions"])):v("",!0),(I=t(o).actions)!=null&&I.length?(u(),c(oe,{key:1,actions:t(o).actions},null,8,["actions"])):v("",!0),n(xe,{modelValue:t(B).data,"onUpdate:modelValue":a[0]||(a[0]=S=>t(B).data=S),doctype:"CRM Lead",docname:C.leadId},null,8,["modelValue","docname"]),l.value&&t(o).statuses?(u(),c(t(se),{key:2,options:b.value,placement:"right"},{default:p(({open:S})=>[l.value.status?(u(),c(d,{key:0,label:l.value.status,iconRight:S?"chevron-up":"chevron-down"},{prefix:p(()=>[n(Ae,{class:ca(t(K)(l.value.status).color)},null,8,["class"])]),_:2},1032,["label","iconRight"])):v("",!0)]),_:1},8,["options"])):v("",!0),n(d,{label:e.__("Convert to Deal"),variant:"solid",onClick:a[1]||(a[1]=S=>A.value=!0)},null,8,["label"])]}),key:"0"}]),1024),l.value.name?(u(),O("div",qa,[n(t(Ke),{as:"div",modelValue:t(M),"onUpdate:modelValue":a[4]||(a[4]=s=>ie(M)?M.value=s:null),tabs:T.value},{"tab-panel":p(()=>[n(Me,{ref_key:"activities",ref:f,doctype:"CRM Lead",docname:C.leadId,tabs:T.value,reload:k.value,"onUpdate:reload":a[2]||(a[2]=s=>k.value=s),tabIndex:t(M),"onUpdate:tabIndex":a[3]||(a[3]=s=>ie(M)?M.value=s:null),onBeforeSave:fe,onAfterSave:J},null,8,["docname","tabs","reload","tabIndex"])]),_:1},8,["modelValue","tabs"]),n(he,{class:"flex flex-col justify-between border-l",side:"right"},{default:p(()=>[r("div",{class:"flex h-10.5 cursor-copy items-center border-b px-5 py-2.5 text-lg font-medium text-ink-gray-9",onClick:a[5]||(a[5]=s=>t(Ze)(C.leadId))},E(e.__(C.leadId)),1),n(t(ha),{onSuccess:a[7]||(a[7]=s=>P("image",s.file_url)),validateFile:t(ea)},{default:p(({openFileSelector:s,error:I})=>[r("div",Oa,[r("div",Fa,[n(t(aa),{size:"3xl",class:"size-12",label:y.value,image:l.value.image},null,8,["label","image"]),(u(),c(va(l.value.image?t(se):"div"),ma(l.value.image?{options:[{icon:"upload",label:l.value.image?e.__("Change image"):e.__("Upload image"),onClick:s},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>P("image","")}]}:{onClick:s},{class:"!absolute bottom-0 left-0 right-0"}),{default:p(()=>[r("div",Ua,[n(Te,{class:"size-4 cursor-pointer text-white"})])]),_:2},1040))]),r("div",Na,[n(t(pa),{text:l.value.lead_name||e.__("Set first name")},{default:p(()=>[r("div",Ba,E(y.value),1)]),_:1},8,["text"]),r("div",ja,[t(We)?(u(),c(d,{key:0,tooltip:e.__("Make a call"),icon:te,onClick:()=>l.value.mobile_no?t(Q)(l.value.mobile_no):t(z).error(e.__("No phone number set"))},null,8,["tooltip","onClick"])):v("",!0),n(d,{tooltip:e.__("Send an email"),icon:Ve,onClick:S=>l.value.email?pe():t(z).error(e.__("No email set"))},null,8,["tooltip","onClick"]),n(d,{tooltip:e.__("Go to website"),icon:ze,onClick:S=>l.value.website?t(ta)(l.value.website):t(z).error(e.__("No website set"))},null,8,["tooltip","onClick"]),n(d,{tooltip:e.__("Attach a file"),icon:ae,onClick:a[6]||(a[6]=S=>U.value=!0)},null,8,["tooltip"]),n(d,{tooltip:e.__("Delete"),variant:"subtle",theme:"red",icon:"trash-2",onClick:ee},null,8,["tooltip"])]),n(j,{message:e.__(I)},null,8,["message"])])])]),_:1},8,["validateFile"]),l.value.sla_status?(u(),c(Ie,{key:0,modelValue:l.value,"onUpdate:modelValue":a[8]||(a[8]=s=>l.value=s),onUpdateField:P},null,8,["modelValue"])):v("",!0),t(Y).data?(u(),O("div",Pa,[n(Fe,{sections:t(Y).data,doctype:"CRM Lead",docname:C.leadId,onReload:t(Y).reload,onAfterFieldChange:J},null,8,["sections","docname","onReload"])])):v("",!0)]),_:1})])):m.value?(u(),c(ge,{key:1,errorTitle:m.value,errorMessage:D.value},null,8,["errorTitle","errorMessage"])):v("",!0),A.value?(u(),c(za,{key:2,modelValue:A.value,"onUpdate:modelValue":a[9]||(a[9]=s=>A.value=s),lead:l.value},null,8,["modelValue","lead"])):v("",!0),n(we,{modelValue:U.value,"onUpdate:modelValue":a[10]||(a[10]=s=>U.value=s),doctype:"CRM Lead",docname:C.leadId,onAfter:a[11]||(a[11]=()=>{var s,I;(I=(s=f.value)==null?void 0:s.all_activities)==null||I.reload(),t(R)("attachments")})},null,8,["modelValue","docname"]),_.value?(u(),c(_e,{key:3,modelValue:_.value,"onUpdate:modelValue":a[12]||(a[12]=s=>_.value=s),doctype:"CRM Lead",docname:C.leadId,name:"Leads"},null,8,["modelValue","docname"])):v("",!0)],64)}}};export{Tt as default};
//# sourceMappingURL=Lead-02db6ec4.js.map
