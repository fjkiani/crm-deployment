import{f as de}from"./DeleteLinkedDocModal-917fe54b.js";import{_ as ue}from"./ErrorPage-cfe913ab.js";import{_ as _e}from"./Resizer-138a7577.js";import{u as pe,_ as fe}from"./Icon-f5b67c07.js";import{g as ge,S as ye}from"./view-2c80ca05.js";import{L as ve}from"./LayoutHeader-0269a4d0.js";import{P as be}from"./PhoneIcon-7100523f.js";import{C as he}from"./CameraIcon-49d46078.js";import{D as we}from"./DealsIcon-17e83972.js";import{_ as Ce}from"./DealsListView-fcf640af.js";import{u as ke,b as H,f as xe,t as De,a as K,D as ze,v as Se}from"./index-8953e7e5.js";import{u as Me,s as Ie,a as $e,_ as Pe}from"./modals-f82a09a6.js";import{g as Ve}from"./settings-23a6f018.js";import{g as Be}from"./global-648fce17.js";import{o as Re}from"./organizations-9ec66051.js";import{s as Te}from"./statuses-c7bfc148.js";import{c as X}from"./DragVerticalIcon-f3cf7bea.js";import{$ as qe,l as S,y as v,a2 as Fe,X as G,a3 as M,a4 as k,c as b,u as t,g as u,w as p,B as d,b as _,F as Le,e as V,f as r,d as c,a5 as B,K as Ne,t as h,a6 as J,n as Q}from"./index-907bf49f.js";import{_ as Ae}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-db9aa161.js";import{F as Ee}from"./FileUploader-9cf78d39.js";import"./FadedScrollableDiv-010f9d1d.js";import"./ArrowUpRightIcon-6dda4bf5.js";import"./Link-f0c71ee2.js";import"./ListBulkActions-df5201fe.js";import"./MultipleAvatar-dddd7e0f.js";import"./IndicatorIcon-fc4954df.js";import"./ListFooter-7c921a2b.js";import"./label-cee0c0db.js";const je={key:1,ref:"parentRef",class:"flex h-full"},Oe={class:"border-b"},Ue={class:"flex flex-col items-start justify-start gap-4 p-5"},He={class:"flex gap-4 items-center"},Ke={class:"group relative h-15.5 w-15.5"},Xe={class:"z-1 absolute bottom-0 left-0 right-0 flex h-14 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-5 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(22px 0 0 0)","clip-path":"inset(22px 0 0 0)"}},Ge={class:"flex flex-col gap-2 truncate text-ink-gray-9"},Je={class:"truncate text-2xl font-medium"},Qe={key:0},We={key:0,class:"flex items-center gap-1.5 text-base text-ink-gray-8"},Ye={class:""},Ze={class:"flex gap-1.5"},ea={key:0,class:"flex flex-1 flex-col justify-between overflow-hidden"},aa={key:1,class:"grid flex-1 place-items-center text-xl font-medium text-ink-gray-4"},ta={class:"flex flex-col items-center justify-center space-y-3"},Pa={__name:"Contact",props:{contactId:{type:String,required:!0}},setup(W){const{brand:Y}=Ve(),{makeCall:Z}=Be(),{getUser:R}=ke(),{getOrganization:T}=Re(),{getDealStatus:ee}=Te(),{doctypeMeta:ae}=H("Contact"),w=W,y=qe(),q=S(""),te=S(""),{document:a}=Me("Contact",w.contactId),oe=v(()=>{let e=[{label:__("Contacts"),route:{name:"Contacts"}}];if(y.query.view||y.query.viewType){let o=ge(y.query.view,y.query.viewType,"Contact");o&&e.push({label:__(o.label),icon:o.icon,route:{name:"Contacts",params:{viewType:y.query.viewType},query:{view:y.query.view}}})}return e.push({label:F.value,route:{name:"Contact",params:{contactId:w.contactId}}}),e}),F=v(()=>{var o,i;let e=((o=ae.Contact)==null?void 0:o.title_field)||"name";return((i=a.doc)==null?void 0:i[e])||w.contactId});pe(()=>({title:F.value,icon:Y.favicon}));const x=S(!1);async function ne(){x.value=!0}function L(e){a.doc.image=(e==null?void 0:e.file_url)||"",a.save.submit(null,{onSuccess:()=>{k.success(__("Contact image updated"))}})}const N=S(0),se=[{label:"Deals",icon:Fe(we,{class:"h-4 w-4"}),count:v(()=>{var e;return(e=D.data)==null?void 0:e.length})}],D=G({url:"crm.api.contact.get_linked_deals",cache:["deals",w.contactId],params:{contact:w.contactId},auto:!0}),I=v(()=>!D.data||D.data==[]?[]:D.data.map(e=>ce(e))),$=G({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","Contact"],params:{doctype:"Contact"},auto:!0,transform:e=>v(()=>le(e))});function le(e){return e.map(o=>(o.columns=o.columns.map(i=>(i.fields=i.fields.map(m=>{var C,z,s,f;return m.fieldname==="email_id"?{...m,read_only:!1,fieldtype:"Dropdown",options:((z=(C=a.doc)==null?void 0:C.email_ids)==null?void 0:z.map(l=>({name:l.name,value:l.email_id,selected:l.email_id===a.doc.email_id,placeholder:"john@doe.com",onClick:()=>{A("email",l.email_id)},onSave:(n,g)=>{g?E("email",n.value):j("Contact Email",n.name,"email_id",n.value)},onDelete:async(n,g)=>{a.doc.email_ids=a.doc.email_ids.filter(P=>P.name!==n.name),!g&&await O("Contact Email",n.name)}})))||[],create:()=>{var l,n;(n=(l=a.doc)==null?void 0:l.email_ids)==null||n.push({name:"new-1",value:"",selected:!1,isNew:!0})}}:m.fieldname==="mobile_no"?{...m,read_only:!1,fieldtype:"Dropdown",options:((f=(s=a.doc)==null?void 0:s.phone_nos)==null?void 0:f.map(l=>({name:l.name,value:l.phone,selected:l.phone===a.doc.mobile_no,onClick:()=>{A("mobile_no",l.phone)},onSave:(n,g)=>{g?E("phone",n.value):j("Contact Phone",n.name,"phone",n.value)},onDelete:async(n,g)=>{a.doc.phone_nos=a.doc.phone_nos.filter(P=>P.name!==n.name),!g&&await O("Contact Phone",n.name)}})))||[],create:()=>{var l,n;(n=(l=a.doc)==null?void 0:l.phone_nos)==null||n.push({name:"new-1",value:"",selected:!1,isNew:!0})}}:m.fieldname==="address"?{...m,create:(l,n)=>{U(),n()},edit:l=>U(l)}:m}),i)),o))}async function A(e,o){await M("crm.api.contact.set_as_primary",{contact:a.doc.name,field:e,value:o})&&(a.reload(),k.success(__("Contact updated")))}async function E(e,o){if(!o)return;await M("crm.api.contact.create_new",{contact:a.doc.name,field:e,value:o})&&(a.reload(),k.success(__("Contact updated")))}async function j(e,o,i,m){await M("frappe.client.set_value",{doctype:e,name:o,fieldname:i,value:m})&&(a.reload(),k.success(__("Contact updated")))}async function O(e,o){await M("frappe.client.delete",{doctype:e,name:o}),await a.reload(),k.success(__("Contact updated"))}const{getFormattedCurrency:re}=H("CRM Deal"),ie=v(()=>me);function ce(e){var o,i;return{name:e.name,organization:{label:e.organization,logo:(o=T(e.organization))==null?void 0:o.organization_logo},annual_revenue:re("annual_revenue",e),status:{label:e.status,color:(i=ee(e.status))==null?void 0:i.color},email:e.email,mobile_no:e.mobile_no,deal_owner:{label:e.deal_owner&&R(e.deal_owner).full_name,...e.deal_owner&&R(e.deal_owner)},modified:{label:xe(e.modified),timeAgo:__(De(e.modified))}}}const me=[{label:__("Organization"),key:"organization",width:"11rem"},{label:__("Amount"),key:"annual_revenue",align:"right",width:"9rem"},{label:__("Status"),key:"status",width:"10rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Mobile no"),key:"mobile_no",width:"11rem"},{label:__("Deal owner"),key:"deal_owner",width:"10rem"},{label:__("Last modified"),key:"modified",width:"8rem"}];function U(e){Ie.value=!0,$e.value={doctype:"Address",address:e}}return(e,o)=>{const i=V("ErrorMessage"),m=V("Button"),C=V("Badge"),z=de;return r(),b(Le,null,[t(a).doc?(r(),u(ve,{key:0},{"left-header":p(()=>[_(t(Ae),{items:oe.value},{prefix:p(({item:s})=>[s.icon?(r(),u(fe,{key:0,icon:s.icon,class:"mr-2 h-4"},null,8,["icon"])):d("",!0)]),_:1},8,["items"])]),_:1})):d("",!0),t(a).doc?(r(),b("div",je,[t(a).doc?(r(),u(_e,{key:0,parent:e.$refs.parentRef,class:"flex h-full flex-col overflow-hidden border-r"},{default:p(()=>[c("div",Oe,[_(t(Ee),{onSuccess:L,validateFile:t(Se)},{default:p(({openFileSelector:s,error:f})=>{var l;return[c("div",Ue,[c("div",He,[c("div",Ke,[_(t(K),{size:"3xl",class:"h-15.5 w-15.5",label:t(a).doc.full_name,image:t(a).doc.image},null,8,["label","image"]),(r(),u(B(t(a).doc.image?t(ze):"div"),Ne(t(a).doc.image?{options:[{icon:"upload",label:t(a).doc.image?e.__("Change image"):e.__("Upload image"),onClick:s},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>L("")}]}:{onClick:s},{class:"!absolute bottom-0 left-0 right-0"}),{default:p(()=>[c("div",Xe,[_(he,{class:"h-6 w-6 cursor-pointer text-white"})])]),_:2},1040))]),c("div",Ge,[c("div",Je,[t(a).doc.salutation?(r(),b("span",Qe,h(t(a).doc.salutation+". "),1)):d("",!0),c("span",null,h(t(a).doc.full_name),1)]),t(a).doc.company_name?(r(),b("div",We,[_(t(K),{size:"xs",label:t(a).doc.company_name,image:(l=t(T)(t(a).doc.company_name))==null?void 0:l.organization_logo},null,8,["label","image"]),c("span",Ye,h(t(a).doc.company_name),1)])):d("",!0),_(i,{message:e.__(f)},null,8,["message"])])]),c("div",Ze,[t(X)&&t(a).doc.mobile_no?(r(),u(m,{key:0,label:e.__("Make Call"),size:"sm",iconLeft:be,onClick:o[0]||(o[0]=n=>t(X)&&t(Z)(t(a).doc.mobile_no))},null,8,["label"])):d("",!0),_(m,{label:e.__("Delete"),theme:"red",size:"sm",iconLeft:"trash-2",onClick:o[1]||(o[1]=n=>ne())},null,8,["label"])])])]}),_:1},8,["validateFile"])]),t($).data?(r(),b("div",ea,[_(ye,{sections:t($).data,doctype:"Contact",docname:t(a).doc.name,onReload:t($).reload},null,8,["sections","docname","onReload"])])):d("",!0)]),_:1},8,["parent"])):d("",!0),_(t(Pe),{as:"div",modelValue:N.value,"onUpdate:modelValue":o[2]||(o[2]=s=>N.value=s),tabs:se},{"tab-item":p(({tab:s,selected:f})=>[c("button",{class:Q(["group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-ink-gray-5 duration-300 ease-in-out hover:border-outline-gray-3 hover:text-ink-gray-9",{"text-ink-gray-9":f}])},[s.icon?(r(),u(B(s.icon),{key:0,class:"h-5"})):d("",!0),J(" "+h(e.__(s.label))+" ",1),_(C,{class:Q(["group-hover:bg-surface-gray-7",[f?"bg-surface-gray-7":"bg-gray-600"]]),variant:"solid",theme:"gray",size:"sm"},{default:p(()=>[J(h(s.count),1)]),_:2},1032,["class"])],2)]),"tab-panel":p(({tab:s})=>[s.label==="Deals"&&I.value.length?(r(),u(Ce,{key:0,class:"mt-4",rows:I.value,columns:ie.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):d("",!0),I.value.length?d("",!0):(r(),b("div",aa,[c("div",ta,[(r(),u(B(s.icon),{class:"!h-10 !w-10"})),c("div",null,h(e.__("No {0} Found",[e.__(s.label)])),1)])]))]),_:1},8,["modelValue"])],512)):q.value?(r(),u(ue,{key:2,errorTitle:q.value,errorMessage:te.value},null,8,["errorTitle","errorMessage"])):d("",!0),x.value?(r(),u(z,{key:3,modelValue:x.value,"onUpdate:modelValue":o[3]||(o[3]=s=>x.value=s),doctype:"Contact",docname:t(a).doc.name,name:"Contacts"},null,8,["modelValue","docname"])):d("",!0)],64)}}};export{Pa as default};
//# sourceMappingURL=Contact-65128319.js.map
