{"version":3,"file":"Imports-3998f80d.js","sources":["../../../../frontend/src/pages/Imports.vue"],"sourcesContent":["<template>\n  <div class=\"p-4 h-full overflow-auto\">\n    <LayoutHeader>\n      <template #left-header>\n        <ViewBreadcrumbs routeName=\"Imports\" />\n      </template>\n    </LayoutHeader>\n\n    <div class=\"max-w-4xl space-y-4\">\n      <div class=\"text-lg font-medium\">CSV Preview</div>\n      <Textarea v-model=\"csvText\" rows=\"8\" placeholder=\"Paste CSV here or provide a URL below\" />\n      <div class=\"grid grid-cols-1 sm:grid-cols-3 gap-2\">\n        <Input v-model=\"fileUrl\" placeholder=\"CSV URL (optional)\" />\n        <Input v-model=\"delimiter\" placeholder=\", (delimiter optional)\" />\n        <Button :loading=\"previewRes.loading\" label=\"Preview\" @click=\"onPreview\" />\n      </div>\n\n      <div v-if=\"previewRes.data\" class=\"rounded border p-3 bg-surface-white\">\n        <div class=\"text-base font-medium mb-2\">Headers</div>\n        <div class=\"text-sm mb-3\">{{ previewRes.data.headers?.join(', ') }}</div>\n\n        <div class=\"text-base font-medium mb-2\">Sample</div>\n        <div class=\"overflow-auto\">\n          <table class=\"min-w-full text-xs\">\n            <thead>\n              <tr>\n                <th v-for=\"(h, i) in previewRes.data.headers\" :key=\"'h'+i\" class=\"px-2 py-1 text-left border-b\">{{ h }}</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr v-for=\"(row, r) in previewRes.data.sample\" :key=\"'r'+r\">\n                <td v-for=\"(cell, c) in row\" :key=\"'c'+c\" class=\"px-2 py-1 border-b\">{{ cell }}</td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      <div class=\"text-lg font-medium mt-6\">Create Import Job</div>\n      <div class=\"grid grid-cols-1 sm:grid-cols-2 gap-2\">\n        <Select :options=\"[{label:'CSV', value:'CSV'},{label:'Google Sheets', value:'GOOGLE_SHEETS'}]\" v-model=\"sourceType\" />\n        <Input v-if=\"sourceType==='GOOGLE_SHEETS'\" v-model=\"sheetId\" placeholder=\"Google Sheet ID\" />\n        <Input v-if=\"sourceType==='GOOGLE_SHEETS'\" v-model=\"sheetRange\" placeholder=\"Range (e.g. Sheet1!A:Z)\" />\n      </div>\n      <div class=\"grid grid-cols-1 sm:grid-cols-3 gap-2\">\n        <Input v-model=\"mappingProfile\" placeholder=\"Mapping Profile (optional)\" />\n        <Select :options=\"[{label:'Dry Run: Off', value:false},{label:'Dry Run: On', value:true}]\" v-model=\"dryRun\" />\n        <Select :options=\"[{label:'Scheduled: Off', value:false},{label:'Scheduled: On', value:true}]\" v-model=\"scheduled\" />\n      </div>\n      <div class=\"grid grid-cols-1 sm:grid-cols-3 gap-2\">\n        <Button variant=\"solid\" :loading=\"importRes.loading\" label=\"Create Job\" @click=\"onImport\" />\n        <div v-if=\"importRes.data\" class=\"text-sm\">Job: {{ importRes.data.job_id }}</div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport LayoutHeader from '@/components/LayoutHeader.vue'\nimport ViewBreadcrumbs from '@/components/ViewBreadcrumbs.vue'\nimport { Button, Textarea, Input, Select, createResource } from 'frappe-ui'\nimport { ref } from 'vue'\n\nconst csvText = ref('')\nconst fileUrl = ref('')\nconst delimiter = ref('')\nconst sourceType = ref('CSV')\nconst sheetId = ref('')\nconst sheetRange = ref('')\nconst mappingProfile = ref('')\nconst dryRun = ref(false)\nconst scheduled = ref(false)\n\nconst previewRes = createResource({\n  url: 'crm.api.etl.preview',\n  onError: (e) => console.error(e),\n})\n\nconst importRes = createResource({\n  url: 'crm.api.etl.import_rows',\n  method: 'POST',\n  onError: (e) => console.error(e),\n})\n\nfunction onPreview() {\n  previewRes.submit({\n    file_url: fileUrl.value || null,\n    filedata: fileUrl.value ? null : csvText.value,\n    delimiter: delimiter.value || null,\n    max_rows: 50,\n  })\n}\n\nfunction onImport() {\n  const payload = {\n    source_type: sourceType.value,\n    file_url: sourceType.value === 'CSV' ? (fileUrl.value || null) : null,\n    sheet_id: sourceType.value === 'GOOGLE_SHEETS' ? (sheetId.value || null) : null,\n    sheet_range: sourceType.value === 'GOOGLE_SHEETS' ? (sheetRange.value || null) : null,\n    dedupe: true,\n    link_organization: true,\n    mapping_profile: mappingProfile.value || null,\n    dry_run: !!dryRun.value,\n    scheduled: !!scheduled.value,\n  }\n  importRes.submit({ payload: JSON.stringify(payload) })\n}\n</script>\n\n\n"],"names":["csvText","ref","fileUrl","delimiter","sourceType","sheetId","sheetRange","mappingProfile","dryRun","scheduled","previewRes","createResource","e","importRes","onPreview","onImport","payload"],"mappings":"uwBA+DA,MAAMA,EAAUC,EAAI,EAAE,EAChBC,EAAUD,EAAI,EAAE,EAChBE,EAAYF,EAAI,EAAE,EAClBG,EAAaH,EAAI,KAAK,EACtBI,EAAUJ,EAAI,EAAE,EAChBK,EAAaL,EAAI,EAAE,EACnBM,EAAiBN,EAAI,EAAE,EACvBO,EAASP,EAAI,EAAK,EAClBQ,EAAYR,EAAI,EAAK,EAErBS,EAAaC,EAAe,CAChC,IAAK,sBACL,QAAUC,GAAM,QAAQ,MAAMA,CAAC,CACjC,CAAC,EAEKC,EAAYF,EAAe,CAC/B,IAAK,0BACL,OAAQ,OACR,QAAUC,GAAM,QAAQ,MAAMA,CAAC,CACjC,CAAC,EAED,SAASE,GAAY,CACnBJ,EAAW,OAAO,CAChB,SAAUR,EAAQ,OAAS,KAC3B,SAAUA,EAAQ,MAAQ,KAAOF,EAAQ,MACzC,UAAWG,EAAU,OAAS,KAC9B,SAAU,EACd,CAAG,CACH,CAEA,SAASY,GAAW,CAClB,MAAMC,EAAU,CACd,YAAaZ,EAAW,MACxB,SAAUA,EAAW,QAAU,OAASF,EAAQ,OAAS,KACzD,SAAUE,EAAW,QAAU,iBAAmBC,EAAQ,OAAS,KACnE,YAAaD,EAAW,QAAU,iBAAmBE,EAAW,OAAS,KACzE,OAAQ,GACR,kBAAmB,GACnB,gBAAiBC,EAAe,OAAS,KACzC,QAAS,CAAC,CAACC,EAAO,MAClB,UAAW,CAAC,CAACC,EAAU,KACzB,EACAI,EAAU,OAAO,CAAE,QAAS,KAAK,UAAUG,CAAO,EAAG,CACvD"}