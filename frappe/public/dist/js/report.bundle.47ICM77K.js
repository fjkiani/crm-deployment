(()=>{var cr=Object.create;var ji=Object.defineProperty;var pr=Object.getOwnPropertyDescriptor;var ur=Object.getOwnPropertyNames;var _r=Object.getPrototypeOf,fr=Object.prototype.hasOwnProperty;var Fi=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var gr=(n,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of ur(e))!fr.call(n,r)&&r!==t&&ji(n,r,{get:()=>e[r],enumerable:!(i=pr(e,r))||i.enumerable});return n};var Pi=(n,e,t)=>(t=n!=null?cr(_r(n)):{},gr(e||!n||!n.__esModule?ji(t,"default",{value:n,enumerable:!0}):t,n));var Wi=Fi((ni,ai)=>{(function(n,e){typeof ni=="object"&&typeof ai!="undefined"?ai.exports=e():typeof define=="function"&&define.amd?define(e):(n=n||self).Sortable=e()})(ni,function(){"use strict";function n(o,a){var l,p=Object.keys(o);return Object.getOwnPropertySymbols&&(l=Object.getOwnPropertySymbols(o),a&&(l=l.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),p.push.apply(p,l)),p}function e(o){for(var a=1;a<arguments.length;a++){var l=arguments[a]!=null?arguments[a]:{};a%2?n(Object(l),!0).forEach(function(p){var c,_;c=o,p=l[_=p],_ in c?Object.defineProperty(c,_,{value:p,enumerable:!0,configurable:!0,writable:!0}):c[_]=p}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):n(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}function t(o){return(t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(o)}function i(){return(i=Object.assign||function(o){for(var a=1;a<arguments.length;a++){var l,p=arguments[a];for(l in p)Object.prototype.hasOwnProperty.call(p,l)&&(o[l]=p[l])}return o}).apply(this,arguments)}function r(o,a){if(o==null)return{};var l,p=function(g,v){if(g==null)return{};for(var S,k={},I=Object.keys(g),j=0;j<I.length;j++)S=I[j],0<=v.indexOf(S)||(k[S]=g[S]);return k}(o,a);if(Object.getOwnPropertySymbols)for(var c=Object.getOwnPropertySymbols(o),_=0;_<c.length;_++)l=c[_],0<=a.indexOf(l)||Object.prototype.propertyIsEnumerable.call(o,l)&&(p[l]=o[l]);return p}function s(o){return function(a){if(Array.isArray(a))return d(a)}(o)||function(a){if(typeof Symbol!="undefined"&&a[Symbol.iterator]!=null||a["@@iterator"]!=null)return Array.from(a)}(o)||function(a,l){if(a){if(typeof a=="string")return d(a,l);var p=Object.prototype.toString.call(a).slice(8,-1);return(p=p==="Object"&&a.constructor?a.constructor.name:p)==="Map"||p==="Set"?Array.from(a):p==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p)?d(a,l):void 0}}(o)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function d(o,a){(a==null||a>o.length)&&(a=o.length);for(var l=0,p=new Array(a);l<a;l++)p[l]=o[l];return p}function h(o){if(typeof window!="undefined"&&window.navigator)return!!navigator.userAgent.match(o)}var u=h(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),y=h(/Edge/i),m=h(/firefox/i),b=h(/safari/i)&&!h(/chrome/i)&&!h(/android/i),R=h(/iP(ad|od|hone)/i),st=h(/chrome/i)&&h(/android/i),x={capture:!1,passive:!1};function C(o,a,l){o.addEventListener(a,l,!u&&x)}function w(o,a,l){o.removeEventListener(a,l,!u&&x)}function O(o,a){if(a&&(a[0]===">"&&(a=a.substring(1)),o))try{if(o.matches)return o.matches(a);if(o.msMatchesSelector)return o.msMatchesSelector(a);if(o.webkitMatchesSelector)return o.webkitMatchesSelector(a)}catch(l){return}}function D(o,a,l,p){if(o){l=l||document;do if(a!=null&&(a[0]!==">"||o.parentNode===l)&&O(o,a)||p&&o===l)return o;while(o!==l&&(o=(c=o).host&&c!==document&&c.host.nodeType?c.host:c.parentNode))}var c;return null}var B,Y=/\s+/g;function P(o,a,l){var p;o&&a&&(o.classList?o.classList[l?"add":"remove"](a):(p=(" "+o.className+" ").replace(Y," ").replace(" "+a+" "," "),o.className=(p+(l?" "+a:"")).replace(Y," ")))}function E(o,a,l){var p=o&&o.style;if(p){if(l===void 0)return document.defaultView&&document.defaultView.getComputedStyle?l=document.defaultView.getComputedStyle(o,""):o.currentStyle&&(l=o.currentStyle),a===void 0?l:l[a];p[a=a in p||a.indexOf("webkit")!==-1?a:"-webkit-"+a]=l+(typeof l=="string"?"":"px")}}function N(o,a){var l="";if(typeof o=="string")l=o;else do var p=E(o,"transform");while(p&&p!=="none"&&(l=p+" "+l),!a&&(o=o.parentNode));var c=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return c&&new c(l)}function ne(o,a,l){if(o){var p=o.getElementsByTagName(a),c=0,_=p.length;if(l)for(;c<_;c++)l(p[c],c);return p}return[]}function oe(){var o=document.scrollingElement;return o||document.documentElement}function W(o,a,l,p,c){if(o.getBoundingClientRect||o===window){var _,g,v,S,k,I,j=o!==window&&o.parentNode&&o!==oe()?(g=(_=o.getBoundingClientRect()).top,v=_.left,S=_.bottom,k=_.right,I=_.height,_.width):(v=g=0,S=window.innerHeight,k=window.innerWidth,I=window.innerHeight,window.innerWidth);if((a||l)&&o!==window&&(c=c||o.parentNode,!u))do if(c&&c.getBoundingClientRect&&(E(c,"transform")!=="none"||l&&E(c,"position")!=="static")){var q=c.getBoundingClientRect();g-=q.top+parseInt(E(c,"border-top-width")),v-=q.left+parseInt(E(c,"border-left-width")),S=g+_.height,k=v+_.width;break}while(c=c.parentNode);return p&&o!==window&&(p=(a=N(c||o))&&a.a,o=a&&a.d,a&&(S=(g/=o)+(I/=o),k=(v/=p)+(j/=p))),{top:g,left:v,bottom:S,right:k,width:j,height:I}}}function Ae(o,a,l){for(var p=Te(o,!0),c=W(o)[a];p;){var _=W(p)[l];if(!(l==="top"||l==="left"?_<=c:c<=_))return p;if(p===oe())break;p=Te(p,!1)}return!1}function Fe(o,a,l,p){for(var c=0,_=0,g=o.children;_<g.length;){if(g[_].style.display!=="none"&&g[_]!==A.ghost&&(p||g[_]!==A.dragged)&&D(g[_],l.draggable,o,!1)){if(c===a)return g[_];c++}_++}return null}function Pt(o,a){for(var l=o.lastElementChild;l&&(l===A.ghost||E(l,"display")==="none"||a&&!O(l,a));)l=l.previousElementSibling;return l||null}function J(o,a){var l=0;if(!o||!o.parentNode)return-1;for(;o=o.previousElementSibling;)o.nodeName.toUpperCase()==="TEMPLATE"||o===A.clone||a&&!O(o,a)||l++;return l}function xi(o){var a=0,l=0,p=oe();if(o)do var _=N(o),c=_.a,_=_.d;while(a+=o.scrollLeft*c,l+=o.scrollTop*_,o!==p&&(o=o.parentNode));return[a,l]}function Te(o,a){if(!o||!o.getBoundingClientRect)return oe();var l=o,p=!1;do if(l.clientWidth<l.scrollWidth||l.clientHeight<l.scrollHeight){var c=E(l);if(l.clientWidth<l.scrollWidth&&(c.overflowX=="auto"||c.overflowX=="scroll")||l.clientHeight<l.scrollHeight&&(c.overflowY=="auto"||c.overflowY=="scroll")){if(!l.getBoundingClientRect||l===document.body)return oe();if(p||a)return l;p=!0}}while(l=l.parentNode);return oe()}function Wt(o,a){return Math.round(o.top)===Math.round(a.top)&&Math.round(o.left)===Math.round(a.left)&&Math.round(o.height)===Math.round(a.height)&&Math.round(o.width)===Math.round(a.width)}function Si(o,a){return function(){var l;B||((l=arguments).length===1?o.call(this,l[0]):o.apply(this,l),B=setTimeout(function(){B=void 0},a))}}function $i(o,a,l){o.scrollLeft+=a,o.scrollTop+=l}function Bt(o){var a=window.Polymer,l=window.jQuery||window.Zepto;return a&&a.dom?a.dom(o).cloneNode(!0):l?l(o).clone(!0)[0]:o.cloneNode(!0)}function Ri(o,a){E(o,"position","absolute"),E(o,"top",a.top),E(o,"left",a.left),E(o,"width",a.width),E(o,"height",a.height)}function qt(o){E(o,"position",""),E(o,"top",""),E(o,"left",""),E(o,"width",""),E(o,"height","")}var ae="Sortable"+new Date().getTime();function sr(){var o,a=[];return{captureAnimationState:function(){a=[],this.options.animation&&[].slice.call(this.el.children).forEach(function(l){var p,c;E(l,"display")!=="none"&&l!==A.ghost&&(a.push({target:l,rect:W(l)}),p=e({},a[a.length-1].rect),!l.thisAnimationDuration||(c=N(l,!0))&&(p.top-=c.f,p.left-=c.e),l.fromRect=p)})},addAnimationState:function(l){a.push(l)},removeAnimationState:function(l){a.splice(function(p,c){for(var _ in p)if(p.hasOwnProperty(_)){for(var g in c)if(c.hasOwnProperty(g)&&c[g]===p[_][g])return Number(_)}return-1}(a,{target:l}),1)},animateAll:function(l){var p=this;if(!this.options.animation)return clearTimeout(o),void(typeof l=="function"&&l());var c=!1,_=0;a.forEach(function(g){var v=0,S=g.target,k=S.fromRect,I=W(S),j=S.prevFromRect,q=S.prevToRect,H=g.rect,G=N(S,!0);G&&(I.top-=G.f,I.left-=G.e),S.toRect=I,S.thisAnimationDuration&&Wt(j,I)&&!Wt(k,I)&&(H.top-I.top)/(H.left-I.left)==(k.top-I.top)/(k.left-I.left)&&(g=H,G=j,j=q,q=p.options,v=Math.sqrt(Math.pow(G.top-g.top,2)+Math.pow(G.left-g.left,2))/Math.sqrt(Math.pow(G.top-j.top,2)+Math.pow(G.left-j.left,2))*q.animation),Wt(I,k)||(S.prevFromRect=k,S.prevToRect=I,v=v||p.options.animation,p.animate(S,H,I,v)),v&&(c=!0,_=Math.max(_,v),clearTimeout(S.animationResetTimer),S.animationResetTimer=setTimeout(function(){S.animationTime=0,S.prevFromRect=null,S.fromRect=null,S.prevToRect=null,S.thisAnimationDuration=null},v),S.thisAnimationDuration=v)}),clearTimeout(o),c?o=setTimeout(function(){typeof l=="function"&&l()},_):typeof l=="function"&&l(),a=[]},animate:function(l,p,c,_){var g,v;_&&(E(l,"transition",""),E(l,"transform",""),g=(v=N(this.el))&&v.a,v=v&&v.d,g=(p.left-c.left)/(g||1),v=(p.top-c.top)/(v||1),l.animatingX=!!g,l.animatingY=!!v,E(l,"transform","translate3d("+g+"px,"+v+"px,0)"),this.forRepaintDummy=l.offsetWidth,E(l,"transition","transform "+_+"ms"+(this.options.easing?" "+this.options.easing:"")),E(l,"transform","translate3d(0,0,0)"),typeof l.animated=="number"&&clearTimeout(l.animated),l.animated=setTimeout(function(){E(l,"transition",""),E(l,"transform",""),l.animated=!1,l.animatingX=!1,l.animatingY=!1},_))}}}var Pe=[],zt={initializeByDefault:!0},Ue={mount:function(o){for(var a in zt)!zt.hasOwnProperty(a)||a in o||(o[a]=zt[a]);Pe.forEach(function(l){if(l.pluginName===o.pluginName)throw"Sortable: Cannot mount plugin ".concat(o.pluginName," more than once")}),Pe.push(o)},pluginEvent:function(o,a,l){var p=this;this.eventCanceled=!1,l.cancel=function(){p.eventCanceled=!0};var c=o+"Global";Pe.forEach(function(_){a[_.pluginName]&&(a[_.pluginName][c]&&a[_.pluginName][c](e({sortable:a},l)),a.options[_.pluginName]&&a[_.pluginName][o]&&a[_.pluginName][o](e({sortable:a},l)))})},initializePlugins:function(o,a,l,p){for(var c in Pe.forEach(function(g){var v=g.pluginName;(o.options[v]||g.initializeByDefault)&&((g=new g(o,a,o.options)).sortable=o,g.options=o.options,o[v]=g,i(l,g.defaults))}),o.options){var _;o.options.hasOwnProperty(c)&&(_=this.modifyOption(o,c,o.options[c]))!==void 0&&(o.options[c]=_)}},getEventProperties:function(o,a){var l={};return Pe.forEach(function(p){typeof p.eventProperties=="function"&&i(l,p.eventProperties.call(a[p.pluginName],o))}),l},modifyOption:function(o,a,l){var p;return Pe.forEach(function(c){o[c.pluginName]&&c.optionListeners&&typeof c.optionListeners[a]=="function"&&(p=c.optionListeners[a].call(o[c.pluginName],l))}),p}};function Je(o){var a=o.sortable,l=o.rootEl,p=o.name,c=o.targetEl,_=o.cloneEl,g=o.toEl,v=o.fromEl,S=o.oldIndex,k=o.newIndex,I=o.oldDraggableIndex,j=o.newDraggableIndex,q=o.originalEvent,H=o.putSortable,G=o.extraEventProperties;if(a=a||l&&l[ae]){var F,ee=a.options,o="on"+p.charAt(0).toUpperCase()+p.substr(1);!window.CustomEvent||u||y?(F=document.createEvent("Event")).initEvent(p,!0,!0):F=new CustomEvent(p,{bubbles:!0,cancelable:!0}),F.to=g||l,F.from=v||l,F.item=c||l,F.clone=_,F.oldIndex=S,F.newIndex=k,F.oldDraggableIndex=I,F.newDraggableIndex=j,F.originalEvent=q,F.pullMode=H?H.lastPutMode:void 0;var fe,z=e(e({},G),Ue.getEventProperties(p,a));for(fe in z)F[fe]=z[fe];l&&l.dispatchEvent(F),ee[o]&&ee[o].call(a,F)}}function ce(o,a){var l=(p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{}).evt,p=r(p,or);Ue.pluginEvent.bind(A)(o,a,e({dragEl:T,parentEl:Q,ghostEl:L,rootEl:X,nextEl:Me,lastDownEl:mt,cloneEl:Z,cloneHidden:ke,dragStarted:Ze,putSortable:he,activeSortable:A.active,originalEvent:l,oldIndex:We,oldDraggableIndex:Qe,newIndex:ue,newDraggableIndex:De,hideGhostForTarget:Ai,unhideGhostForTarget:Mi,cloneNowHidden:function(){ke=!0},cloneNowShown:function(){ke=!1},dispatchSortableEvent:function(c){de({sortable:a,name:c,originalEvent:l})}},p))}var or=["evt"];function de(o){Je(e({putSortable:he,cloneEl:Z,targetEl:T,rootEl:X,oldIndex:We,oldDraggableIndex:Qe,newIndex:ue,newDraggableIndex:De},o))}var T,Q,L,X,Me,mt,Z,ke,We,ue,Qe,De,bt,he,Ne,ye,Vt,Yt,Ei,Ti,Ze,Be,et,yt,le,qe=!1,vt=!1,wt=[],tt=!1,Ct=!1,Xt=[],Kt=!1,xt=[],St=typeof document!="undefined",$t=R,ki=y||u?"cssFloat":"float",nr=St&&!st&&!R&&"draggable"in document.createElement("div"),Di=function(){if(St){if(u)return!1;var o=document.createElement("x");return o.style.cssText="pointer-events:auto",o.style.pointerEvents==="auto"}}(),Ii=function(k,a){var l=E(k),p=parseInt(l.width)-parseInt(l.paddingLeft)-parseInt(l.paddingRight)-parseInt(l.borderLeftWidth)-parseInt(l.borderRightWidth),c=Fe(k,0,a),_=Fe(k,1,a),g=c&&E(c),v=_&&E(_),S=g&&parseInt(g.marginLeft)+parseInt(g.marginRight)+W(c).width,k=v&&parseInt(v.marginLeft)+parseInt(v.marginRight)+W(_).width;return l.display==="flex"?l.flexDirection==="column"||l.flexDirection==="column-reverse"?"vertical":"horizontal":l.display==="grid"?l.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal":c&&g.float&&g.float!=="none"?(a=g.float==="left"?"left":"right",!_||v.clear!=="both"&&v.clear!==a?"horizontal":"vertical"):c&&(g.display==="block"||g.display==="flex"||g.display==="table"||g.display==="grid"||p<=S&&l[ki]==="none"||_&&l[ki]==="none"&&p<S+k)?"vertical":"horizontal"},Oi=function(o){function a(c,_){return function(g,v,S,k){var I=g.options.group.name&&v.options.group.name&&g.options.group.name===v.options.group.name;return c==null&&(_||I)?!0:c==null||c===!1?!1:_&&c==="clone"?c:typeof c=="function"?a(c(g,v,S,k),_)(g,v,S,k):(v=(_?g:v).options.group.name,c===!0||typeof c=="string"&&c===v||c.join&&-1<c.indexOf(v))}}var l={},p=o.group;p&&t(p)=="object"||(p={name:p}),l.name=p.name,l.checkPull=a(p.pull,!0),l.checkPut=a(p.put),l.revertClone=p.revertClone,o.group=l},Ai=function(){!Di&&L&&E(L,"display","none")},Mi=function(){!Di&&L&&E(L,"display","")};St&&!st&&document.addEventListener("click",function(o){if(vt)return o.preventDefault(),o.stopPropagation&&o.stopPropagation(),o.stopImmediatePropagation&&o.stopImmediatePropagation(),vt=!1},!0);function He(o){if(T){o=o.touches?o.touches[0]:o;var a=(c=o.clientX,_=o.clientY,wt.some(function(v){var S=v[ae].options.emptyInsertThreshold;if(S&&!Pt(v)){var k=W(v),I=c>=k.left-S&&c<=k.right+S,S=_>=k.top-S&&_<=k.bottom+S;return I&&S?g=v:void 0}}),g);if(a){var l,p={};for(l in o)o.hasOwnProperty(l)&&(p[l]=o[l]);p.target=p.rootEl=a,p.preventDefault=void 0,p.stopPropagation=void 0,a[ae]._onDragOver(p)}}var c,_,g}function ar(o){T&&T.parentNode[ae]._isOutsideThisEl(o.target)}function A(o,a){if(!o||!o.nodeType||o.nodeType!==1)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(o));this.el=o,this.options=a=i({},a),o[ae]=this;var l,p,c={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(o.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Ii(o,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(_,g){_.setData("Text",g.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:A.supportPointer!==!1&&"PointerEvent"in window&&!b,emptyInsertThreshold:5};for(l in Ue.initializePlugins(this,o,c),c)l in a||(a[l]=c[l]);for(p in Oi(a),this)p.charAt(0)==="_"&&typeof this[p]=="function"&&(this[p]=this[p].bind(this));this.nativeDraggable=!a.forceFallback&&nr,this.nativeDraggable&&(this.options.touchStartThreshold=1),a.supportPointer?C(o,"pointerdown",this._onTapStart):(C(o,"mousedown",this._onTapStart),C(o,"touchstart",this._onTapStart)),this.nativeDraggable&&(C(o,"dragover",this),C(o,"dragenter",this)),wt.push(this.el),a.store&&a.store.get&&this.sort(a.store.get(this)||[]),i(this,sr())}function Rt(o,a,l,p,c,_,g,v){var S,k,I=o[ae],j=I.options.onMove;return!window.CustomEvent||u||y?(S=document.createEvent("Event")).initEvent("move",!0,!0):S=new CustomEvent("move",{bubbles:!0,cancelable:!0}),S.to=a,S.from=o,S.dragged=l,S.draggedRect=p,S.related=c||a,S.relatedRect=_||W(a),S.willInsertAfter=v,S.originalEvent=g,o.dispatchEvent(S),k=j?j.call(I,S,g):k}function Gt(o){o.draggable=!1}function lr(){Kt=!1}function Et(o){return setTimeout(o,0)}function Ut(o){return clearTimeout(o)}A.prototype={constructor:A,_isOutsideThisEl:function(o){this.el.contains(o)||o===this.el||(Be=null)},_getDirection:function(o,a){return typeof this.options.direction=="function"?this.options.direction.call(this,o,a,T):this.options.direction},_onTapStart:function(o){if(o.cancelable){var a=this,l=this.el,p=this.options,c=p.preventOnFilter,_=o.type,g=o.touches&&o.touches[0]||o.pointerType&&o.pointerType==="touch"&&o,v=(g||o).target,S=o.target.shadowRoot&&(o.path&&o.path[0]||o.composedPath&&o.composedPath()[0])||v,k=p.filter;if(function(I){xt.length=0;for(var j=I.getElementsByTagName("input"),q=j.length;q--;){var H=j[q];H.checked&&xt.push(H)}}(l),!T&&!(/mousedown|pointerdown/.test(_)&&o.button!==0||p.disabled)&&!S.isContentEditable&&(this.nativeDraggable||!b||!v||v.tagName.toUpperCase()!=="SELECT")&&!((v=D(v,p.draggable,l,!1))&&v.animated||mt===v)){if(We=J(v),Qe=J(v,p.draggable),typeof k=="function"){if(k.call(this,o,v,this))return de({sortable:a,rootEl:S,name:"filter",targetEl:v,toEl:l,fromEl:l}),ce("filter",a,{evt:o}),void(c&&o.cancelable&&o.preventDefault())}else if(k=k&&k.split(",").some(function(I){if(I=D(S,I.trim(),l,!1))return de({sortable:a,rootEl:I,name:"filter",targetEl:v,fromEl:l,toEl:l}),ce("filter",a,{evt:o}),!0}))return void(c&&o.cancelable&&o.preventDefault());p.handle&&!D(S,p.handle,l,!1)||this._prepareDragStart(o,g,v)}}},_prepareDragStart:function(o,a,l){var p,c=this,_=c.el,g=c.options,v=_.ownerDocument;l&&!T&&l.parentNode===_&&(p=W(l),X=_,Q=(T=l).parentNode,Me=T.nextSibling,mt=l,bt=g.group,Ne={target:A.dragged=T,clientX:(a||o).clientX,clientY:(a||o).clientY},Ei=Ne.clientX-p.left,Ti=Ne.clientY-p.top,this._lastX=(a||o).clientX,this._lastY=(a||o).clientY,T.style["will-change"]="all",p=function(){ce("delayEnded",c,{evt:o}),A.eventCanceled?c._onDrop():(c._disableDelayedDragEvents(),!m&&c.nativeDraggable&&(T.draggable=!0),c._triggerDragStart(o,a),de({sortable:c,name:"choose",originalEvent:o}),P(T,g.chosenClass,!0))},g.ignore.split(",").forEach(function(S){ne(T,S.trim(),Gt)}),C(v,"dragover",He),C(v,"mousemove",He),C(v,"touchmove",He),C(v,"mouseup",c._onDrop),C(v,"touchend",c._onDrop),C(v,"touchcancel",c._onDrop),m&&this.nativeDraggable&&(this.options.touchStartThreshold=4,T.draggable=!0),ce("delayStart",this,{evt:o}),!g.delay||g.delayOnTouchOnly&&!a||this.nativeDraggable&&(y||u)?p():A.eventCanceled?this._onDrop():(C(v,"mouseup",c._disableDelayedDrag),C(v,"touchend",c._disableDelayedDrag),C(v,"touchcancel",c._disableDelayedDrag),C(v,"mousemove",c._delayedDragTouchMoveHandler),C(v,"touchmove",c._delayedDragTouchMoveHandler),g.supportPointer&&C(v,"pointermove",c._delayedDragTouchMoveHandler),c._dragStartTimer=setTimeout(p,g.delay)))},_delayedDragTouchMoveHandler:function(o){o=o.touches?o.touches[0]:o,Math.max(Math.abs(o.clientX-this._lastX),Math.abs(o.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){T&&Gt(T),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var o=this.el.ownerDocument;w(o,"mouseup",this._disableDelayedDrag),w(o,"touchend",this._disableDelayedDrag),w(o,"touchcancel",this._disableDelayedDrag),w(o,"mousemove",this._delayedDragTouchMoveHandler),w(o,"touchmove",this._delayedDragTouchMoveHandler),w(o,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(o,a){a=a||o.pointerType=="touch"&&o,!this.nativeDraggable||a?this.options.supportPointer?C(document,"pointermove",this._onTouchMove):C(document,a?"touchmove":"mousemove",this._onTouchMove):(C(T,"dragend",this),C(X,"dragstart",this._onDragStart));try{document.selection?Et(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch(l){}},_dragStarted:function(o,a){var l;qe=!1,X&&T?(ce("dragStarted",this,{evt:a}),this.nativeDraggable&&C(document,"dragover",ar),l=this.options,o||P(T,l.dragClass,!1),P(T,l.ghostClass,!0),A.active=this,o&&this._appendGhost(),de({sortable:this,name:"start",originalEvent:a})):this._nulling()},_emulateDragOver:function(){if(ye){this._lastX=ye.clientX,this._lastY=ye.clientY,Ai();for(var o=document.elementFromPoint(ye.clientX,ye.clientY),a=o;o&&o.shadowRoot&&(o=o.shadowRoot.elementFromPoint(ye.clientX,ye.clientY))!==a;)a=o;if(T.parentNode[ae]._isOutsideThisEl(o),a)do if(a[ae]&&a[ae]._onDragOver({clientX:ye.clientX,clientY:ye.clientY,target:o,rootEl:a})&&!this.options.dragoverBubble)break;while(a=(o=a).parentNode);Mi()}},_onTouchMove:function(o){if(Ne){var _=this.options,a=_.fallbackTolerance,l=_.fallbackOffset,p=o.touches?o.touches[0]:o,c=L&&N(L,!0),g=L&&c&&c.a,v=L&&c&&c.d,_=$t&&le&&xi(le),g=(p.clientX-Ne.clientX+l.x)/(g||1)+(_?_[0]-Xt[0]:0)/(g||1),v=(p.clientY-Ne.clientY+l.y)/(v||1)+(_?_[1]-Xt[1]:0)/(v||1);if(!A.active&&!qe){if(a&&Math.max(Math.abs(p.clientX-this._lastX),Math.abs(p.clientY-this._lastY))<a)return;this._onDragStart(o,!0)}L&&(c?(c.e+=g-(Vt||0),c.f+=v-(Yt||0)):c={a:1,b:0,c:0,d:1,e:g,f:v},c="matrix(".concat(c.a,",").concat(c.b,",").concat(c.c,",").concat(c.d,",").concat(c.e,",").concat(c.f,")"),E(L,"webkitTransform",c),E(L,"mozTransform",c),E(L,"msTransform",c),E(L,"transform",c),Vt=g,Yt=v,ye=p),o.cancelable&&o.preventDefault()}},_appendGhost:function(){if(!L){var o=this.options.fallbackOnBody?document.body:X,a=W(T,!0,$t,!0,o),l=this.options;if($t){for(le=o;E(le,"position")==="static"&&E(le,"transform")==="none"&&le!==document;)le=le.parentNode;le!==document.body&&le!==document.documentElement?(le===document&&(le=oe()),a.top+=le.scrollTop,a.left+=le.scrollLeft):le=oe(),Xt=xi(le)}P(L=T.cloneNode(!0),l.ghostClass,!1),P(L,l.fallbackClass,!0),P(L,l.dragClass,!0),E(L,"transition",""),E(L,"transform",""),E(L,"box-sizing","border-box"),E(L,"margin",0),E(L,"top",a.top),E(L,"left",a.left),E(L,"width",a.width),E(L,"height",a.height),E(L,"opacity","0.8"),E(L,"position",$t?"absolute":"fixed"),E(L,"zIndex","100000"),E(L,"pointerEvents","none"),A.ghost=L,o.appendChild(L),E(L,"transform-origin",Ei/parseInt(L.style.width)*100+"% "+Ti/parseInt(L.style.height)*100+"%")}},_onDragStart:function(o,a){var l=this,p=o.dataTransfer,c=l.options;ce("dragStart",this,{evt:o}),A.eventCanceled?this._onDrop():(ce("setupClone",this),A.eventCanceled||((Z=Bt(T)).removeAttribute("id"),Z.draggable=!1,Z.style["will-change"]="",this._hideClone(),P(Z,this.options.chosenClass,!1),A.clone=Z),l.cloneId=Et(function(){ce("clone",l),A.eventCanceled||(l.options.removeCloneOnHide||X.insertBefore(Z,T),l._hideClone(),de({sortable:l,name:"clone"}))}),a||P(T,c.dragClass,!0),a?(vt=!0,l._loopId=setInterval(l._emulateDragOver,50)):(w(document,"mouseup",l._onDrop),w(document,"touchend",l._onDrop),w(document,"touchcancel",l._onDrop),p&&(p.effectAllowed="move",c.setData&&c.setData.call(l,p,T)),C(document,"drop",l),E(T,"transform","translateZ(0)")),qe=!0,l._dragStartId=Et(l._dragStarted.bind(l,a,o)),C(document,"selectstart",l),Ze=!0,b&&E(document.body,"user-select","none"))},_onDragOver:function(o){var a,l,p,c,_=this.el,g=o.target,v=this.options,S=v.group,k=A.active,I=bt===S,j=v.sort,q=he||k,H=this,G=!1;if(!Kt){if(o.preventDefault!==void 0&&o.cancelable&&o.preventDefault(),g=D(g,v.draggable,_,!0),se("dragOver"),A.eventCanceled)return G;if(T.contains(o.target)||g.animated&&g.animatingX&&g.animatingY||H._ignoreWhileAnimating===g)return me(!1);if(vt=!1,k&&!v.disabled&&(I?j||(l=Q!==X):he===this||(this.lastPutMode=bt.checkPull(this,k,T,o))&&S.checkPut(this,k,T,o))){if(p=this._getDirection(o,g)==="vertical",a=W(T),se("dragOverValid"),A.eventCanceled)return G;if(l)return Q=X,$e(),this._hideClone(),se("revert"),A.eventCanceled||(Me?X.insertBefore(T,Me):X.appendChild(T)),me(!0);var F=Pt(_,v.draggable);if(!F||function(ie,dt,K){return K=W(Pt(K.el,K.options.draggable)),dt?ie.clientX>K.right+10||ie.clientX<=K.right&&ie.clientY>K.bottom&&ie.clientX>=K.left:ie.clientX>K.right&&ie.clientY>K.top||ie.clientX<=K.right&&ie.clientY>K.bottom+10}(o,p,this)&&!F.animated){if(F===T)return me(!1);if((g=F&&_===o.target?F:g)&&(ge=W(g)),Rt(X,_,T,a,g,ge,o,!!g)!==!1)return $e(),F&&F.nextSibling?_.insertBefore(T,F.nextSibling):_.appendChild(T),Q=_,Le(),me(!0)}else if(F&&function(ie,dt,K){return K=W(Fe(K.el,0,K.options,!0)),dt?ie.clientX<K.left-10||ie.clientY<K.top&&ie.clientX<K.right:ie.clientY<K.top-10||ie.clientY<K.bottom&&ie.clientX<K.left}(o,p,this)){var ee=Fe(_,0,v,!0);if(ee===T)return me(!1);if(ge=W(g=ee),Rt(X,_,T,a,g,ge,o,!1)!==!1)return $e(),_.insertBefore(T,ee),Q=_,Le(),me(!0)}else if(g.parentNode===_){var fe,z,be,ge=W(g),Se=T.parentNode!==_,U=(U=T.animated&&T.toRect||a,te=g.animated&&g.toRect||ge,xe=(c=p)?U.left:U.top,S=c?U.right:U.bottom,F=c?U.width:U.height,ee=c?te.left:te.top,U=c?te.right:te.bottom,te=c?te.width:te.height,!(xe===ee||S===U||xe+F/2===ee+te/2)),xe=p?"top":"left",F=Ae(g,"top","top")||Ae(T,"top","top"),ee=F?F.scrollTop:void 0;if(Be!==g&&(z=ge[xe],tt=!1,Ct=!U&&v.invertSwap||Se),(fe=function(Oe,si,Ce,Ee,oi,Ot,Li,dr){var Re=Ee?Oe.clientY:Oe.clientX,Ie=Ee?Ce.height:Ce.width,Oe=Ee?Ce.top:Ce.left,Ee=Ee?Ce.bottom:Ce.right,Ce=!1;if(!Li){if(dr&&yt<Ie*oi){if(tt=!tt&&(et===1?Oe+Ie*Ot/2<Re:Re<Ee-Ie*Ot/2)?!0:tt)Ce=!0;else if(et===1?Re<Oe+yt:Ee-yt<Re)return-et}else if(Oe+Ie*(1-oi)/2<Re&&Re<Ee-Ie*(1-oi)/2)return function(hr){return J(T)<J(hr)?1:-1}(si)}return(Ce=Ce||Li)&&(Re<Oe+Ie*Ot/2||Ee-Ie*Ot/2<Re)?Oe+Ie/2<Re?1:-1:0}(o,g,ge,p,U?1:v.swapThreshold,v.invertedSwapThreshold==null?v.swapThreshold:v.invertedSwapThreshold,Ct,Be===g))!==0)for(var lt=J(T);(be=Q.children[lt-=fe])&&(E(be,"display")==="none"||be===L););if(fe===0||be===g)return me(!1);et=fe;var te=(Be=g).nextElementSibling,Se=!1,U=Rt(X,_,T,a,g,ge,o,Se=fe===1);if(U!==!1)return U!==1&&U!==-1||(Se=U===1),Kt=!0,setTimeout(lr,30),$e(),Se&&!te?_.appendChild(T):g.parentNode.insertBefore(T,Se?te:g),F&&$i(F,0,ee-F.scrollTop),Q=T.parentNode,z===void 0||Ct||(yt=Math.abs(z-W(g)[xe])),Le(),me(!0)}if(_.contains(T))return me(!1)}return!1}function se(ie,dt){ce(ie,H,e({evt:o,isOwner:I,axis:p?"vertical":"horizontal",revert:l,dragRect:a,targetRect:ge,canSort:j,fromSortable:q,target:g,completed:me,onMove:function(K,si){return Rt(X,_,T,a,K,W(K),o,si)},changed:Le},dt))}function $e(){se("dragOverAnimationCapture"),H.captureAnimationState(),H!==q&&q.captureAnimationState()}function me(ie){return se("dragOverCompleted",{insertion:ie}),ie&&(I?k._hideClone():k._showClone(H),H!==q&&(P(T,(he||k).options.ghostClass,!1),P(T,v.ghostClass,!0)),he!==H&&H!==A.active?he=H:H===A.active&&he&&(he=null),q===H&&(H._ignoreWhileAnimating=g),H.animateAll(function(){se("dragOverAnimationComplete"),H._ignoreWhileAnimating=null}),H!==q&&(q.animateAll(),q._ignoreWhileAnimating=null)),(g===T&&!T.animated||g===_&&!g.animated)&&(Be=null),v.dragoverBubble||o.rootEl||g===document||(T.parentNode[ae]._isOutsideThisEl(o.target),ie||He(o)),!v.dragoverBubble&&o.stopPropagation&&o.stopPropagation(),G=!0}function Le(){ue=J(T),De=J(T,v.draggable),de({sortable:H,name:"change",toEl:_,newIndex:ue,newDraggableIndex:De,originalEvent:o})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){w(document,"mousemove",this._onTouchMove),w(document,"touchmove",this._onTouchMove),w(document,"pointermove",this._onTouchMove),w(document,"dragover",He),w(document,"mousemove",He),w(document,"touchmove",He)},_offUpEvents:function(){var o=this.el.ownerDocument;w(o,"mouseup",this._onDrop),w(o,"touchend",this._onDrop),w(o,"pointerup",this._onDrop),w(o,"touchcancel",this._onDrop),w(document,"selectstart",this)},_onDrop:function(o){var a=this.el,l=this.options;ue=J(T),De=J(T,l.draggable),ce("drop",this,{evt:o}),Q=T&&T.parentNode,ue=J(T),De=J(T,l.draggable),A.eventCanceled||(tt=Ct=qe=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Ut(this.cloneId),Ut(this._dragStartId),this.nativeDraggable&&(w(document,"drop",this),w(a,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),b&&E(document.body,"user-select",""),E(T,"transform",""),o&&(Ze&&(o.cancelable&&o.preventDefault(),l.dropBubble||o.stopPropagation()),L&&L.parentNode&&L.parentNode.removeChild(L),(X===Q||he&&he.lastPutMode!=="clone")&&Z&&Z.parentNode&&Z.parentNode.removeChild(Z),T&&(this.nativeDraggable&&w(T,"dragend",this),Gt(T),T.style["will-change"]="",Ze&&!qe&&P(T,(he||this).options.ghostClass,!1),P(T,this.options.chosenClass,!1),de({sortable:this,name:"unchoose",toEl:Q,newIndex:null,newDraggableIndex:null,originalEvent:o}),X!==Q?(0<=ue&&(de({rootEl:Q,name:"add",toEl:Q,fromEl:X,originalEvent:o}),de({sortable:this,name:"remove",toEl:Q,originalEvent:o}),de({rootEl:Q,name:"sort",toEl:Q,fromEl:X,originalEvent:o}),de({sortable:this,name:"sort",toEl:Q,originalEvent:o})),he&&he.save()):ue!==We&&0<=ue&&(de({sortable:this,name:"update",toEl:Q,originalEvent:o}),de({sortable:this,name:"sort",toEl:Q,originalEvent:o})),A.active&&(ue!=null&&ue!==-1||(ue=We,De=Qe),de({sortable:this,name:"end",toEl:Q,originalEvent:o}),this.save())))),this._nulling()},_nulling:function(){ce("nulling",this),X=T=Q=L=Me=Z=mt=ke=Ne=ye=Ze=ue=De=We=Qe=Be=et=he=bt=A.dragged=A.ghost=A.clone=A.active=null,xt.forEach(function(o){o.checked=!0}),xt.length=Vt=Yt=0},handleEvent:function(o){switch(o.type){case"drop":case"dragend":this._onDrop(o);break;case"dragenter":case"dragover":T&&(this._onDragOver(o),function(a){a.dataTransfer&&(a.dataTransfer.dropEffect="move"),a.cancelable&&a.preventDefault()}(o));break;case"selectstart":o.preventDefault()}},toArray:function(){for(var o,a=[],l=this.el.children,p=0,c=l.length,_=this.options;p<c;p++)D(o=l[p],_.draggable,this.el,!1)&&a.push(o.getAttribute(_.dataIdAttr)||function(g){for(var v=g.tagName+g.className+g.src+g.href+g.textContent,S=v.length,k=0;S--;)k+=v.charCodeAt(S);return k.toString(36)}(o));return a},sort:function(o,a){var l={},p=this.el;this.toArray().forEach(function(c,_){_=p.children[_],D(_,this.options.draggable,p,!1)&&(l[c]=_)},this),a&&this.captureAnimationState(),o.forEach(function(c){l[c]&&(p.removeChild(l[c]),p.appendChild(l[c]))}),a&&this.animateAll()},save:function(){var o=this.options.store;o&&o.set&&o.set(this)},closest:function(o,a){return D(o,a||this.options.draggable,this.el,!1)},option:function(o,a){var l=this.options;if(a===void 0)return l[o];var p=Ue.modifyOption(this,o,a);l[o]=p!==void 0?p:a,o==="group"&&Oi(l)},destroy:function(){ce("destroy",this);var o=this.el;o[ae]=null,w(o,"mousedown",this._onTapStart),w(o,"touchstart",this._onTapStart),w(o,"pointerdown",this._onTapStart),this.nativeDraggable&&(w(o,"dragover",this),w(o,"dragenter",this)),Array.prototype.forEach.call(o.querySelectorAll("[draggable]"),function(a){a.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),wt.splice(wt.indexOf(this.el),1),this.el=o=null},_hideClone:function(){ke||(ce("hideClone",this),A.eventCanceled||(E(Z,"display","none"),this.options.removeCloneOnHide&&Z.parentNode&&Z.parentNode.removeChild(Z),ke=!0))},_showClone:function(o){o.lastPutMode==="clone"?ke&&(ce("showClone",this),A.eventCanceled||(T.parentNode!=X||this.options.group.revertClone?Me?X.insertBefore(Z,Me):X.appendChild(Z):X.insertBefore(Z,T),this.options.group.revertClone&&this.animate(T,Z),E(Z,"display",""),ke=!1)):this._hideClone()}},St&&C(document,"touchmove",function(o){(A.active||qe)&&o.cancelable&&o.preventDefault()}),A.utils={on:C,off:w,css:E,find:ne,is:function(o,a){return!!D(o,a,o,!1)},extend:function(o,a){if(o&&a)for(var l in a)a.hasOwnProperty(l)&&(o[l]=a[l]);return o},throttle:Si,closest:D,toggleClass:P,clone:Bt,index:J,nextTick:Et,cancelNextTick:Ut,detectDirection:Ii,getChild:Fe},A.get=function(o){return o[ae]},A.mount=function(){for(var o=arguments.length,a=new Array(o),l=0;l<o;l++)a[l]=arguments[l];(a=a[0].constructor===Array?a[0]:a).forEach(function(p){if(!p.prototype||!p.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(p));p.utils&&(A.utils=e(e({},A.utils),p.utils)),Ue.mount(p)})},A.create=function(o,a){return new A(o,a)};var it,Jt,Qt,Zt,Tt,rt,re=[],ei=!(A.version="1.15.0");function kt(){re.forEach(function(o){clearInterval(o.pid)}),re=[]}function Ni(){clearInterval(rt)}var ve,ti=Si(function(o,a,l,p){if(a.scroll){var c,_=(o.touches?o.touches[0]:o).clientX,g=(o.touches?o.touches[0]:o).clientY,v=a.scrollSensitivity,S=a.scrollSpeed,k=oe(),I=!1;Jt!==l&&(Jt=l,kt(),it=a.scroll,c=a.scrollFn,it===!0&&(it=Te(l,!0)));var j=0,q=it;do{var H=q,se=W(H),G=se.top,F=se.bottom,ee=se.left,fe=se.right,z=se.width,be=se.height,ge=void 0,Se=void 0,xe=H.scrollWidth,lt=H.scrollHeight,te=E(H),U=H.scrollLeft,se=H.scrollTop,Se=H===k?(ge=z<xe&&(te.overflowX==="auto"||te.overflowX==="scroll"||te.overflowX==="visible"),be<lt&&(te.overflowY==="auto"||te.overflowY==="scroll"||te.overflowY==="visible")):(ge=z<xe&&(te.overflowX==="auto"||te.overflowX==="scroll"),be<lt&&(te.overflowY==="auto"||te.overflowY==="scroll")),U=ge&&(Math.abs(fe-_)<=v&&U+z<xe)-(Math.abs(ee-_)<=v&&!!U),se=Se&&(Math.abs(F-g)<=v&&se+be<lt)-(Math.abs(G-g)<=v&&!!se);if(!re[j])for(var $e=0;$e<=j;$e++)re[$e]||(re[$e]={});re[j].vx==U&&re[j].vy==se&&re[j].el===H||(re[j].el=H,re[j].vx=U,re[j].vy=se,clearInterval(re[j].pid),U==0&&se==0||(I=!0,re[j].pid=setInterval(function(){p&&this.layer===0&&A.active._onTouchMove(Tt);var me=re[this.layer].vy?re[this.layer].vy*S:0,Le=re[this.layer].vx?re[this.layer].vx*S:0;typeof c=="function"&&c.call(A.dragged.parentNode[ae],Le,me,o,Tt,re[this.layer].el)!=="continue"||$i(re[this.layer].el,Le,me)}.bind({layer:j}),24))),j++}while(a.bubbleScroll&&q!==k&&(q=Te(q,!1)));ei=I}},30),st=function(v){var a=v.originalEvent,l=v.putSortable,p=v.dragEl,c=v.activeSortable,_=v.dispatchSortableEvent,g=v.hideGhostForTarget,v=v.unhideGhostForTarget;a&&(c=l||c,g(),a=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:a,a=document.elementFromPoint(a.clientX,a.clientY),v(),c&&!c.el.contains(a)&&(_("spill"),this.onSpill({dragEl:p,putSortable:l})))};function ii(){}function ri(){}ii.prototype={startIndex:null,dragStart:function(o){o=o.oldDraggableIndex,this.startIndex=o},onSpill:function(o){var a=o.dragEl,l=o.putSortable;this.sortable.captureAnimationState(),l&&l.captureAnimationState(),o=Fe(this.sortable.el,this.startIndex,this.options),o?this.sortable.el.insertBefore(a,o):this.sortable.el.appendChild(a),this.sortable.animateAll(),l&&l.animateAll()},drop:st},i(ii,{pluginName:"revertOnSpill"}),ri.prototype={onSpill:function(l){var a=l.dragEl,l=l.putSortable||this.sortable;l.captureAnimationState(),a.parentNode&&a.parentNode.removeChild(a),l.animateAll()},drop:st},i(ri,{pluginName:"removeOnSpill"});var ot,we,V,nt,Dt,M=[],_e=[],at=!1,pe=!1,ze=!1;function Hi(o,a){_e.forEach(function(l,p){p=a.children[l.sortableIndex+(o?Number(p):0)],p?a.insertBefore(l,p):a.appendChild(l)})}function It(){M.forEach(function(o){o!==V&&o.parentNode&&o.parentNode.removeChild(o)})}return A.mount(new function(){function o(){for(var a in this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)a.charAt(0)==="_"&&typeof this[a]=="function"&&(this[a]=this[a].bind(this))}return o.prototype={dragStarted:function(a){a=a.originalEvent,this.sortable.nativeDraggable?C(document,"dragover",this._handleAutoScroll):this.options.supportPointer?C(document,"pointermove",this._handleFallbackAutoScroll):a.touches?C(document,"touchmove",this._handleFallbackAutoScroll):C(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(a){a=a.originalEvent,this.options.dragOverBubble||a.rootEl||this._handleAutoScroll(a)},drop:function(){this.sortable.nativeDraggable?w(document,"dragover",this._handleAutoScroll):(w(document,"pointermove",this._handleFallbackAutoScroll),w(document,"touchmove",this._handleFallbackAutoScroll),w(document,"mousemove",this._handleFallbackAutoScroll)),Ni(),kt(),clearTimeout(B),B=void 0},nulling:function(){Tt=Jt=it=ei=rt=Qt=Zt=null,re.length=0},_handleFallbackAutoScroll:function(a){this._handleAutoScroll(a,!0)},_handleAutoScroll:function(a,l){var p,c=this,_=(a.touches?a.touches[0]:a).clientX,g=(a.touches?a.touches[0]:a).clientY,v=document.elementFromPoint(_,g);Tt=a,l||this.options.forceAutoScrollFallback||y||u||b?(ti(a,this.options,v,l),p=Te(v,!0),!ei||rt&&_===Qt&&g===Zt||(rt&&Ni(),rt=setInterval(function(){var S=Te(document.elementFromPoint(_,g),!0);S!==p&&(p=S,kt()),ti(a,c.options,S,l)},10),Qt=_,Zt=g)):this.options.bubbleScroll&&Te(v,!0)!==oe()?ti(a,this.options,Te(v,!1),!1):kt()}},i(o,{pluginName:"scroll",initializeByDefault:!0})}),A.mount(ri,ii),A.mount(new function(){function o(){this.defaults={swapClass:"sortable-swap-highlight"}}return o.prototype={dragStart:function(a){a=a.dragEl,ve=a},dragOverValid:function(a){var l=a.completed,p=a.target,c=a.onMove,_=a.activeSortable,g=a.changed,v=a.cancel;_.options.swap&&(a=this.sortable.el,_=this.options,p&&p!==a&&(a=ve,ve=c(p)!==!1?(P(p,_.swapClass,!0),p):null,a&&a!==ve&&P(a,_.swapClass,!1)),g(),l(!0),v())},drop:function(a){var l,p,c=a.activeSortable,_=a.putSortable,g=a.dragEl,v=_||this.sortable,S=this.options;ve&&P(ve,S.swapClass,!1),ve&&(S.swap||_&&_.options.swap)&&g!==ve&&(v.captureAnimationState(),v!==c&&c.captureAnimationState(),p=ve,a=(l=g).parentNode,S=p.parentNode,a&&S&&!a.isEqualNode(p)&&!S.isEqualNode(l)&&(_=J(l),g=J(p),a.isEqualNode(S)&&_<g&&g++,a.insertBefore(p,a.children[_]),S.insertBefore(l,S.children[g])),v.animateAll(),v!==c&&c.animateAll())},nulling:function(){ve=null}},i(o,{pluginName:"swap",eventProperties:function(){return{swapItem:ve}}})}),A.mount(new function(){function o(a){for(var l in this)l.charAt(0)==="_"&&typeof this[l]=="function"&&(this[l]=this[l].bind(this));a.options.avoidImplicitDeselect||(a.options.supportPointer?C(document,"pointerup",this._deselectMultiDrag):(C(document,"mouseup",this._deselectMultiDrag),C(document,"touchend",this._deselectMultiDrag))),C(document,"keydown",this._checkKeyDown),C(document,"keyup",this._checkKeyUp),this.defaults={selectedClass:"sortable-selected",multiDragKey:null,avoidImplicitDeselect:!1,setData:function(p,c){var _="";M.length&&we===a?M.forEach(function(g,v){_+=(v?", ":"")+g.textContent}):_=c.textContent,p.setData("Text",_)}}}return o.prototype={multiDragKeyDown:!1,isMultiDrag:!1,delayStartGlobal:function(a){a=a.dragEl,V=a},delayEnded:function(){this.isMultiDrag=~M.indexOf(V)},setupClone:function(p){var l=p.sortable,p=p.cancel;if(this.isMultiDrag){for(var c=0;c<M.length;c++)_e.push(Bt(M[c])),_e[c].sortableIndex=M[c].sortableIndex,_e[c].draggable=!1,_e[c].style["will-change"]="",P(_e[c],this.options.selectedClass,!1),M[c]===V&&P(_e[c],this.options.chosenClass,!1);l._hideClone(),p()}},clone:function(_){var l=_.sortable,p=_.rootEl,c=_.dispatchSortableEvent,_=_.cancel;this.isMultiDrag&&(this.options.removeCloneOnHide||M.length&&we===l&&(Hi(!0,p),c("clone"),_()))},showClone:function(c){var l=c.cloneNowShown,p=c.rootEl,c=c.cancel;this.isMultiDrag&&(Hi(!1,p),_e.forEach(function(_){E(_,"display","")}),l(),Dt=!1,c())},hideClone:function(c){var l=this,p=(c.sortable,c.cloneNowHidden),c=c.cancel;this.isMultiDrag&&(_e.forEach(function(_){E(_,"display","none"),l.options.removeCloneOnHide&&_.parentNode&&_.parentNode.removeChild(_)}),p(),Dt=!0,c())},dragStartGlobal:function(a){a.sortable,!this.isMultiDrag&&we&&we.multiDrag._deselectMultiDrag(),M.forEach(function(l){l.sortableIndex=J(l)}),M=M.sort(function(l,p){return l.sortableIndex-p.sortableIndex}),ze=!0},dragStarted:function(c){var l,p=this,c=c.sortable;this.isMultiDrag&&(this.options.sort&&(c.captureAnimationState(),this.options.animation&&(M.forEach(function(_){_!==V&&E(_,"position","absolute")}),l=W(V,!1,!0,!0),M.forEach(function(_){_!==V&&Ri(_,l)}),at=pe=!0)),c.animateAll(function(){at=pe=!1,p.options.animation&&M.forEach(function(_){qt(_)}),p.options.sort&&It()}))},dragOver:function(c){var l=c.target,p=c.completed,c=c.cancel;pe&&~M.indexOf(l)&&(p(!1),c())},revert:function(a){var l,p,c=a.fromSortable,_=a.rootEl,g=a.sortable,v=a.dragRect;1<M.length&&(M.forEach(function(S){g.addAnimationState({target:S,rect:pe?W(S):v}),qt(S),S.fromRect=v,c.removeAnimationState(S)}),pe=!1,l=!this.options.removeCloneOnHide,p=_,M.forEach(function(S,k){k=p.children[S.sortableIndex+(l?Number(k):0)],k?p.insertBefore(S,k):p.appendChild(S)}))},dragOverCompleted:function(k){var l,p=k.sortable,c=k.isOwner,_=k.insertion,g=k.activeSortable,v=k.parentEl,S=k.putSortable,k=this.options;_&&(c&&g._hideClone(),at=!1,k.animation&&1<M.length&&(pe||!c&&!g.options.sort&&!S)&&(l=W(V,!1,!0,!0),M.forEach(function(I){I!==V&&(Ri(I,l),v.appendChild(I))}),pe=!0),c||(pe||It(),1<M.length?(c=Dt,g._showClone(p),g.options.animation&&!Dt&&c&&_e.forEach(function(I){g.addAnimationState({target:I,rect:nt}),I.fromRect=nt,I.thisAnimationDuration=null})):g._showClone(p)))},dragOverAnimationCapture:function(c){var l=c.dragRect,p=c.isOwner,c=c.activeSortable;M.forEach(function(_){_.thisAnimationDuration=null}),c.options.animation&&!p&&c.multiDrag.isMultiDrag&&(nt=i({},l),l=N(V,!0),nt.top-=l.f,nt.left-=l.e)},dragOverAnimationComplete:function(){pe&&(pe=!1,It())},drop:function(a){var l=a.originalEvent,p=a.rootEl,c=a.parentEl,_=a.sortable,g=a.dispatchSortableEvent,v=a.oldIndex,S=a.putSortable,k=S||this.sortable;if(l){var I,j,q,H=this.options,G=c.children;if(!ze)if(H.multiDragKey&&!this.multiDragKeyDown&&this._deselectMultiDrag(),P(V,H.selectedClass,!~M.indexOf(V)),~M.indexOf(V))M.splice(M.indexOf(V),1),ot=null,Je({sortable:_,rootEl:p,name:"deselect",targetEl:V,originalEvent:l});else{if(M.push(V),Je({sortable:_,rootEl:p,name:"select",targetEl:V,originalEvent:l}),l.shiftKey&&ot&&_.el.contains(ot)){var F=J(ot),a=J(V);if(~F&&~a&&F!==a)for(var ee,fe=F<a?(ee=F,a):(ee=a,F+1);ee<fe;ee++)~M.indexOf(G[ee])||(P(G[ee],H.selectedClass,!0),M.push(G[ee]),Je({sortable:_,rootEl:p,name:"select",targetEl:G[ee],originalEvent:l}))}else ot=V;we=k}ze&&this.isMultiDrag&&(pe=!1,(c[ae].options.sort||c!==p)&&1<M.length&&(I=W(V),j=J(V,":not(."+this.options.selectedClass+")"),!at&&H.animation&&(V.thisAnimationDuration=null),k.captureAnimationState(),at||(H.animation&&(V.fromRect=I,M.forEach(function(z){var be;z.thisAnimationDuration=null,z!==V&&(be=pe?W(z):I,z.fromRect=be,k.addAnimationState({target:z,rect:be}))})),It(),M.forEach(function(z){G[j]?c.insertBefore(z,G[j]):c.appendChild(z),j++}),v===J(V)&&(q=!1,M.forEach(function(z){z.sortableIndex!==J(z)&&(q=!0)}),q&&g("update"))),M.forEach(function(z){qt(z)}),k.animateAll()),we=k),(p===c||S&&S.lastPutMode!=="clone")&&_e.forEach(function(z){z.parentNode&&z.parentNode.removeChild(z)})}},nullingGlobal:function(){this.isMultiDrag=ze=!1,_e.length=0},destroyGlobal:function(){this._deselectMultiDrag(),w(document,"pointerup",this._deselectMultiDrag),w(document,"mouseup",this._deselectMultiDrag),w(document,"touchend",this._deselectMultiDrag),w(document,"keydown",this._checkKeyDown),w(document,"keyup",this._checkKeyUp)},_deselectMultiDrag:function(a){if(!(ze!==void 0&&ze||we!==this.sortable||a&&D(a.target,this.options.draggable,this.sortable.el,!1)||a&&a.button!==0))for(;M.length;){var l=M[0];P(l,this.options.selectedClass,!1),M.shift(),Je({sortable:this.sortable,rootEl:this.sortable.el,name:"deselect",targetEl:l,originalEvent:a})}},_checkKeyDown:function(a){a.key===this.options.multiDragKey&&(this.multiDragKeyDown=!0)},_checkKeyUp:function(a){a.key===this.options.multiDragKey&&(this.multiDragKeyDown=!1)}},i(o,{pluginName:"multiDrag",utils:{select:function(a){var l=a.parentNode[ae];l&&l.options.multiDrag&&!~M.indexOf(a)&&(we&&we!==l&&(we.multiDrag._deselectMultiDrag(),we=l),P(a,l.options.selectedClass,!0),M.push(a))},deselect:function(a){var l=a.parentNode[ae],p=M.indexOf(a);l&&l.options.multiDrag&&~p&&(P(a,l.options.selectedClass,!1),M.splice(p,1))}},eventProperties:function(){var a=this,l=[],p=[];return M.forEach(function(c){var _;l.push({multiDragElement:c,index:c.sortableIndex}),_=pe&&c!==V?-1:pe?J(c,":not(."+a.options.selectedClass+")"):J(c),p.push({multiDragElement:c,index:_})}),{items:s(M),clones:[].concat(_e),oldIndicies:l,newIndicies:p}},optionListeners:{multiDragKey:function(a){return(a=a.toLowerCase())==="ctrl"?a="Control":1<a.length&&(a=a.charAt(0).toUpperCase()+a.substr(1)),a}}})}),A})});var wi=Fi((zn,ir)=>{"use strict";function mr(n){return n&&typeof n=="object"&&"default"in n?n.default:n}var br=mr(Wi());function f(n,e){return typeof n=="string"?(e||document).querySelector(n):n||null}f.each=(n,e)=>typeof n=="string"?Array.from((e||document).querySelectorAll(n)):n||null;f.create=(n,e)=>{let t=document.createElement(n);for(let i in e){let r=e[i];if(i==="inside")f(r).appendChild(t);else if(i==="around"){let s=f(r);s.parentNode.insertBefore(t,s),t.appendChild(s)}else i==="styles"?typeof r=="object"&&Object.keys(r).map(s=>{t.style[s]=r[s]}):i in t?t[i]=r:t.setAttribute(i,r)}return t};f.on=(n,e,t,i)=>{i?f.delegate(n,e,t,i):(i=t,f.bind(n,e,i))};f.off=(n,e,t)=>{n.removeEventListener(e,t)};f.bind=(n,e,t)=>{e.split(/\s+/).forEach(function(i){n.addEventListener(i,t)})};f.delegate=(n,e,t,i)=>{n.addEventListener(e,function(r){let s=r.target.closest(t);s&&(r.delegatedTarget=s,i.call(this,r,s))})};f.unbind=(n,e)=>{if(n)for(let t in e){let i=e[t];t.split(/\s+/).forEach(function(r){n.removeEventListener(r,i)})}};f.fire=(n,e,t)=>{let i=document.createEvent("HTMLEvents");i.initEvent(e,!0,!0);for(let r in t)i[r]=t[r];return n.dispatchEvent(i)};f.data=(n,e)=>{if(!e)return n.dataset;for(let t in e)n.dataset[t]=e[t]};f.style=(n,e)=>{if(typeof e=="string")return f.getStyle(n,e);Array.isArray(n)||(n=[n]),n.map(t=>{for(let i in e)t.style[i]=e[i]})};f.removeStyle=(n,e)=>{Array.isArray(n)||(n=[n]),Array.isArray(e)||(e=[e]),n.map(t=>{for(let i of e)t.style[i]=""})};f.getStyle=(n,e)=>{if(!e)return getComputedStyle(n);let t=getComputedStyle(n)[e];return["width","height"].includes(e)&&(t=parseFloat(t)),t};f.closest=(n,e)=>e?e.matches(n)?e:f.closest(n,e.parentNode):null;f.inViewport=(n,e)=>{let{top:t,left:i,bottom:r,right:s}=n.getBoundingClientRect(),{top:d,left:h,bottom:u,right:y}=e.getBoundingClientRect();return t>=d&&i>=h&&r<=u&&s<=y};f.scrollTop=function(e,t){requestAnimationFrame(()=>{e.scrollTop=t})};f.scrollbarSize=function(){return f.scrollBarSizeValue||(f.scrollBarSizeValue=yr()),f.scrollBarSizeValue};function yr(){let n=document.createElement("div");f.style(n,{width:"100px",height:"100px",overflow:"scroll",position:"absolute",top:"-9999px"}),document.body.appendChild(n);let e=n.offsetWidth-n.clientWidth;return document.body.removeChild(n),e}f.hasVerticalOverflow=function(n){return n.scrollHeight>n.offsetHeight+10};f.hasHorizontalOverflow=function(n){return n.scrollWidth>n.offsetWidth+10};f.measureTextWidth=function(n){let e=document.createElement("div");return e.style.position="absolute",e.style.visibility="hidden",e.style.height="auto",e.style.width="auto",e.style.whiteSpace="nowrap",e.innerText=n,document.body.appendChild(e),e.clientWidth+1};function vr(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var Ve=vr,At=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Mt(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function wr(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Cr(n,e){return e={exports:{}},n(e,e.exports),e.exports}var xr=typeof At=="object"&&At&&At.Object===Object&&At,Sr=xr,$r=typeof self=="object"&&self&&self.Object===Object&&self,Rr=Sr||$r||Function("return this")(),gt=Rr,Er=function(){return gt.Date.now()},li=Er,Tr=gt.Symbol,Nt=Tr,Ui=Object.prototype,kr=Ui.hasOwnProperty,Dr=Ui.toString,ht=Nt?Nt.toStringTag:void 0;function Ir(n){var e=kr.call(n,ht),t=n[ht];try{n[ht]=void 0}catch(r){}var i=Dr.call(n);return e?n[ht]=t:delete n[ht],i}var Or=Ir,Ar=Object.prototype,Mr=Ar.toString;function Nr(n){return Mr.call(n)}var Hr=Nr,Lr="[object Null]",jr="[object Undefined]",Bi=Nt?Nt.toStringTag:void 0;function Fr(n){return n==null?n===void 0?jr:Lr:Bi&&Bi in Object(n)?Or(n):Hr(n)}var Ji=Fr;function Pr(n){return n!=null&&typeof n=="object"}var Wr=Pr,Br="[object Symbol]";function qr(n){return typeof n=="symbol"||Wr(n)&&Ji(n)==Br}var zr=qr,qi=0/0,Vr=/^\s+|\s+$/g,Yr=/^[-+]0x[0-9a-f]+$/i,Xr=/^0b[01]+$/i,Kr=/^0o[0-7]+$/i,Gr=parseInt;function Ur(n){if(typeof n=="number")return n;if(zr(n))return qi;if(Ve(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=Ve(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=n.replace(Vr,"");var t=Xr.test(n);return t||Kr.test(n)?Gr(n.slice(2),t?2:8):Yr.test(n)?qi:+n}var zi=Ur,Jr="Expected a function",Qr=Math.max,Zr=Math.min;function es(n,e,t){var i,r,s,d,h,u,y=0,m=!1,b=!1,R=!0;if(typeof n!="function")throw new TypeError(Jr);e=zi(e)||0,Ve(t)&&(m=!!t.leading,b="maxWait"in t,s=b?Qr(zi(t.maxWait)||0,e):s,R="trailing"in t?!!t.trailing:R);function x(N){var ne=i,oe=r;return i=r=void 0,y=N,d=n.apply(oe,ne),d}function C(N){return y=N,h=setTimeout(D,e),m?x(N):d}function w(N){var ne=N-u,oe=N-y,W=e-ne;return b?Zr(W,s-oe):W}function O(N){var ne=N-u,oe=N-y;return u===void 0||ne>=e||ne<0||b&&oe>=s}function D(){var N=li();if(O(N))return B(N);h=setTimeout(D,w(N))}function B(N){return h=void 0,R&&i?x(N):(i=r=void 0,d)}function Y(){h!==void 0&&clearTimeout(h),y=0,i=u=r=h=void 0}function P(){return h===void 0?d:B(li())}function E(){var N=li(),ne=O(N);if(i=arguments,r=this,u=N,ne){if(h===void 0)return C(u);if(b)return h=setTimeout(D,e),x(u)}return h===void 0&&(h=setTimeout(D,e)),d}return E.cancel=Y,E.flush=P,E}var Qi=es,ts="Expected a function";function is(n,e,t){var i=!0,r=!0;if(typeof n!="function")throw new TypeError(ts);return Ve(t)&&(i="leading"in t?!!t.leading:i,r="trailing"in t?!!t.trailing:r),Qi(n,e,{leading:i,maxWait:e,trailing:r})}var rs=is,ss="[object AsyncFunction]",os="[object Function]",ns="[object GeneratorFunction]",as="[object Proxy]";function ls(n){if(!Ve(n))return!1;var e=Ji(n);return e==os||e==ns||e==ss||e==as}var ds=ls,hs=gt["__core-js_shared__"],di=hs,Vi=function(){var n=/[^.]+$/.exec(di&&di.keys&&di.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function cs(n){return!!Vi&&Vi in n}var ps=cs,us=Function.prototype,_s=us.toString;function fs(n){if(n!=null){try{return _s.call(n)}catch(e){}try{return n+""}catch(e){}}return""}var gs=fs,ms=/[\\^$.*+?()[\]{}|]/g,bs=/^\[object .+?Constructor\]$/,ys=Function.prototype,vs=Object.prototype,ws=ys.toString,Cs=vs.hasOwnProperty,xs=RegExp("^"+ws.call(Cs).replace(ms,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Ss(n){if(!Ve(n)||ps(n))return!1;var e=ds(n)?xs:bs;return e.test(gs(n))}var $s=Ss;function Rs(n,e){return n==null?void 0:n[e]}var Es=Rs;function Ts(n,e){var t=Es(n,e);return $s(t)?t:void 0}var vi=Ts,ks=vi(Object,"create"),ft=ks;function Ds(){this.__data__=ft?ft(null):{},this.size=0}var Is=Ds;function Os(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}var As=Os,Ms="__lodash_hash_undefined__",Ns=Object.prototype,Hs=Ns.hasOwnProperty;function Ls(n){var e=this.__data__;if(ft){var t=e[n];return t===Ms?void 0:t}return Hs.call(e,n)?e[n]:void 0}var js=Ls,Fs=Object.prototype,Ps=Fs.hasOwnProperty;function Ws(n){var e=this.__data__;return ft?e[n]!==void 0:Ps.call(e,n)}var Bs=Ws,qs="__lodash_hash_undefined__";function zs(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=ft&&e===void 0?qs:e,this}var Vs=zs;function Xe(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var i=n[e];this.set(i[0],i[1])}}Xe.prototype.clear=Is;Xe.prototype.delete=As;Xe.prototype.get=js;Xe.prototype.has=Bs;Xe.prototype.set=Vs;var Yi=Xe;function Ys(){this.__data__=[],this.size=0}var Xs=Ys;function Ks(n,e){return n===e||n!==n&&e!==e}var Gs=Ks;function Us(n,e){for(var t=n.length;t--;)if(Gs(n[t][0],e))return t;return-1}var Lt=Us,Js=Array.prototype,Qs=Js.splice;function Zs(n){var e=this.__data__,t=Lt(e,n);if(t<0)return!1;var i=e.length-1;return t==i?e.pop():Qs.call(e,t,1),--this.size,!0}var eo=Zs;function to(n){var e=this.__data__,t=Lt(e,n);return t<0?void 0:e[t][1]}var io=to;function ro(n){return Lt(this.__data__,n)>-1}var so=ro;function oo(n,e){var t=this.__data__,i=Lt(t,n);return i<0?(++this.size,t.push([n,e])):t[i][1]=e,this}var no=oo;function Ke(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var i=n[e];this.set(i[0],i[1])}}Ke.prototype.clear=Xs;Ke.prototype.delete=eo;Ke.prototype.get=io;Ke.prototype.has=so;Ke.prototype.set=no;var ao=Ke,lo=vi(gt,"Map"),ho=lo;function co(){this.size=0,this.__data__={hash:new Yi,map:new(ho||ao),string:new Yi}}var po=co;function uo(n){var e=typeof n;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?n!=="__proto__":n===null}var _o=uo;function fo(n,e){var t=n.__data__;return _o(e)?t[typeof e=="string"?"string":"hash"]:t.map}var jt=fo;function go(n){var e=jt(this,n).delete(n);return this.size-=e?1:0,e}var mo=go;function bo(n){return jt(this,n).get(n)}var yo=bo;function vo(n){return jt(this,n).has(n)}var wo=vo;function Co(n,e){var t=jt(this,n),i=t.size;return t.set(n,e),this.size+=t.size==i?0:1,this}var xo=Co;function Ge(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var i=n[e];this.set(i[0],i[1])}}Ge.prototype.clear=po;Ge.prototype.delete=mo;Ge.prototype.get=yo;Ge.prototype.has=wo;Ge.prototype.set=xo;var So=Ge,$o="__lodash_hash_undefined__";function Ro(n){return this.__data__.set(n,$o),this}var Eo=Ro;function To(n){return this.__data__.has(n)}var ko=To;function Ht(n){var e=-1,t=n==null?0:n.length;for(this.__data__=new So;++e<t;)this.add(n[e])}Ht.prototype.add=Ht.prototype.push=Eo;Ht.prototype.has=ko;var Do=Ht;function Io(n,e,t,i){for(var r=n.length,s=t+(i?1:-1);i?s--:++s<r;)if(e(n[s],s,n))return s;return-1}var Oo=Io;function Ao(n){return n!==n}var Mo=Ao;function No(n,e,t){for(var i=t-1,r=n.length;++i<r;)if(n[i]===e)return i;return-1}var Ho=No;function Lo(n,e,t){return e===e?Ho(n,e,t):Oo(n,Mo,t)}var jo=Lo;function Fo(n,e){var t=n==null?0:n.length;return!!t&&jo(n,e,0)>-1}var Po=Fo;function Wo(n,e,t){for(var i=-1,r=n==null?0:n.length;++i<r;)if(t(e,n[i]))return!0;return!1}var Bo=Wo;function qo(n,e){return n.has(e)}var zo=qo,Vo=vi(gt,"Set"),hi=Vo;function Yo(){}var Xo=Yo;function Ko(n){var e=-1,t=Array(n.size);return n.forEach(function(i){t[++e]=i}),t}var Zi=Ko,Go=1/0,Uo=hi&&1/Zi(new hi([,-0]))[1]==Go?function(n){return new hi(n)}:Xo,Jo=Uo,Qo=200;function Zo(n,e,t){var i=-1,r=Po,s=n.length,d=!0,h=[],u=h;if(t)d=!1,r=Bo;else if(s>=Qo){var y=e?null:Jo(n);if(y)return Zi(y);d=!1,r=zo,u=new Do}else u=e?[]:h;e:for(;++i<s;){var m=n[i],b=e?e(m):m;if(m=t||m!==0?m:0,d&&b===b){for(var R=u.length;R--;)if(u[R]===b)continue e;e&&u.push(b),h.push(m)}else r(u,b,t)||(u!==h&&u.push(b),h.push(m))}return h}var en=Zo;function tn(n){return n&&n.length?en(n):[]}var rn=tn;function er(n){return n.replace(/([A-Z])/g,e=>`-${e[0].toLowerCase()}`)}function ci(n){return Object.keys(n).map(t=>{let i=er(t),r=n[t];return r===void 0?"":`data-${i}="${r}" `}).join("").trim()}function Xi(n){var e=document.createElement("textarea");e.style.position="fixed",e.style.top=0,e.style.left=0,e.style.width="2em",e.style.height="2em",e.style.padding=0,e.style.border="none",e.style.outline="none",e.style.boxShadow="none",e.style.background="transparent",e.value=n,document.body.appendChild(e),e.select();try{document.execCommand("copy")}catch(t){console.log("Oops, unable to copy")}document.body.removeChild(e)}function sn(n){return!isNaN(n)}var tr=rs,on=Qi;function pt(n,e=null){return(...t)=>new Promise(i=>{setTimeout(()=>{let s=n.apply(e,t);i(s)})})}function Ft(n,e,t){let i=t.reduce((r,s)=>(r[s]={get(){return e[s]}},r),{});Object.defineProperties(n,i)}function nn(n){return n!==void 0||n!==null}function an(n){return!nn(n)}function ut(n){return!isNaN(n)}function ln(n){return Array.isArray(n)?n:[n]}function Ki(n){return rn(n)}function ct(n,e){return n-e}function Gi(n){return n.replace(/<[^>]*>/g,"")}function dn(n,e){return n&&(Object.keys(e).forEach(t=>{let i=new RegExp(`{(${t})}`,"g");n=n.replace(i,e[t])}),n)}function hn(n){if(!n)return"";let e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(n).replace(/[&<>"'`=/]/g,t=>e[t]||t)}var pi=class{constructor(e){this.options=e,this.sortRows=pt(this.sortRows,this),this.switchColumn=pt(this.switchColumn,this),this.removeColumn=pt(this.removeColumn,this),this.options.filterRows=pt(this.options.filterRows,this)}init(e,t){e||(e=this.options.data),t&&(this.options.columns=t),this.data=e,this.rowCount=0,this.columns=[],this.rows=[],this.prepareColumns(),this.validateData(this.data),this.rows=this.prepareRows(this.data),this.prepareTreeRows(),this.prepareRowView(),this.prepareNumericColumns()}get currentSort(){return this.columns.find(t=>t.sortOrder!=="none")||{colIndex:-1,sortOrder:"none"}}prepareColumns(){this.columns=[],this.validateColumns(),this.prepareDefaultColumns(),this.prepareHeader()}prepareDefaultColumns(){if(this.options.checkboxColumn&&!this.hasColumnById("_checkbox")){let e={id:"_checkbox",content:this.getCheckboxHTML(),editable:!1,resizable:!1,sortable:!1,focusable:!1,dropdown:!1,width:32};this.columns.push(e)}if(this.options.serialNoColumn&&!this.hasColumnById("_rowIndex")){let e={id:"_rowIndex",content:"",align:"center",editable:!1,resizable:!1,focusable:!1,dropdown:!1};this.options.data.length>1e3&&(e.resizable=!0),this.columns.push(e)}}prepareHeader(){let e=this.columns.concat(this.options.columns),t={isHeader:1,editable:!0,sortable:!0,resizable:!0,focusable:!0,dropdown:!0,width:null,format:i=>i==null?"":i+""};this.columns=e.map((i,r)=>this.prepareCell(i,r)).map(i=>Object.assign({},t,i)).map(i=>(i.content=i.content||i.name||"",i.id=i.id||i.content,i))}prepareCell(e,t){let i={content:"",sortOrder:"none",colIndex:t,column:this.columns[t]};return e!==null&&typeof e=="object"?Object.assign(i,e):i.content=e,i}prepareNumericColumns(){let e=this.getRow(0);!e||(this.columns=this.columns.map((t,i)=>{let r=e[i].content;return!t.align&&sn(r)&&(t.align="right"),t}))}prepareRows(e){return e.map((t,i)=>{let r=this._getNextRowCount(),s=[],d={rowIndex:r};if(Array.isArray(t))for(this.options.checkboxColumn&&s.push(this.getCheckboxHTML()),this.options.serialNoColumn&&s.push(r+1+""),s=s.concat(t);s.length<this.columns.length;)s.push("");else{for(let h of this.columns)h.id==="_checkbox"?s.push(this.getCheckboxHTML()):h.id==="_rowIndex"?s.push(r+1+""):s.push(t[h.id]);d.indent=t.indent||0}return this.prepareRow(s,d)})}prepareTreeRows(){this.rows.forEach((e,t)=>{if(ut(e.meta.indent)){let i=this.getRow(t+1);e.meta.isLeaf=!i||an(i.meta.indent)||i.meta.indent<=e.meta.indent,e.meta.isTreeNodeClose=!1}})}prepareRowView(){this.rowViewOrder=this.rows.map(e=>e.meta.rowIndex)}prepareRow(e,t){return e=e.map((i,r)=>this.prepareCell(i,r)).map(i=>(i.rowIndex==null&&(i.rowIndex=t.rowIndex),i.indent==null&&(i.indent=t.indent),i)),e.meta=t,e}validateColumns(){let e=this.options.columns;if(!Array.isArray(e))throw new _t("`columns` must be an array");e.forEach((t,i)=>{if(typeof t!="string"&&typeof t!="object")throw new _t(`column "${i}" must be a string or an object`)})}validateData(e){if(Array.isArray(e)&&(e.length===0||Array.isArray(e[0])||typeof e[0]=="object"))return!0;throw new _t("`data` must be an array of arrays or objects")}appendRows(e){this.validateData(e),this.rows=this.rows.concat(this.prepareRows(e)),this.prepareTreeRows(),this.prepareRowView()}sortRows(e,t="none"){e=+e,this.getColumns().map(i=>{i.colIndex===e?i.sortOrder=t:i.sortOrder="none"}),this._sortRows(e,t)}_sortRows(e,t){if(this.currentSort.colIndex===e&&(this.currentSort.sortOrder==="asc"&&t==="desc"||this.currentSort.sortOrder==="desc"&&t==="asc")){this.reverseArray(this.rowViewOrder),this.currentSort.sortOrder=t;return}if(this.rowViewOrder.sort((i,r)=>{let s=i,d=r,h=this.getCell(e,i).content,u=this.getCell(e,r).content;if(h=h==null?"":h,u=u==null?"":u,t==="none")return s-d;if(t==="asc"){if(h<u)return-1;if(h>u)return 1;if(h===u)return 0}else if(t==="desc"){if(h<u)return 1;if(h>u)return-1;if(h===u)return 0}return 0}),this.hasColumnById("_rowIndex")){let i=this.getColumnIndexById("_rowIndex");this.rows.forEach((r,s)=>{let d=this.rowViewOrder.indexOf(s),h=r[i];h.content=d+1+""})}}reverseArray(e){let t=null,i=null,r=e.length;for(t=0,i=r-1;t<i;t+=1,i-=1){let s=e[t];e[t]=e[i],e[i]=s}}switchColumn(e,t){let i=this.columns[e];this.columns[e]=this.columns[t],this.columns[t]=i,this.columns[e].colIndex=e,this.columns[t].colIndex=t,this.rows.forEach(r=>{let s=Object.assign({},r[e],{colIndex:t}),d=Object.assign({},r[t],{colIndex:e});r[t]=s,r[e]=d})}removeColumn(e){e=+e;let t=r=>r.colIndex!==e,i=(r,s)=>Object.assign({},r,{colIndex:s});this.columns=this.columns.filter(t).map(i),this.rows.forEach(r=>{r.splice(e,1),r.forEach((s,d)=>{s.colIndex=d})})}updateRow(e,t){e.length<this.columns.length&&(this.hasColumnById("_rowIndex")&&(e=[t+1+""].concat(e)),this.hasColumnById("_checkbox")&&(e=['<input type="checkbox" />'].concat(e)));let i=this.prepareRow(e,{rowIndex:t}),r=this.rows.findIndex(s=>s[0].rowIndex===t);return this.rows[r]=i,i}updateCell(e,t,i){let r;typeof e=="object"&&(r=e,e=r.colIndex,t=r.rowIndex,i=r),r=this.getCell(e,t);for(let s in i){let d=i[s];d!==void 0&&(r[s]=d)}return r}updateColumn(e,t){let i=this.getColumn(e);for(let r in t){let s=t[r];s!==void 0&&(i[r]=s)}return i}filterRows(e){return this.options.filterRows(this.rows,e,this).then(t=>(t||(t=this.getAllRowIndices()),t.then||(t=Promise.resolve(t)),t.then(i=>(this._filteredRows=i,{rowsToHide:this.getAllRowIndices().filter(s=>!i.includes(s)),rowsToShow:i}))))}getFilteredRowIndices(){return this._filteredRows||this.getAllRowIndices()}getAllRowIndices(){return this.rows.map(e=>e.meta.rowIndex)}getRowCount(){return this.rowCount}_getNextRowCount(){let e=this.rowCount;return this.rowCount++,e}getRows(e,t){return this.rows.slice(e,t)}getRowsForView(e,t){return this.rowViewOrder.map(r=>this.rows[r]).slice(e,t)}getColumns(e){let t=this.columns;return e&&(t=t.slice(this.getStandardColumnCount())),t}getStandardColumnCount(){return this.options.checkboxColumn&&this.options.serialNoColumn?2:this.options.checkboxColumn||this.options.serialNoColumn?1:0}getColumnCount(e){let t=this.columns.length;return e&&(t=t-this.getStandardColumnCount()),t}getColumn(e){return e=+e,e<0&&(e=this.columns.length+e),this.columns.find(t=>t.colIndex===e)}getColumnById(e){return this.columns.find(t=>t.id===e)}getRow(e){return e=+e,this.rows[e]}getCell(e,t){return t=+t,e=+e,this.getRow(t)[e]}getChildren(e){e=+e;let t=this.getRow(e).meta.indent,i=[];for(let r=e+1;r<this.rowCount;r++){let s=this.getRow(r);if(!isNaN(s.meta.indent)&&(s.meta.indent>t&&i.push(r),s.meta.indent===t))break}return i}getImmediateChildren(e){e=+e;let t=this.getRow(e).meta.indent,i=[],r=t+1;for(let s=e+1;s<this.rowCount;s++){let d=this.getRow(s);if(!(isNaN(d.meta.indent)||d.meta.indent>r)&&(d.meta.indent===r&&i.push(s),d.meta.indent===t))break}return i}get(){return{columns:this.columns,rows:this.rows}}getData(e){return this.data[e]}hasColumn(e){return Boolean(this.columns.find(t=>t.content===e))}hasColumnById(e){return Boolean(this.columns.find(t=>t.id===e))}getColumnIndex(e){return this.columns.findIndex(t=>t.content===e)}getColumnIndexById(e){return this.columns.findIndex(t=>t.id===e)}getCheckboxHTML(){return'<input type="checkbox" />'}},_t=class extends TypeError{},ui={chevronDown:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg>',chevronRight:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline></svg>'},Ye=class{constructor(e){this.instance=e,Ft(this,this.instance,["wrapper","options","style","header","bodyScrollable","columnmanager","rowmanager","datamanager","keyboard","footer"]),this.bindEvents()}bindEvents(){this.bindFocusCell(),this.bindEditCell(),this.bindKeyboardSelection(),this.bindCopyCellContents(),this.bindMouseEvents(),this.bindTreeEvents()}bindFocusCell(){this.bindKeyboardNav()}bindEditCell(){this.$editingCell=null,f.on(this.bodyScrollable,"dblclick",".dt-cell",(e,t)=>{this.activateEditing(t)}),this.keyboard.on("enter",()=>{this.$focusedCell&&!this.$editingCell?this.activateEditing(this.$focusedCell):this.$editingCell&&this.deactivateEditing()})}bindKeyboardNav(){let e=t=>{if(!this.$focusedCell||this.$editingCell)return!1;let i=this.$focusedCell,{rowIndex:r,colIndex:s}=f.data(i);return t==="left"?i=this.getLeftMostCell$(r):t==="right"?i=this.getRightMostCell$(r):t==="up"?i=this.getTopMostCell$(s):t==="down"&&(i=this.getBottomMostCell$(s)),this.focusCell(i),!0};["left","right","up","down","tab","shift+tab"].map(t=>this.keyboard.on(t,()=>this.focusCellInDirection(t))),["left","right","up","down"].map(t=>this.keyboard.on(`ctrl+${t}`,()=>e(t))),this.keyboard.on("esc",()=>{this.deactivateEditing(!1),this.columnmanager.toggleFilter(!1)}),this.options.inlineFilters&&(this.keyboard.on("ctrl+f",t=>{let i=f.closest(".dt-cell",t.target),{colIndex:r}=f.data(i);return this.activateFilter(r),!0}),f.on(this.header,"focusin",".dt-filter",()=>{this.unfocusCell(this.$focusedCell)}))}bindKeyboardSelection(){let e=t=>{let i=this.getSelectionCursor();return t==="left"?i=this.getLeftCell$(i):t==="right"?i=this.getRightCell$(i):t==="up"?i=this.getAboveCell$(i):t==="down"&&(i=this.getBelowCell$(i)),i};["left","right","up","down"].map(t=>this.keyboard.on(`shift+${t}`,()=>this.selectArea(e(t))))}bindCopyCellContents(){this.keyboard.on("ctrl+c",()=>{let e=this.copyCellContents(this.$focusedCell,this.$selectionCursor),t=this.instance.translate("{count} cells copied",{count:e});e&&this.instance.showToastMessage(t,2)}),this.options.pasteFromClipboard&&this.keyboard.on("ctrl+v",e=>(this.instance.pasteTarget.focus(),setTimeout(()=>{let t=this.instance.pasteTarget.value;this.instance.pasteTarget.value="",this.pasteContentInCell(t)},10),!1))}bindMouseEvents(){let e=null;f.on(this.bodyScrollable,"mousedown",".dt-cell",i=>{e=!0,this.focusCell(f(i.delegatedTarget))}),f.on(this.bodyScrollable,"mouseup",()=>{e=!1}),this.options.showTotalRow&&f.on(this.footer,"click",".dt-cell",i=>{this.focusCell(f(i.delegatedTarget))});let t=i=>{!e||this.selectArea(f(i.delegatedTarget))};f.on(this.bodyScrollable,"mousemove",".dt-cell",tr(t,50))}bindTreeEvents(){f.on(this.bodyScrollable,"click",".dt-tree-node__toggle",(e,t)=>{let i=f.closest(".dt-cell",t),{rowIndex:r}=f.data(i);i.classList.contains("dt-cell--tree-close")?this.rowmanager.openSingleNode(r):this.rowmanager.closeSingleNode(r)})}focusCell(e,{skipClearSelection:t=0,skipDOMFocus:i=0,skipScrollToCell:r=0}={}){if(!e||e===this.$editingCell)return;let{colIndex:s,isHeader:d}=f.data(e);d||this.columnmanager.getColumn(s).focusable===!1||(r||this.scrollToCell(e),this.deactivateEditing(),t||this.clearSelection(),this.$focusedCell&&this.$focusedCell.classList.remove("dt-cell--focus"),this.$focusedCell=e,e.classList.add("dt-cell--focus"),i||e.focus(),this.highlightRowColumnHeader(e))}unfocusCell(e){!e||(e.classList.remove("dt-cell--focus"),this.$focusedCell=null,this.lastHeaders&&this.lastHeaders.forEach(t=>t&&t.classList.remove("dt-cell--highlight")))}highlightRowColumnHeader(e){let{colIndex:t,rowIndex:i}=f.data(e),r=this.datamanager.getColumnIndexById("_rowIndex"),s=`.dt-cell--header-${t}`,d=`.dt-cell--${r}-${i}`;this.lastHeaders&&this.lastHeaders.forEach(y=>y&&y.classList.remove("dt-cell--highlight"));let h=f(s,this.wrapper),u=f(d,this.wrapper);this.lastHeaders=[h,u],this.lastHeaders.forEach(y=>y&&y.classList.add("dt-cell--highlight"))}selectAreaOnClusterChanged(){if(!(this.$focusedCell&&this.$selectionCursor))return;let{colIndex:e,rowIndex:t}=f.data(this.$selectionCursor),i=this.getCell$(e,t);if(!i||i===this.$selectionCursor)return;let r=f.data(this.$focusedCell);this.$focusedCell=this.getCell$(r.colIndex,r.rowIndex),this.selectArea(i)}focusCellOnClusterChanged(){if(!this.$focusedCell)return;let{colIndex:e,rowIndex:t}=f.data(this.$focusedCell),i=this.getCell$(e,t);!i||this.focusCell(i,{skipClearSelection:1,skipDOMFocus:1,skipScrollToCell:1})}selectArea(e){!this.$focusedCell||this._selectArea(this.$focusedCell,e)&&(this.$selectionCursor=e)}_selectArea(e,t){if(e===t)return!1;let i=this.getCellsInRange(e,t);return i?(this.clearSelection(),this._selectedCells=i.map(r=>this.getCell$(...r)),requestAnimationFrame(()=>{this._selectedCells.map(r=>r.classList.add("dt-cell--highlight"))}),!0):!1}getCellsInRange(e,t){let i,r,s,d;if(typeof e=="number")[i,r,s,d]=arguments;else if(typeof e=="object"){if(!(e&&t))return!1;let b=f.data(e),R=f.data(t);i=+b.colIndex,s=+R.colIndex,this.columnmanager.sortState?(this.sortedColumn=!0,r=this.datamanager.rowViewOrder.indexOf(parseInt(b.rowIndex,10)),d=this.datamanager.rowViewOrder.indexOf(parseInt(R.rowIndex,10))):(r=+b.rowIndex,d=+R.rowIndex)}if(r>d&&([r,d]=[d,r]),i>s&&([i,s]=[s,i]),this.isStandardCell(i)||this.isStandardCell(s))return!1;let h=[],u=i,y=r,m=[];for(;y<=d;)m.push(y),y+=1;return m.map(b=>{for(;u<=s;)h.push([u,b]),u++;u=i}),this.columnmanager.sortState&&h.forEach(b=>{b[1]=this.datamanager.rowViewOrder[b[1]]}),h}clearSelection(){(this._selectedCells||[]).forEach(e=>e.classList.remove("dt-cell--highlight")),this._selectedCells=[],this.$selectionCursor=null}getSelectionCursor(){return this.$selectionCursor||this.$focusedCell}activateEditing(e){this.focusCell(e);let{rowIndex:t,colIndex:i}=f.data(e),r=this.columnmanager.getColumn(i);if(r&&(r.editable===!1||r.focusable===!1))return;let s=this.getCell(i,t);if(s&&s.editable===!1)return;if(this.$editingCell){let{_rowIndex:u,_colIndex:y}=f.data(this.$editingCell);if(t===u&&i===y)return}this.$editingCell=e,e.classList.add("dt-cell--editing");let d=f(".dt-cell__edit",e);d.innerHTML="";let h=this.getEditor(i,t,s.content,d);h&&(this.currentCellEditor=h,h.initValue(s.content,t,r))}deactivateEditing(e=!0){e&&this.submitEditing(),this.$focusedCell&&this.$focusedCell.focus(),this.$editingCell&&(this.$editingCell.classList.remove("dt-cell--editing"),this.$editingCell=null)}getEditor(e,t,i,r){let s=this.datamanager.getColumn(e),d=this.datamanager.getRow(t),h=this.datamanager.getData(t),u=this.options.getEditor?this.options.getEditor(e,t,i,r,s,d,h):this.getDefaultEditor(r);return u===!1?!1:(u===void 0&&(u=this.getDefaultEditor(r)),u)}getDefaultEditor(e){let t=f.create("input",{class:"dt-input",type:"text",inside:e});return{initValue(i){t.focus(),t.value=i},getValue(){return t.value},setValue(i){t.value=i}}}submitEditing(){let e=Promise.resolve();if(!this.$editingCell)return e;let t=this.$editingCell,{rowIndex:i,colIndex:r}=f.data(t),s=this.datamanager.getColumn(r);if(t){let d=this.currentCellEditor;if(d){let h=d.getValue();h.then||(h=Promise.resolve(h)),e=h.then(u=>{let y=this.getCell(r,i).content;if(y===u)return!1;let m=d.setValue(u,i,s);return this.updateCell(r,i,u,!0),t.focus(),m&&m.then&&m.catch(b=>{console.log(b),this.updateCell(r,i,y)}),m})}}return this.currentCellEditor=null,e}copyCellContents(e,t){if(!t&&e){let{colIndex:d,rowIndex:h,isTotalRow:u}=f.data(e),y="";return u?y=this.$focusedCell.children[0].title:y=this.getCell(d,h).content,Xi(y),1}let i=this.getCellsInRange(e,t);if(!i)return 0;let r=i.map(d=>this.getCell(...d)).reduce((d,h)=>{let u=h.rowIndex;return d[u]=d[u]||[],d[u].push(h.content),d},[]),s=r.map(d=>d.join("	")).join(`
`);return Xi(s),r.reduce((d,h)=>d+h.length,0)}pasteContentInCell(e){if(!this.$focusedCell)return;let t=e.split(`
`).map(d=>d.split("	")).filter(d=>d.length&&d.every(h=>h)),{colIndex:i,rowIndex:r}=f.data(this.$focusedCell),s={colIndex:+i,rowIndex:+r};t.forEach((d,h)=>{let u=h+s.rowIndex;d.forEach((y,m)=>{let b=m+s.colIndex;this.updateCell(b,u,y,!0)})})}activateFilter(e){this.columnmanager.toggleFilter(),this.columnmanager.focusFilter(e),this.columnmanager.isFilterShown||this.$focusedCell&&this.$focusedCell.focus()}updateCell(e,t,i,r=!1){let s=this.datamanager.updateCell(e,t,{content:i});this.refreshCell(s,r)}refreshCell(e,t=!1){let i=f(this.selector(e.colIndex,e.rowIndex),this.bodyScrollable);i.innerHTML=this.getCellContent(e,t)}toggleTreeButton(e,t){let i=this.columnmanager.getFirstColumnIndex(),r=this.getCell$(i,e);r&&r.classList[t?"remove":"add"]("dt-cell--tree-close")}isStandardCell(e){return e<this.columnmanager.getFirstColumnIndex()}focusCellInDirection(e){if(!this.$focusedCell||this.$editingCell&&["left","right","up","down"].includes(e))return!1;this.$editingCell&&["tab","shift+tab"].includes(e)&&this.deactivateEditing();let t=this.$focusedCell;if(e==="left"||e==="shift+tab"?t=this.getLeftCell$(t):e==="right"||e==="tab"?t=this.getRightCell$(t):e==="up"?t=this.getAboveCell$(t):e==="down"&&(t=this.getBelowCell$(t)),!t)return!1;let{colIndex:i}=f.data(t);if(!this.columnmanager.getColumn(i).focusable){let s=this.$focusedCell;this.unfocusCell(s),this.$focusedCell=t;let d=this.focusCellInDirection(e);return d||this.focusCell(s),d}return this.focusCell(t),!0}getCell$(e,t){return f(this.selector(e,t),this.bodyScrollable)}getAboveCell$(e){let{colIndex:t}=f.data(e),i=e.parentElement.previousElementSibling;for(;i&&i.classList.contains("dt-row--hide");)i=i.previousElementSibling;return i?f(`.dt-cell--col-${t}`,i):e}getBelowCell$(e){let{colIndex:t}=f.data(e),i=e.parentElement.nextElementSibling;for(;i&&i.classList.contains("dt-row--hide");)i=i.nextElementSibling;return i?f(`.dt-cell--col-${t}`,i):e}getLeftCell$(e){return e.previousElementSibling}getRightCell$(e){return e.nextElementSibling}getLeftMostCell$(e){return this.getCell$(this.columnmanager.getFirstColumnIndex(),e)}getRightMostCell$(e){return this.getCell$(this.columnmanager.getLastColumnIndex(),e)}getTopMostCell$(e){return this.getCell$(e,this.rowmanager.getFirstRowIndex())}getBottomMostCell$(e){return this.getCell$(e,this.rowmanager.getLastRowIndex())}getCell(e,t){return this.instance.datamanager.getCell(e,t)}getRowHeight(){return f.style(f(".dt-row",this.bodyScrollable),"height")}scrollToCell(e){if(f.inViewport(e,this.bodyScrollable)||f.inViewport(e,this.footer))return!1;let{rowIndex:t}=f.data(e);return this.rowmanager.scrollToRow(t),!1}getRowCountPerPage(){return Math.ceil(this.instance.getViewportHeight()/this.getRowHeight())}getCellHTML(e){let{rowIndex:t,colIndex:i,isHeader:r,isFilter:s,isTotalRow:d}=e,h=ci({rowIndex:t,colIndex:i,isHeader:r,isFilter:s,isTotalRow:d}),u=this.datamanager.getRow(t),y=!(r||s||d);return`
            <div class="${["dt-cell","dt-cell--col-"+i,y?`dt-cell--${i}-${t}`:"",y?"dt-cell--row-"+t:"",r?"dt-cell--header":"",r?`dt-cell--header-${i}`:"",s?"dt-cell--filter":"",y&&u&&u.meta.isTreeNodeClose?"dt-cell--tree-close":""].join(" ")}" ${h} tabindex="0">
                ${this.getCellContent(e)}
            </div>
        `}getCellContent(e,t=!1){let{isHeader:i,isFilter:r,colIndex:s}=e,h=!i&&e.editable!==!1?this.getEditCellHTML(s):"",y=i&&e.sortable!==!1?`<span class="sort-indicator">
                ${this.options.sortIndicator[e.sortOrder]}
            </span>`:"",b=i&&e.resizable!==!1?'<span class="dt-cell__resize-handle"></span>':"",x=i&&e.dropdown!==!1?this.columnmanager.getDropdownHTML():"",C=Ye.getCustomCellFormatter(e),w;if(i||r||!C)w=e.content;else if(!e.html||t){let P=this.datamanager.getRow(e.rowIndex),E=this.datamanager.getData(e.rowIndex);w=C(e.content,P,e.column,E)}else w=e.html;if(e.html=w,this.options.treeView&&!(i||r)&&e.indent!==void 0){let P=this.datamanager.getRow(e.rowIndex+1),E=P&&P.meta.indent>e.indent,N=20,ne="px";if(this.datamanager.getColumnIndexById("_rowIndex")+1===e.colIndex){let W=(e.indent||0)*N,Ae=E?`<span class="dt-tree-node__toggle" style="left: ${W-N}${ne}">
                        <span class="icon-open">${ui.chevronDown}</span>
                        <span class="icon-close">${ui.chevronRight}</span>
                    </span>`:"";w=`<span class="dt-tree-node" style="padding-left: ${W}${ne}">
                    ${Ae}
                    <span>${w}</span>
                </span>`}}let D=`
            <div class="${["dt-cell__content",i?`dt-cell__content--header-${s}`:`dt-cell__content--col-${s}`].join(" ")}">
                ${w}
                ${y}
                ${b}
                ${x}
            </div>
            ${h}
        `,B=document.createElement("div");B.innerHTML=w;let Y=B.textContent;return Y=Y.replace(/\s+/g," ").trim(),D=D.replace(">",` title="${hn(Y)}">`),D}getEditCellHTML(e){return`<div class="dt-cell__edit dt-cell__edit--col-${e}"></div>`}selector(e,t){return`.dt-cell--${e}-${t}`}static getCustomCellFormatter(e){return e.format||e.column&&e.column.format||null}},_i=class{constructor(e){this.instance=e,Ft(this,this.instance,["options","fireEvent","header","datamanager","cellmanager","style","wrapper","rowmanager","bodyScrollable","bodyRenderer"]),this.bindEvents()}renderHeader(){this.header.innerHTML="<div></div>",this.refreshHeader()}refreshHeader(){let e=this.datamanager.getColumns();f("div",this.header).innerHTML=this.getHeaderHTML(e),this.$filterRow=f(".dt-row-filter",this.header),this.$filterRow&&f.style(this.$filterRow,{display:"none"}),this.$columnMap=[],this.bindMoveColumn()}getHeaderHTML(e){let t=this.rowmanager.getRowHTML(e,{isHeader:1});return this.options.inlineFilters&&(t+=this.rowmanager.getRowHTML(e,{isFilter:1})),t}bindEvents(){this.bindDropdown(),this.bindResizeColumn(),this.bindPerfectColumnWidth(),this.bindFilter()}bindDropdown(){let e=".dt-dropdown__toggle",t=".dt-dropdown__list";this.instance.dropdownContainer.innerHTML=this.getDropdownListHTML(),this.$dropdownList=this.instance.dropdownContainer.firstElementChild,f.on(this.header,"click",e,d=>{this.openDropdown(d)});let i=d=>{let h=[e,e+" *",t,t+" *"].join(",");d.target.matches(h)||s()};f.on(document.body,"click",i),document.addEventListener("scroll",s,!0),this.instance.on("onDestroy",()=>{f.off(document.body,"click",i),f.off(document,"scroll",s)}),f.on(this.$dropdownList,"click",".dt-dropdown__list-item",(d,h)=>{if(!this._dropdownActiveColIndex)return;let u=this.options.headerDropdown,{index:y}=f.data(h),m=this._dropdownActiveColIndex,b=u[y].action;b&&b.call(this.instance,this.getColumn(m)),this.hideDropdown()});let r=this;function s(d){r.hideDropdown()}this.hideDropdown()}openDropdown(e){this._dropdownWidth||(f.style(this.$dropdownList,{display:""}),this._dropdownWidth=f.style(this.$dropdownList,"width")),f.style(this.$dropdownList,{display:"",left:e.clientX-this._dropdownWidth+4+"px",top:e.clientY+4+"px"});let t=f.closest(".dt-cell",e.target),{colIndex:i}=f.data(t);this._dropdownActiveColIndex=i}hideDropdown(){f.style(this.$dropdownList,{display:"none"}),this._dropdownActiveColIndex=null}bindResizeColumn(){let e=!1,t,i,r;f.on(this.header,"mousedown",".dt-cell .dt-cell__resize-handle",(h,u)=>{document.body.classList.add("dt-resize"),t=u.parentNode.parentNode;let{colIndex:m}=f.data(t),b=this.getColumn(m);b&&b.resizable===!1||(e=!0,i=f.style(f(".dt-cell__content",t),"width"),r=h.pageX)});let s=h=>{if(document.body.classList.remove("dt-resize"),!t)return;e=!1;let{colIndex:u}=f.data(t);this.setColumnWidth(u),this.style.setBodyStyle(),t=null};f.on(document.body,"mouseup",s),this.instance.on("onDestroy",()=>{f.off(document.body,"mouseup",s)});let d=h=>{if(!e)return;let u=h.pageX-r;this.options.direction==="rtl"&&(u=-1*u);let y=i+u,{colIndex:m}=f.data(t);this.options.minimumColumnWidth>y||(this.datamanager.updateColumn(m,{width:y}),this.setColumnHeaderWidth(m))};f.on(document.body,"mousemove",d),this.instance.on("onDestroy",()=>{f.off(document.body,"mousemove",d)})}bindPerfectColumnWidth(){f.on(this.header,"dblclick",".dt-cell .dt-cell__resize-handle",(e,t)=>{let i=t.parentNode.parentNode,{colIndex:r}=f.data(i),s=this.bodyRenderer.visibleRows.map(w=>w[r]).reduce((w,O)=>w.content.length>O.content.length?w:O),d=this.cellmanager.getCellHTML(s),h=document.createElement("div");h.innerHTML=d;let u=h.querySelector(".dt-cell__content").textContent,{borderLeftWidth:y,borderRightWidth:m,paddingLeft:b,paddingRight:R}=f.getStyle(this.bodyScrollable.querySelector(".dt-cell__content")),x=[y,m,b,R].map(parseFloat).reduce((w,O)=>w+O),C=f.measureTextWidth(u)+x;this.datamanager.updateColumn(r,{width:C}),this.setColumnHeaderWidth(r),this.setColumnWidth(r)})}bindMoveColumn(){if(this.options.disableReorderColumn)return;let e=f(".dt-row",this.header);this.sortable=br.create(e,{onEnd:t=>{let{oldIndex:i,newIndex:r}=t,s=t.item,{colIndex:d}=f.data(s);+d!==r&&this.switchColumn(i,r)},preventOnFilter:!1,filter:".dt-cell__resize-handle, .dt-dropdown",chosenClass:"dt-cell--dragging",animation:150})}sortColumn(e,t){this.instance.freeze(),this.sortRows(e,t).then(()=>(this.refreshHeader(),this.rowmanager.refreshRows())).then(()=>this.instance.unfreeze()).then(()=>{this.fireEvent("onSortColumn",this.getColumn(e)),this.setSortState()})}saveSorting(e){let t=this.getColumn(e),i={[t.name]:{colIndex:e,sortOrder:t.sortOrder}};this.sortingKey=this.options.sortingKey?`${this.options.sortingKey}::sortedColumns`:"sortedColumns",localStorage.setItem(this.sortingKey,JSON.stringify(i))}setSortState(e){e==="none"?this.sortState=!1:this.sortState=!0}removeColumn(e){let t=this.getColumn(e);this.instance.freeze(),this.datamanager.removeColumn(e).then(()=>(this.refreshHeader(),this.rowmanager.refreshRows())).then(()=>this.instance.unfreeze()).then(()=>{this.fireEvent("onRemoveColumn",t)})}switchColumn(e,t){this.instance.freeze(),this.datamanager.switchColumn(e,t).then(()=>(this.refreshHeader(),this.rowmanager.refreshRows())).then(()=>{this.setColumnWidth(e),this.setColumnWidth(t),this.instance.unfreeze()}).then(()=>{this.fireEvent("onSwitchColumn",this.getColumn(e),this.getColumn(t))})}toggleFilter(e){if(!this.options.inlineFilters)return;let t;e===void 0?t=!this.isFilterShown:t=e,t?f.style(this.$filterRow,{display:""}):f.style(this.$filterRow,{display:"none"}),this.isFilterShown=t,this.style.setBodyStyle()}focusFilter(e){if(!this.isFilterShown)return;f(`.dt-cell--col-${e} .dt-filter`,this.$filterRow).focus()}bindFilter(){if(!this.options.inlineFilters)return;let e=t=>{this.applyFilter(this.getAppliedFilters())};f.on(this.header,"keydown",".dt-filter",on(e,300))}applyFilter(e){this.datamanager.filterRows(e).then(({rowsToShow:t})=>{this.rowmanager.showRows(t)})}getAppliedFilters(){let e={};return f.each(".dt-filter",this.header).map(t=>{let i=t.value;i&&(e[t.dataset.colIndex]=i)}),e}applyDefaultSortOrder(){let e=this.getColumns().filter(t=>t.sortOrder!=="none");if(e.length===1){let t=e[0];this.sortColumn(t.colIndex,t.sortOrder)}}applySavedSortOrder(){let e=this.options.sortingKey?`${this.options.sortingKey}::sortedColumns`:"sortedColumns",t=JSON.parse(localStorage.getItem(e));if(t){let i=Object.values(t);for(let r of i)this.sortColumn(r.colIndex,r.sortOrder),this.sortState=!0}}sortRows(e,t){return this.datamanager.sortRows(e,t)}getColumn(e){return this.datamanager.getColumn(e)}getColumns(){return this.datamanager.getColumns()}setColumnWidth(e,t){e=+e;let i=t||this.getColumn(e).width,r=[`.dt-cell__content--col-${e}`,`.dt-cell__edit--col-${e}`].join(", "),s={width:i+"px"};this.style.setStyle(r,s)}setColumnHeaderWidth(e){e=+e,this.$columnMap=this.$columnMap||[];let t=`.dt-cell__content--header-${e}`,{width:i}=this.getColumn(e),r=this.$columnMap[e];r||(r=this.header.querySelector(t),this.$columnMap[e]=r),r.style.width=i+"px"}getColumnMinWidth(e){return e=+e,this.getColumn(e).minWidth||24}getFirstColumnIndex(){return this.datamanager.getColumnIndexById("_rowIndex")+1}getHeaderCell$(e){return f(`.dt-cell--header-${e}`,this.header)}getLastColumnIndex(){return this.datamanager.getColumnCount()-1}getDropdownHTML(){let{dropdownButton:e}=this.options;return`
            <div class="dt-dropdown">
                <div class="dt-dropdown__toggle">${e}</div>
            </div>
      `}getDropdownListHTML(){let{headerDropdown:e}=this.options;return`
        <div class="dt-dropdown__list">
        ${e.map((t,i)=>`
            <div 
                class="dt-dropdown__list-item${t.display?" dt-hidden":""}" 
                data-index="${i}"
            >
                ${t.label}
            </div>
        `).join("")}
        </div>
    `}toggleDropdownItem(e){f(".dt-dropdown__list",this.instance.dropdownContainer).children[e].classList.toggle("dt-hidden")}},fi=class{constructor(e){this.instance=e,Ft(this,this.instance,["options","fireEvent","wrapper","bodyScrollable","bodyRenderer","style"]),this.bindEvents(),this.refreshRows=pt(this.refreshRows,this)}get datamanager(){return this.instance.datamanager}get cellmanager(){return this.instance.cellmanager}bindEvents(){this.bindCheckbox()}bindCheckbox(){!this.options.checkboxColumn||(this.checkMap=[],f.on(this.wrapper,"click",'.dt-cell--col-0 [type="checkbox"]',(e,t)=>{let i=t.closest(".dt-cell"),{rowIndex:r,isHeader:s}=f.data(i),d=t.checked;s?this.checkAll(d):this.checkRow(r,d)}))}refreshRows(){this.instance.renderBody(),this.instance.setDimensions()}refreshRow(e,t){this.datamanager.updateRow(e,t).forEach(r=>{this.cellmanager.refreshCell(r,!0)})}getCheckedRows(){if(!this.checkMap)return[];let e=[];for(let t in this.checkMap)this.checkMap[t]===1&&e.push(t);return e}highlightCheckedRows(){this.getCheckedRows().map(e=>this.checkRow(e,!0))}checkRow(e,t){let i=t?1:0,r=s=>`.dt-cell--0-${s} [type="checkbox"]`;this.checkMap[e]=i,f.each(r(e),this.bodyScrollable).map(s=>{s.checked=t}),this.highlightRow(e,t),this.showCheckStatus(),this.fireEvent("onCheckRow",this.datamanager.getRow(e))}checkAll(e){let t=e?1:0;e?this.datamanager._filteredRows?this.datamanager._filteredRows.forEach(i=>{this.checkRow(i,e)}):this.checkMap=Array.from(Array(this.getTotalRows())).map(i=>t):this.checkMap=[],f.each('.dt-cell--col-0 [type="checkbox"]',this.bodyScrollable).map(i=>{i.checked=e}),this.highlightAll(e),this.showCheckStatus(),this.fireEvent("onCheckRow")}showCheckStatus(){if(!this.options.checkedRowStatus)return;let t=this.getCheckedRows().length;if(t>0){let i=this.instance.translate("{count} rows selected",{count:t});this.bodyRenderer.showToastMessage(i)}else this.bodyRenderer.clearToastMessage()}highlightRow(e,t=!0){let i=this.getRow$(e);if(!!i){if(!t&&this.bodyScrollable.classList.contains("dt-scrollable--highlight-all")){i.classList.add("dt-row--unhighlight");return}t&&i.classList.contains("dt-row--unhighlight")&&i.classList.remove("dt-row--unhighlight"),this._highlightedRows=this._highlightedRows||{},t?(i.classList.add("dt-row--highlight"),this._highlightedRows[e]=i):(i.classList.remove("dt-row--highlight"),delete this._highlightedRows[e])}}highlightAll(e=!0){if(e)this.bodyScrollable.classList.add("dt-scrollable--highlight-all");else{this.bodyScrollable.classList.remove("dt-scrollable--highlight-all");for(let t in this._highlightedRows)this._highlightedRows[t].classList.remove("dt-row--highlight");this._highlightedRows={}}}showRows(e){e=ln(e);let t=e.map(i=>this.datamanager.getRow(i));this.bodyRenderer.renderRows(t)}showAllRows(){let e=this.datamanager.getAllRowIndices();this.showRows(e)}getChildrenToShowForNode(e){let t=this.datamanager.getRow(e);return t.meta.isTreeNodeClose=!1,this.datamanager.getImmediateChildren(e)}openSingleNode(e){let t=this.getChildrenToShowForNode(e),i=this.bodyRenderer.visibleRowIndices,r=Ki([...t,...i]).sort(ct);this.showRows(r)}getChildrenToHideForNode(e){let t=this.datamanager.getRow(e);t.meta.isTreeNodeClose=!0;let i=this.datamanager.getChildren(e);return i.forEach(r=>{let s=this.datamanager.getRow(r);s.meta.isLeaf||(s.meta.isTreeNodeClose=!0)}),i}closeSingleNode(e){let t=this.getChildrenToHideForNode(e),r=this.bodyRenderer.visibleRowIndices.filter(s=>!t.includes(s)).sort(ct);this.showRows(r)}expandAllNodes(){let i=this.datamanager.getRows().filter(d=>!d.meta.isLeaf).map(d=>this.getChildrenToShowForNode(d.meta.rowIndex)).flat(),r=this.bodyRenderer.visibleRowIndices,s=Ki([...i,...r]).sort(ct);this.showRows(s)}collapseAllNodes(){let i=this.datamanager.getRows().filter(d=>d.meta.indent===0).map(d=>this.getChildrenToHideForNode(d.meta.rowIndex)).flat(),s=this.bodyRenderer.visibleRowIndices.filter(d=>!i.includes(d)).sort(ct);this.showRows(s)}setTreeDepth(e){let t=this.datamanager.getRows(),i=t.filter(h=>h.meta.indent<e),r=t.filter(h=>h.meta.indent>=e),s=r.filter(h=>h.meta.indent>e);r.forEach(h=>{h.meta.isLeaf||(h.meta.isTreeNodeClose=!0)}),i.forEach(h=>{h.meta.isLeaf||(h.meta.isTreeNodeClose=!1)});let d=t.filter(h=>!s.includes(h)).map(h=>h.meta.rowIndex).sort(ct);this.showRows(d)}getRow$(e){return f(this.selector(e),this.bodyScrollable)}getTotalRows(){return this.datamanager.getRowCount()}getFirstRowIndex(){return 0}getLastRowIndex(){return this.datamanager.getRowCount()-1}scrollToRow(e){e=+e,this._lastScrollTo=this._lastScrollTo||0;let t=this.getRow$(e);if(f.inViewport(t,this.bodyScrollable))return;let{height:i}=t.getBoundingClientRect(),{top:r,bottom:s}=this.bodyScrollable.getBoundingClientRect(),d=Math.floor((s-r)/i),h=0;e>this._lastScrollTo?h=i*(e+1-d):h=i*(e+1-1),this._lastScrollTo=e,f.scrollTop(this.bodyScrollable,h)}getRowHTML(e,t){let i=ci(t),r=t.rowIndex;return t.isFilter&&(e=e.map(s=>Object.assign({},s,{content:this.getFilterInput({colIndex:s.colIndex,name:s.name}),isFilter:1,isHeader:void 0,editable:!1})),r="filter"),t.isHeader&&(r="header"),`
            <div class="dt-row dt-row-${r}" ${i}>
                ${e.map(s=>this.cellmanager.getCellHTML(s)).join("")}
            </div>
        `}getFilterInput(e){let t=`title="Filter based on ${e.name||"Index"}"`;return`<input class="dt-filter dt-input" type="text" ${ci(e)} tabindex="1"
            ${e.colIndex===0?"disabled":t} />`}selector(e){return`.dt-row-${e}`}},cn=Cr(function(n,e){(function(t){n.exports=t()})(function(){return function t(i,r,s){function d(y,m){if(!r[y]){if(!i[y]){var b=typeof Mt=="function"&&Mt;if(!m&&b)return b(y,!0);if(h)return h(y,!0);var R=new Error("Cannot find module '"+y+"'");throw R.code="MODULE_NOT_FOUND",R}var x=r[y]={exports:{}};i[y][0].call(x.exports,function(C){var w=i[y][1][C];return d(w||C)},x,x.exports,t,i,r,s)}return r[y].exports}for(var h=typeof Mt=="function"&&Mt,u=0;u<s.length;u++)d(s[u]);return d}({1:[function(t,i,r){Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function m(b,R){for(var x=0;x<R.length;x++){var C=R[x];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(b,C.key,C)}}return function(b,R,x){return R&&m(b.prototype,R),x&&m(b,x),b}}();function d(m,b){if(!(m instanceof b))throw new TypeError("Cannot call a class as a function")}var h={width:"100%",height:"100%"},u=function(b){return Number(b)===Number(b)},y=function(){s(m,null,[{key:"create",value:function(R,x){return new m(R,x)}},{key:"mergeStyle",value:function(R,x){for(var C in x)R.style[C]!==x[C]&&(R.style[C]=x[C])}},{key:"getMaxBrowserHeight",value:function(){var R=document.createElement("div"),x=document.createElement("div");m.mergeStyle(R,{position:"absolute",height:"1px",opacity:0}),m.mergeStyle(x,{height:"1e7px"}),R.appendChild(x),document.body.appendChild(R);var C=x.offsetHeight;return document.body.removeChild(R),C}}]);function m(b,R){var x=this;d(this,m),this._config={},this._lastRepaint=null,this._maxElementHeight=m.getMaxBrowserHeight(),this.refresh(b,R);var C=this._config,w=function O(){var D=x._getScrollPosition(),B=x._lastRepaint;if(x._renderAnimationFrame=window.requestAnimationFrame(O),D!==B&&(!B||Math.abs(D-B)>x._averageHeight)){var Y=x._renderChunk();x._lastRepaint=D,Y!==!1&&typeof C.afterRender=="function"&&C.afterRender()}};w()}return s(m,[{key:"destroy",value:function(){window.cancelAnimationFrame(this._renderAnimationFrame)}},{key:"refresh",value:function(R,x){var C=this;if(Object.assign(this._config,h,x),!R||R.nodeType!==1)throw new Error("HyperList requires a valid DOM Node container");this._element=R;var w=this._config,O=this._scroller||w.scroller||document.createElement(w.scrollerTagName||"tr");if(typeof w.useFragment!="boolean"&&(this._config.useFragment=!0),!w.generate)throw new Error("Missing required `generate` function");if(!u(w.total))throw new Error("Invalid required `total` value, expected number");if(!Array.isArray(w.itemHeight)&&!u(w.itemHeight))throw new Error("\n        Invalid required `itemHeight` value, expected number or array\n      ".trim());u(w.itemHeight)?this._itemHeights=Array(w.total).fill(w.itemHeight):this._itemHeights=w.itemHeight,Object.keys(h).filter(function(E){return E in w}).forEach(function(E){var N=w[E],ne=u(N),oe=ne?!1:N.slice(-1)==="%";if(N&&typeof N!="string"&&typeof N!="number"){var W="Invalid optional `"+E+"`, expected string or number";throw new Error(W)}else ne&&(w[E]=N+"px");if(E==="height"){var Ae=ne?N:parseInt(N.replace(/px|%/,""),10);oe?C._containerHeight=window.innerHeight*Ae/100:C._containerHeight=u(N)?N:Ae}});var D={width:""+w.width,height:""+w.height,overflow:"auto",position:"relative"};m.mergeStyle(R,D);var B=w.itemHeight*w.total,Y=this._maxElementHeight;B>Y&&console.warn(["HyperList: The maximum element height",Y+"px has","been exceeded; please reduce your item height."].join(" "));var P={opacity:"0",position:"absolute",width:"1px",height:B+"px"};m.mergeStyle(O,P),this._scroller||R.appendChild(O),this._scroller=O,this._scrollHeight=this._computeScrollHeight(),this._itemPositions=this._itemPositions||Array(w.total).fill(0),this._computePositions(0),this._renderChunk(this._lastRepaint!==null),typeof w.afterRender=="function"&&w.afterRender()}},{key:"_getRow",value:function(R){var x=this._config,C=x.generate(R),w=C.height;if(w!==void 0&&u(w)?(C=C.element,w!==this._itemHeights&&(this._itemHeights[R]=w,this._computePositions(R),this._scrollHeight=this._computeScrollHeight(R))):w=this._itemHeights[R],!C||C.nodeType!==1)throw new Error("Generator did not return a DOM Node for index: "+R);var O=C.getAttribute("class")||"";C.setAttribute("class",O+" "+(x.rowClassName||"vrow"));var D=this._itemPositions[R];return m.mergeStyle(C,{position:"absolute",top:D+"px"}),C}},{key:"_getScrollPosition",value:function(){var R=this._config;return typeof R.overrideScrollPosition=="function"?R.overrideScrollPosition():this._element.scrollTop}},{key:"_renderChunk",value:function(R){var x=this._config,C=this._element,w=this._getScrollPosition(),O=x.total,D=x.reverse?this._getReverseFrom(w):this._getFrom(w)-1;if((D<0||D-this._screenItemsLen<0)&&(D=0),!R&&this._lastFrom===D)return!1;this._lastFrom=D;var B=D+this._cachedItemsLen;(B>O||B+this._cachedItemsLen>O)&&(B=O);var Y=x.useFragment?document.createDocumentFragment():[],P=this._scroller;Y[x.useFragment?"appendChild":"push"](P);for(var E=D;E<B;E++){var N=this._getRow(E);Y[x.useFragment?"appendChild":"push"](N)}if(x.applyPatch)return x.applyPatch(C,Y);C.innerHTML="",C.appendChild(Y)}},{key:"_computePositions",value:function(){var R=arguments.length<=0||arguments[0]===void 0?1:arguments[0],x=this._config,C=x.total,w=x.reverse;R<1&&!w&&(R=1);for(var O=R;O<C;O++)w?O===0?this._itemPositions[0]=this._scrollHeight-this._itemHeights[0]:this._itemPositions[O]=this._itemPositions[O-1]-this._itemHeights[O]:this._itemPositions[O]=this._itemHeights[O-1]+this._itemPositions[O-1]}},{key:"_computeScrollHeight",value:function(){var R=this,x=this._config,C=x.total,w=this._itemHeights.reduce(function(P,E){return P+E},0);m.mergeStyle(this._scroller,{opacity:0,position:"absolute",width:"1px",height:w+"px"});var O=this._itemHeights.slice(0).sort(function(P,E){return P-E}),D=Math.floor(C/2),B=C%2===0?(O[D]+O[D-1])/2:O[D],Y=this._element.clientHeight?this._element.clientHeight:this._containerHeight;return this._screenItemsLen=Math.ceil(Y/B),this._containerHeight=Y,this._cachedItemsLen=Math.max(this._cachedItemsLen||0,this._screenItemsLen*3),this._averageHeight=B,x.reverse&&window.requestAnimationFrame(function(){R._element.scrollTop=w}),w}},{key:"_getFrom",value:function(R){for(var x=0;this._itemPositions[x]<R;)x++;return x}},{key:"_getReverseFrom",value:function(R){for(var x=this._config.total-1;x>0&&this._itemPositions[x]<R+this._containerHeight;)x--;return x}}]),m}();r.default=y,i.exports=r.default},{}]},{},[1])(1)})}),pn=wr(cn),gi=class{constructor(e){this.instance=e,this.options=e.options,this.datamanager=e.datamanager,this.rowmanager=e.rowmanager,this.cellmanager=e.cellmanager,this.bodyScrollable=e.bodyScrollable,this.footer=this.instance.footer,this.log=e.log}renderRows(e){if(this.visibleRows=e,this.visibleRowIndices=e.map(d=>d.meta.rowIndex),this.instance.noData=!1,e.length===0){this.bodyScrollable.innerHTML=this.getNoDataHTML(),this.instance.noData=!0,this.footer.innerHTML="";return}let t=new Set(this.visibleRowIndices),i=this.datamanager.rowViewOrder.map(d=>t.has(d)?d:null).filter(d=>d!==null),r=getComputedStyle(this.bodyScrollable),s={width:r.width,height:r.height,itemHeight:this.options.cellHeight,total:e.length,generate:d=>{let h=document.createElement("div"),u=i[d],y=this.datamanager.getRow(u),m=this.rowmanager.getRowHTML(y,y.meta);return h.innerHTML=m,h.children[0]},afterRender:()=>{this.restoreState()}};this.hyperlist?this.hyperlist.refresh(this.bodyScrollable,s):this.hyperlist=new pn(this.bodyScrollable,s),this.renderFooter()}render(){let e=this.datamanager.getRowsForView();this.renderRows(e),this.instance.setDimensions()}renderFooter(){if(!this.options.showTotalRow)return;let e=this.getTotalRow(),t=this.rowmanager.getRowHTML(e,{isTotalRow:1,rowIndex:"totalRow"});this.footer.innerHTML=t}getTotalRow(){return this.datamanager.getColumns().map(r=>{let s=null;return["_rowIndex","_checkbox"].includes(r.id)&&(s=""),{content:s,isTotalRow:1,colIndex:r.colIndex,column:r}}).map((r,s)=>{if(r.content==="")return r;if(this.options.hooks.columnTotal){let d=this.visibleRows.map(u=>u[s].content),h=this.options.hooks.columnTotal.call(this.instance,d,r);if(h!=null)return r.content=h,r}return r.content=this.visibleRows.reduce((d,h)=>{let u=h[s];return typeof u.content=="number"?(d==null&&(d=0),d+u.content):d},r.content),r})}restoreState(){this.rowmanager.highlightCheckedRows(),this.cellmanager.selectAreaOnClusterChanged(),this.cellmanager.focusCellOnClusterChanged()}showToastMessage(e,t){this.instance.toastMessage.innerHTML=this.getToastMessageHTML(e),t&&setTimeout(()=>{this.clearToastMessage()},t*1e3)}clearToastMessage(){this.instance.toastMessage.innerHTML=""}getNoDataHTML(){let e=window.getComputedStyle(this.instance.header),i=-new DOMMatrixReadOnly(e.transform).m41+this.instance.header.clientWidth,r=this.bodyScrollable.clientHeight;return`
            <div 
                class="dt-scrollable__no-data" 
                style="width: ${i}px; height: ${r}px"
            >
                <div class="dt-scrollable__no-data no-data-message">
                    ${this.options.noDataMessage}
                </div>
            </div>
        `}getToastMessageHTML(e){return`<span class="dt-toast__message">${e}</span>`}},mi=class{constructor(e){this.instance=e,Ft(this,this.instance,["options","datamanager","columnmanager","header","footer","bodyScrollable","datatableWrapper","getColumn","bodyRenderer"]),this.scopeClass="dt-instance-"+e.constructor.instances,e.datatableWrapper.classList.add(this.scopeClass);let t=document.createElement("style");e.wrapper.insertBefore(t,e.datatableWrapper),this.styleEl=t,this.bindResizeWindow(),this.bindScrollHeader()}get stylesheet(){return this.styleEl.sheet}bindResizeWindow(){this.onWindowResize=this.onWindowResize.bind(this),this.onWindowResize=tr(this.onWindowResize,300),this.options.layout==="fluid"&&f.on(window,"resize",this.onWindowResize)}bindScrollHeader(){this._settingHeaderPosition=!1,f.on(this.bodyScrollable,"scroll",e=>{this._settingHeaderPosition||(this._settingHeaderPosition=!0,requestAnimationFrame(()=>{let t=-e.target.scrollLeft;f.style(this.header,{transform:`translateX(${t}px)`}),f.style(this.footer,{transform:`translateX(${t}px)`}),this._settingHeaderPosition=!1,this.instance.noData&&f.style(f(".no-data-message"),{left:`${this.instance.wrapper.clientWidth/2-t}px`}),this._settingHeaderPosition=!1}))})}onWindowResize(){this.distributeRemainingWidth(),this.refreshColumnWidth(),this.setBodyStyle()}destroy(){this.styleEl.remove(),f.off(window,"resize",this.onWindowResize)}setStyle(e,t){if(e.includes(",")){e.split(",").map(d=>d.trim()).forEach(d=>{this.setStyle(d,t)});return}if(e=e.trim(),!e)return;this._styleRulesMap=this._styleRulesMap||{};let i=this._getPrefixedSelector(e);this._styleRulesMap[i]&&(this.removeStyle(e),t=Object.assign({},this._styleRulesMap[i],t));let r=this._getRuleString(t),s=`${i} { ${r} }`;this._styleRulesMap[i]=t,this.stylesheet.insertRule(s)}removeStyle(e){if(e.includes(",")){e.split(",").map(r=>r.trim()).forEach(r=>{this.removeStyle(r)});return}if(e=e.trim(),!e)return;let t=this._getPrefixedSelector(e),i=Array.from(this.stylesheet.cssRules).findIndex(r=>r.selectorText===t);i!==-1&&this.stylesheet.deleteRule(i)}_getPrefixedSelector(e){return`.${this.scopeClass} ${e}`}_getRuleString(e){return Object.keys(e).map(t=>{let i=t;return t.includes("-")||(i=er(t)),`${i}:${e[t]};`}).join("")}setDimensions(){this.setCellHeight(),this.setupMinWidth(),this.setupNaturalColumnWidth(),this.setupColumnWidth(),this.distributeRemainingWidth(),this.setColumnStyle(),this.setBodyStyle()}setCellHeight(){this.setStyle(".dt-cell",{height:this.options.cellHeight+"px"})}setupMinWidth(){f.each(".dt-cell--header",this.header).map(e=>{let{colIndex:t}=f.data(e),i=this.getColumn(t);if(!i.minWidth){let r=f.style(f(".dt-cell__content",e),"width");i.minWidth=r}})}setupNaturalColumnWidth(){!f(".dt-row")||(f.each(".dt-row-header .dt-cell",this.header).map(e=>{let{colIndex:t}=f.data(e),i=this.datamanager.getColumn(t),r=f.style(f(".dt-cell__content",e),"width");typeof r=="number"&&r>=this.options.minimumColumnWidth?i.naturalWidth=r:i.naturalWidth=this.options.minimumColumnWidth}),f.each(".dt-row-0 .dt-cell",this.bodyScrollable).map(e=>{let{colIndex:t}=f.data(e),i=this.datamanager.getColumn(t),r=f.style(f(".dt-cell__content",e),"width");typeof r=="number"&&r>=i.naturalWidth?i.naturalWidth=r:i.naturalWidth=i.naturalWidth}))}setupColumnWidth(){if(this.options.layout==="ratio"){let e=f.style(this.datatableWrapper,"width");if(this.options.serialNoColumn){let r=this.datamanager.getColumnById("_rowIndex");e=e-r.width-1}if(this.options.checkboxColumn){let r=this.datamanager.getColumnById("_checkbox");e=e-r.width-1}let t=this.datamanager.getColumns().map(r=>r.id==="_rowIndex"||r.id==="_checkbox"?0:(r.width||(r.width=1),r.ratioWidth=parseInt(r.width,10),r.ratioWidth)).reduce((r,s)=>r+s),i=e/t;this.datamanager.getColumns().map(r=>{r.id==="_rowIndex"||r.id==="_checkbox"||(r.width=Math.floor(i*r.ratioWidth)-1)})}else this.datamanager.getColumns().map(e=>{e.width||(e.width=e.naturalWidth),e.id==="_rowIndex"&&(e.width=this.getRowIndexColumnWidth()),e.width<this.options.minimumColumnWidth&&(e.width=this.options.minimumColumnWidth)})}distributeRemainingWidth(){if(this.options.layout!=="fluid")return;let e=f.style(this.instance.datatableWrapper,"width"),t=f(".dt-row",this.bodyScrollable),i=e;if(t)i=f.style(t,"width");else{let d=f(".dt-row",this.instance.header);i=Array.from(d.children).map(u=>u.offsetWidth).reduce((u,y)=>u+y,0)}let r=this.datamanager.getColumns().filter(d=>d.resizable),s=(e-i)/r.length;r.map(d=>{let h=f.style(this.getColumnHeaderElement(d.colIndex),"width"),u=Math.floor(h+s)-2;this.datamanager.updateColumn(d.colIndex,{width:u})})}setColumnStyle(){this.datamanager.getColumns().map(e=>{e.align||(e.align="left"),["left","center","right"].includes(e.align)||(e.align="left"),this.setStyle(`.dt-cell--col-${e.colIndex}`,{"text-align":e.align}),this.columnmanager.setColumnHeaderWidth(e.colIndex),this.columnmanager.setColumnWidth(e.colIndex)})}refreshColumnWidth(){this.datamanager.getColumns().map(e=>{this.columnmanager.setColumnHeaderWidth(e.colIndex),this.columnmanager.setColumnWidth(e.colIndex)})}setBodyStyle(){let e=f.style(this.datatableWrapper,"width"),t=f(".dt-row",this.bodyScrollable);if(!t)return;let i=f.style(t,"width"),r=e>i?i+10:e;f.style(this.bodyScrollable,{width:r+"px"}),f.removeStyle(this.bodyScrollable,"height");let s=f.getStyle(this.bodyScrollable,"height"),d=(this.bodyRenderer.hyperlist||{})._scrollHeight||1/0,h=f.hasHorizontalOverflow(this.bodyScrollable),u;d<s&&(u=d,h&&(u+=f.scrollbarSize()),f.style(this.bodyScrollable,{height:u+"px"})),this.bodyScrollable.scrollHeight-this.bodyScrollable.offsetHeight<f.scrollbarSize()&&f.style(this.bodyScrollable,{overflowY:"hidden"}),this.options.layout==="fluid"&&f.style(this.bodyScrollable,{overflowX:"hidden"})}getColumnHeaderElement(e){return e=+e,e<0?null:f(`.dt-cell--col-${e}`,this.header)}getRowIndexColumnWidth(){let e=this.datamanager.getRowCount(),t=22;return f.measureTextWidth(e+"")+t}},un={13:"enter",91:"meta",16:"shift",17:"ctrl",18:"alt",37:"left",38:"up",39:"right",40:"down",9:"tab",27:"esc",67:"c",70:"f",86:"v"},bi=class{constructor(e){this.listeners={},f.on(e,"keydown",this.handler.bind(this))}handler(e){let t=un[e.keyCode];e.shiftKey&&t!=="shift"&&(t="shift+"+t),(e.ctrlKey&&t!=="ctrl"||e.metaKey&&t!=="meta")&&(t="ctrl+"+t);let i=this.listeners[t];if(i&&i.length>0)for(let r of i){let s=r(e);(s===void 0||s===!0)&&e.preventDefault()}}on(e,t){e.split(",").map(r=>r.trim()).map(r=>{this.listeners[r]=this.listeners[r]||[],this.listeners[r].push(t)})}},_n={"Sort Ascending":"Sort Ascending","Sort Descending":"Sort Descending","Reset sorting":"Reset sorting","Remove column":"Remove column","No Data":"No Data","{count} cells copied":{1:"{count} cell copied",default:"{count} cells copied"},"{count} rows selected":{1:"{count} row selected",default:"{count} rows selected"}},fn={"Sort Ascending":"Aufsteigend sortieren","Sort Descending":"Absteigend sortieren","Reset sorting":"Sortierung zur\xFCcksetzen","Remove column":"Spalte entfernen","No Data":"Keine Daten","{count} cells copied":{1:"{count} Zelle kopiert",default:"{count} Zellen kopiert"},"{count} rows selected":{1:"{count} Zeile ausgew\xE4hlt",default:"{count} Zeilen ausgew\xE4hlt"}},gn={"Sort Ascending":"Trier par ordre croissant","Sort Descending":"Trier par ordre d\xE9croissant","Reset sorting":"R\xE9initialiser le tri","Remove column":"Supprimer colonne","No Data":"Pas de donn\xE9es","{count} cells copied":{1:"{count} cellule copi\xE9e",default:"{count} cellules copi\xE9es"},"{count} rows selected":{1:"{count} ligne s\xE9lectionn\xE9e",default:"{count} lignes s\xE9lectionn\xE9es"}},mn={"Sort Ascending":"Ordinamento ascendente","Sort Descending":"Ordinamento decrescente","Reset sorting":"Azzeramento ordinamento","Remove column":"Rimuovi colonna","No Data":"Nessun dato","{count} cells copied":{1:"Copiato {count} cella",default:"{count} celle copiate"},"{count} rows selected":{1:"{count} linea selezionata",default:"{count} linee selezionate"}};function bn(){return{en:_n,de:fn,fr:gn,it:mn}}var yi=class{constructor(e){this.language=e,this.translations=bn()}addTranslations(e){this.translations=Object.assign(this.translations,e)}translate(e,t){let i=this.translations[this.language]&&this.translations[this.language][e]||e;return typeof i=="object"&&(i=t&&t.count?this.getPluralizedTranslation(i,t.count):e),dn(i,t||{})}getPluralizedTranslation(e,t){return e[t]||e.default}};function yn(n,e,t){let i=[];if(Object.keys(e).length===0)return n.map(r=>r.meta.rowIndex);for(let r in e){let s=e[r],h=(i.length?i.map(m=>n[m]):n).map(m=>m[r]),u=wn(s),y=vn(n,t,u);y?i=y(u.text,h):i=h.map(m=>m.rowIndex)}return i}function vn(n,e,t){let i=u=>{let y=Ye.getCustomCellFormatter(u),m=n[u.rowIndex];return e&&e.data&&e.data.length&&(m=e.data[u.rowIndex]),y&&u.content?(u.html=y(u.content,n[u.rowIndex],u.column,m,t),Gi(u.html)):u.content||""},r=u=>String(Gi(u.html||"")||i(u)).toLowerCase(),s=u=>parseFloat(u.content),d=(u,y)=>{if(u.column.compareValue){let b=u.column.compareValue(u,y);if(b&&Array.isArray(b))return b}let m=s(u);return isNaN(m)?[r(u),y]:[m,y]};return{contains(u,y){return y.filter(m=>{let b=(u||"").toLowerCase();return!b||(m.content||"").toLowerCase().includes(b)||r(m).includes(b)}).map(m=>m.rowIndex)},greaterThan(u,y){return y.filter(m=>{let[b,R]=d(m,u);return b>R}).map(m=>m.rowIndex)},lessThan(u,y){return y.filter(m=>{let[b,R]=d(m,u);return b<R}).map(m=>m.rowIndex)},equals(u,y){return y.filter(m=>parseFloat(m.content)===u).map(m=>m.rowIndex)},notEquals(u,y){return y.filter(m=>parseFloat(m.content)!==u).map(m=>m.rowIndex)},range(u,y){return y.filter(m=>{let b=d(m,u[0]),R=d(m,u[1]),x=b[0];return x>=b[1]&&x<=R[1]}).map(m=>m.rowIndex)},containsNumber(u,y){return y.filter(m=>{let b=parseFloat(u,10),R=u,x=s(m),C=r(m);return b===x||C.includes(R)}).map(m=>m.rowIndex)}}[t.type]}function wn(n=""){if(n.length===0)return{};let e=n;return[">","<","="].includes(e[0])?e=n.slice(1):e.startsWith("!=")&&(e=n.slice(2)),n.startsWith(">")&&e?{type:"greaterThan",text:e.trim()}:n.startsWith("<")&&e?{type:"lessThan",text:e.trim()}:n.startsWith("=")&&ut(e)?{type:"equals",text:Number(n.slice(1).trim())}:ut(e)?{type:"containsNumber",text:e}:n.startsWith("!=")&&ut(e)?{type:"notEquals",text:Number(n.slice(2).trim())}:n.split(":").length===2&&n.split(":").every(t=>ut(t.trim()))?(e=n.split(":"),{type:"range",text:e.map(t=>t.trim())}):{type:"contains",text:e.toLowerCase()}}function Cn(n){return{columns:[],data:[],dropdownButton:ui.chevronDown,headerDropdown:[{label:n.translate("Sort Ascending"),action:function(e){this.sortColumn(e.colIndex,"asc")}},{label:n.translate("Sort Descending"),action:function(e){this.sortColumn(e.colIndex,"desc")}},{label:n.translate("Reset sorting"),action:function(e){this.sortColumn(e.colIndex,"none")}},{label:n.translate("Remove column"),action:function(e){this.removeColumn(e.colIndex)}}],events:{onRemoveColumn(e){},onSwitchColumn(e,t){},onSortColumn(e){},onCheckRow(e){},onDestroy(){}},hooks:{columnTotal:null},sortIndicator:{asc:"\u2191",desc:"\u2193",none:""},overrideComponents:{},filterRows:yn,freezeMessage:"",getEditor:null,serialNoColumn:!0,checkboxColumn:!1,clusterize:!0,logs:!1,layout:"fixed",noDataMessage:n.translate("No Data"),cellHeight:40,minimumColumnWidth:30,inlineFilters:!1,treeView:!1,checkedRowStatus:!0,dynamicRowHeight:!1,pasteFromClipboard:!1,showTotalRow:!1,direction:"ltr",disableReorderColumn:!1}}var xn={DataManager:pi,CellManager:Ye,ColumnManager:_i,RowManager:fi,BodyRenderer:gi,Style:mi,Keyboard:bi},je=class{constructor(e,t){if(je.instances++,typeof e=="string"&&(e=document.querySelector(e)),this.wrapper=e,!(this.wrapper instanceof HTMLElement))throw new Error("Invalid argument given for `wrapper`");this.initializeTranslations(t),this.setDefaultOptions(),this.buildOptions(t),this.prepare(),this.initializeComponents(),this.options.data&&(this.refresh(),this.columnmanager.applyDefaultSortOrder(),this.options.saveSorting&&(this.setupSaveSorting(),this.columnmanager.applySavedSortOrder()))}initializeTranslations(e){this.language=e.language||"en",this.translationManager=new yi(this.language),e.translations&&this.translationManager.addTranslations(e.translations)}setDefaultOptions(){this.DEFAULT_OPTIONS=Cn(this)}buildOptions(e){this.options=this.options||{},this.options=Object.assign({},this.DEFAULT_OPTIONS,this.options||{},e),e.headerDropdown=e.headerDropdown||[],this.options.headerDropdown=[...this.DEFAULT_OPTIONS.headerDropdown,...e.headerDropdown],this.events=Object.assign({},this.DEFAULT_OPTIONS.events,this.options.events||{},e.events||{}),this.fireEvent=this.fireEvent.bind(this)}prepare(){this.prepareDom(),this.unfreeze()}initializeComponents(){let e=Object.assign({},xn,this.options.overrideComponents),{Style:t,Keyboard:i,DataManager:r,RowManager:s,ColumnManager:d,CellManager:h,BodyRenderer:u}=e;this.style=new t(this),this.keyboard=new i(this.wrapper),this.datamanager=new r(this.options),this.rowmanager=new s(this),this.columnmanager=new d(this),this.cellmanager=new h(this),this.bodyRenderer=new u(this)}prepareDom(){this.wrapper.innerHTML=`
            <div class="datatable" dir="${this.options.direction}">
                <div class="dt-header"></div>
                <div class="dt-scrollable"></div>
                <div class="dt-footer"></div>
                <div class="dt-freeze">
                    <span class="dt-freeze__message">
                        ${this.options.freezeMessage}
                    </span>
                </div>
                <div class="dt-toast"></div>
                <div class="dt-dropdown-container"></div>
                <textarea class="dt-paste-target"></textarea>
            </div>
        `,this.datatableWrapper=f(".datatable",this.wrapper),this.header=f(".dt-header",this.wrapper),this.footer=f(".dt-footer",this.wrapper),this.bodyScrollable=f(".dt-scrollable",this.wrapper),this.freezeContainer=f(".dt-freeze",this.wrapper),this.toastMessage=f(".dt-toast",this.wrapper),this.pasteTarget=f(".dt-paste-target",this.wrapper),this.dropdownContainer=f(".dt-dropdown-container",this.wrapper)}refresh(e,t){this.datamanager.init(e,t),this.render(),this.setDimensions()}destroy(){this.wrapper.innerHTML="",this.style.destroy(),this.fireEvent("onDestroy")}appendRows(e){this.datamanager.appendRows(e),this.rowmanager.refreshRows()}refreshRow(e,t){this.rowmanager.refreshRow(e,t)}render(){this.renderHeader(),this.renderBody()}renderHeader(){this.columnmanager.renderHeader()}renderBody(){this.bodyRenderer.render()}setDimensions(){this.style.setDimensions()}showToastMessage(e,t){this.bodyRenderer.showToastMessage(e,t)}clearToastMessage(){this.bodyRenderer.clearToastMessage()}getColumn(e){return this.datamanager.getColumn(e)}getColumns(){return this.datamanager.getColumns()}getRows(){return this.datamanager.getRows()}getCell(e,t){return this.datamanager.getCell(e,t)}getColumnHeaderElement(e){return this.columnmanager.getColumnHeaderElement(e)}getViewportHeight(){return this.viewportHeight||(this.viewportHeight=f.style(this.bodyScrollable,"height")),this.viewportHeight}sortColumn(e,t){this.columnmanager.sortColumn(e,t)}saveSorting(e,t){this.columnmanager.saveSorting(e,t)}removeColumn(e){this.columnmanager.removeColumn(e)}scrollToLastColumn(){this.datatableWrapper.scrollLeft=9999}freeze(){f.style(this.freezeContainer,{display:""})}unfreeze(){f.style(this.freezeContainer,{display:"none"})}updateOptions(e){this.buildOptions(e)}fireEvent(e,...t){let i=[...this._internalEventHandlers[e]||[],this.events[e]].filter(Boolean);for(let r of i)r.apply(this,t)}on(e,t){this._internalEventHandlers=this._internalEventHandlers||{},this._internalEventHandlers[e]=this._internalEventHandlers[e]||[],this._internalEventHandlers[e].push(t)}log(){this.options.logs&&console.log.apply(console,arguments)}translate(e,t){return this.translationManager.translate(e,t)}setupSaveSorting(){let e={label:this.translate("Save Sorting"),action:function(t){this.saveSorting(t.colIndex,t.sotOrder)},display:"hidden"};this.options.headerDropdown.push(e),this.columnmanager.bindDropdown(),this.on("onSortColumn",function(t){this.columnmanager.toggleDropdownItem(4),t.sortOrder==="none"&&localStorage.removeItem(this.columnmanager.sortingKey)})}};je.instances=0;var Sn="frappe-datatable",$n="0.0.0-development",Rn="A modern datatable library for the web",En="dist/frappe-datatable.cjs.js",Tn="dist/frappe-datatable.min.js",kn="dist/frappe-datatable.min.js",Dn={start:"yarn run dev",build:"rollup -c && NODE_ENV=production rollup -c",dev:"rollup -c -w","cy:server":"http-server -p 8989","cy:open":"cypress open","cy:run":"cypress run",test:"start-server-and-test cy:server http://localhost:8989 cy:run","test-local":"start-server-and-test cy:server http://localhost:8989 cy:open","travis-deploy-once":"travis-deploy-once","semantic-release":"semantic-release",lint:"eslint src","lint-and-build":"yarn lint && yarn build",commit:"npx git-cz"},In=["dist","src"],On={autoprefixer:"^9.0.0",chai:"3.5.0",cypress:"^9.2.0","cz-conventional-changelog":"^2.1.0",deepmerge:"^2.0.1",eslint:"^5.0.1","eslint-config-airbnb":"^16.1.0","eslint-config-airbnb-base":"^12.1.0","eslint-plugin-import":"^2.11.0","http-server":"^0.11.1",mocha:"3.3.0","postcss-custom-properties":"^7.0.0","postcss-nested":"^3.0.0",rollup:"^0.59.4","rollup-plugin-commonjs":"^8.3.0","rollup-plugin-eslint":"^4.0.0","rollup-plugin-json":"^2.3.0","rollup-plugin-node-resolve":"^3.0.3","rollup-plugin-postcss":"^1.2.8","rollup-plugin-uglify-es":"^0.0.1","semantic-release":"^17.1.1","start-server-and-test":"^1.4.1","travis-deploy-once":"^5.0.1"},An={type:"git",url:"https://github.com/frappe/datatable.git"},Mn=["datatable","data","grid","table"],Nn="Faris Ansari",Hn="MIT",Ln={url:"https://github.com/frappe/datatable/issues"},jn="https://frappe.io/datatable",Fn={hyperlist:"^1.0.0-beta",lodash:"^4.17.5",sortablejs:"^1.7.0"},Pn={commitizen:{path:"cz-conventional-changelog"}},Wn={name:Sn,version:$n,description:Rn,main:En,unpkg:Tn,jsdelivr:kn,scripts:Dn,files:In,devDependencies:On,repository:An,keywords:Mn,author:Nn,license:Hn,bugs:Ln,homepage:jn,dependencies:Fn,config:Pn};je.__version__=Wn.version;ir.exports=je});frappe.views.ReportFactory=class extends frappe.views.Factory{make(e){let t=["List",e[1],"Report"];e[2]&&t.push(e[2]),frappe.set_route(t)}};var Ci=Pi(wi());window.DataTable=Ci.default;frappe.provide("frappe.views");frappe.views.ReportView=class extends frappe.views.ListView{get view_name(){return"Report"}render_header(){}setup_defaults(){super.setup_defaults(),this.page_title=__("Report:")+" "+this.page_title,this.view="Report",this.link_title_doctype_fields=[];let e=frappe.get_route();return e.length===4&&(this.report_name=e[3]),this.report_name?this.get_report_doc().then(t=>{this.report_doc=t,this.report_doc.json=JSON.parse(this.report_doc.json),this.filters=[...Array.isArray(this.report_doc.json.filters)?this.report_doc.json.filters:[],...this.parse_filters_from_route_options()],this.order_by=this.report_doc.json.order_by,this.add_totals_row=this.report_doc.json.add_totals_row,this.page_title=__(this.report_name),this.page_length=this.report_doc.json.page_length||20,this.order_by=this.report_doc.json.order_by||"creation desc",this.chart_args=this.report_doc.json.chart_args}):(this.add_totals_row=this.view_user_settings.add_totals_row||0,this.chart_args=this.view_user_settings.chart_args,this.get_list_view_settings())}setup_view(){this.setup_columns(),super.setup_new_doc_event(),this.setup_events(),this.page.main.parent().addClass("report-view")}setup_events(){var t;let e=this;(t=this.list_view_settings)!=null&&t.disable_auto_refresh||(frappe.realtime.doctype_subscribe(this.doctype),frappe.realtime.on("list_update",i=>this.on_update(i)),this.page.actions_btn_group.on("show.bs.dropdown",()=>{e.toggle_workflow_actions()}))}setup_page(){this.menu_items=this.report_menu_items(),super.setup_page()}toggle_side_bar(){super.toggle_side_bar(),this.render(!0)}setup_result_area(){super.setup_result_area(),this.setup_charts_area(),this.$datatable_wrapper=$('<div class="datatable-wrapper">'),this.$result.append(this.$datatable_wrapper),this.settings.onload&&this.settings.onload(this)}setup_charts_area(){this.$charts_wrapper=$(`<div class="charts-wrapper hidden">
			<div class="text-right"><button class="btn btn-default btn-xs btn-chart-configure"
				style="margin-right: 15px; margin-top: 15px">Configure</button></div>
			<div class="charts-inner-wrapper"></div>
		</div>`),this.$result.append(this.$charts_wrapper),this.$charts_wrapper.find(".btn-chart-configure").on("click",()=>{this.setup_charts()})}setup_paging_area(){super.setup_paging_area();let e=__("For comparison, use >5, <10 or =324. For ranges, use 5:10 (for values between 5 & 10).");this.$paging_area.before(`<span class="comparison-message text-extra-muted">${e}</span>`)}setup_sort_selector(){var e,t,i;this.sort_selector=new frappe.ui.SortSelector({parent:this.filter_area.$filter_list_wrapper,doctype:this.doctype,args:this.order_by,onchange:this.on_sort_change.bind(this)}),this.group_by_control=new frappe.ui.GroupBy(this),(t=(e=this.report_doc)==null?void 0:e.json)!=null&&t.group_by?this.group_by_control.apply_settings(this.report_doc.json.group_by):(i=this.view_user_settings)!=null&&i.group_by&&this.group_by_control.apply_settings(this.view_user_settings.group_by)}get_args(){let e=super.get_args();return delete e.group_by,this.group_by_control.set_args(e),e}before_refresh(){return this.report_doc?Promise.resolve():super.before_refresh()}after_render(){this.report_doc?$.isEmptyObject(this.report_doc.json)||this.set_dirty_state_for_custom_report():this.save_report_settings(),this.group_by||this.init_chart(),this.set_link_title_field_value()}set_link_title_field_value(){Object.keys(this.link_title_doctype_fields).forEach(async e=>{let t=await this.get_link_title_field_value(this.link_title_doctype_fields[e],e);t!==void 0&&document.querySelectorAll(`a[data-name="${e}"]`).forEach(i=>{i.innerHTML=t})})}async get_link_title_field_value(e,t){return frappe.utils.get_link_title(e,t)||await frappe.utils.fetch_link_title(e,t)}set_dirty_state_for_custom_report(){let e={filters:this.filter_area.get(),fields:this.fields,order_by:this.sort_selector.get_sql_string(),add_totals_row:this.add_totals_row,page_length:this.page_length,column_widths:this.get_column_widths(),group_by:this.group_by_control.get_settings(),chart_args:this.get_chart_settings()},t={filters:this.report_doc.json.filters,fields:this.report_doc.json.fields,order_by:this.report_doc.json.order_by,add_totals_row:this.report_doc.json.add_totals_row,page_length:this.report_doc.json.page_length,column_widths:this.report_doc.json.column_widths,group_by:this.report_doc.json.group_by,chart_args:this.report_doc.json.chart_args};frappe.utils.deep_equal(e,t)?this.page.clear_indicator():this.page.set_indicator(__("Not Saved"),"orange")}save_report_settings(){frappe.model.user_settings.save(this.doctype,"last_view",this.view_name),this.report_name||this.save_view_user_settings({fields:this.fields,filters:this.filter_area.get(),order_by:this.sort_selector.get_sql_string(),group_by:this.group_by_control.get_settings(),chart_args:this.get_chart_settings(),add_totals_row:this.add_totals_row})}prepare_data(e){let t=e.message||{};t=frappe.utils.dict(t.keys,t.values),this.start===0?this.data=t:this.data=this.data.concat(t)}render(e){if(this.data.length!==0){if(this.render_count(),this.setup_columns(),this.group_by?this.$charts_wrapper.addClass("hidden"):this.chart&&this.refresh_charts(),this.datatable&&!e){this.datatable.refresh(this.get_data(this.data),this.columns);return}this.setup_datatable(this.data)}}get_count_element(){let e=this.$paging_area.find(".list-count");return e.length||(e=$("<span>").addClass("text-muted list-count").prependTo(this.$paging_area.find(".level-right"))),e}on_update(e){if(this.doctype===e.doctype&&e.name){let t=e.user!==frappe.session.user;this.data.find(i=>i.name===e.name)?frappe.db.get_doc(e.doctype,e.name).then(i=>this.update_row(i,t)):this.refresh()}}update_row(e,t){let i=[];this.data=this.data.map((s,d)=>{if(s.name===e.name){for(let h in s)if(h.includes(":")){let[u,y]=h.split(":"),m=Object.keys(e).filter(b=>Array.isArray(e[b])&&e[b].length&&e[b][0].doctype===u).map(b=>e[b]).map(b=>b[0]).filter(b=>b.name===s[u+":name"])[0];m&&(s[h]=m[y])}else s[h]=e[h];i.push([s,d])}return s});let r=s=>{if(!t)return;let d=this.$result.find(`.dt-row[data-row-index="${s}"]`);d.addClass("row-update"),setTimeout(()=>d.removeClass("row-update"),500)};i.forEach(([s,d])=>{let h=this.build_row(s);this.datatable.refreshRow(h,d),r(d)})}setup_datatable(e){this.$datatable_wrapper.empty(),this.datatable=new Ci.default(this.$datatable_wrapper[0],{columns:this.columns,data:this.get_data(e),getEditor:this.get_editing_object.bind(this),language:frappe.boot.lang,translations:frappe.utils.datatable.get_translations(),checkboxColumn:!0,inlineFilters:!0,cellHeight:35,direction:frappe.utils.is_rtl()?"rtl":"ltr",events:{onRemoveColumn:t=>{this.remove_column_from_datatable(t)},onSwitchColumn:(t,i)=>{this.switch_column(t,i)},onCheckRow:()=>{let t=this.get_checked_items();this.toggle_actions_menu_button(t.length>0)}},hooks:{columnTotal:frappe.utils.report_column_total},headerDropdown:[{label:__("Add Column"),action:t=>{let i=[],r=this.get_columns_for_picker();i=r[this.doctype].filter(d=>!this.is_column_added(d)).map(d=>({label:__(d.label,null,d.parent),value:d.fieldname})),delete r[this.doctype];for(let d in r)r[d].filter(h=>!this.is_column_added(h)).map(h=>({label:__(h.label,null,h.parent)+` (${d})`,value:h.fieldname+","+d})).forEach(h=>i.push(h));let s=new frappe.ui.Dialog({title:__("Add Column"),fields:[{label:__("Select Column"),fieldname:"column",fieldtype:"Autocomplete",options:i},{label:__("Insert Column Before {0}",[__(t.docfield.label).bold()]),fieldname:"insert_before",fieldtype:"Check"}],primary_action:({column:d,insert_before:h})=>{if(!i.map(m=>m.value).includes(d)){frappe.show_alert({message:__("Invalid column"),indicator:"orange"}),s.hide();return}let u=this.doctype;d.includes(",")&&([d,u]=d.split(","));let y=t.colIndex;h&&(y=y-1),this.add_column_to_datatable(d,u,y),s.hide()}});s.show()}}]})}toggle_charts(){if(!this.chart){this.setup_charts();return}this.$charts_wrapper.hasClass("hidden")?(this.$charts_wrapper.removeClass("hidden"),this.refresh_charts()):(this.$charts_wrapper.addClass("hidden"),this.save_view_user_settings({chart_args:null}),this.chart_args=null)}init_chart(){this.chart||this.chart_args&&(this.build_chart_args(this.chart_args.x_axis,this.chart_args.y_axes,this.chart_args.chart_type),this.make_chart())}setup_charts(){let e=[],t=[];for(let s of this.columns)e.push({label:s.content,fieldname:s.id,value:s.id}),s.docfield&&frappe.model.numeric_fieldtypes.includes(s.docfield.fieldtype)&&t.push({label:s.content,fieldname:s.id,value:s.id});let i=this.chart_args||{},r=new frappe.ui.Dialog({title:__("Configure Chart"),fields:[{label:__("X Axis Field"),fieldtype:"Select",fieldname:"x_axis",options:e,default:i.x_axis},{label:__("Y Axis Fields"),fieldtype:"MultiSelect",fieldname:"y_axes",options:t,description:__("Showing only Numeric fields from Report"),default:i.y_axes?i.y_axes.join(", "):null},{label:__("Chart Type"),fieldtype:"Select",options:["Bar","Line","Pie","Percentage","Donut"],fieldname:"chart_type",default:i.chart_type?frappe.utils.to_title_case(i.chart_type):"Bar"}],primary_action:s=>{s.y_axes=s.y_axes.split(",").map(d=>d.trim()).filter(Boolean),this.build_chart_args(s.x_axis,s.y_axes,s.chart_type),this.make_chart(),r.hide()}});r.show()}build_chart_args(e,t,i){let r=t.map(s=>({name:this.columns_map[s].content,values:this.data.map(d=>d[s])}));this.chart_args={chart_type:i.toLowerCase(),x_axis:e,y_axes:t,labels:this.data.map(s=>s[e]),datasets:r},this.save_view_user_settings({chart_args:this.get_chart_settings()})}get_chart_settings(){if(this.chart_args)return{chart_type:this.chart_args.chart_type,x_axis:this.chart_args.x_axis,y_axes:this.chart_args.y_axes}}make_chart(){let e=this.chart_args,t={labels:e.labels,datasets:e.datasets};this.last_chart_type=e.chart_type;let i=r=>this.columns_map[r].docfield;this.$charts_wrapper.removeClass("hidden"),this.chart=new frappe.Chart(this.$charts_wrapper.find(".charts-inner-wrapper")[0],{title:__("{0} Chart",[this.doctype]),data:t,type:e.chart_type,truncateLegends:1,colors:["#70E078","light-blue","orange","red"],axisOptions:{shortenYAxisNumbers:1,numberFormatter:frappe.utils.format_chart_axis_number},tooltipOptions:{formatTooltipY:r=>frappe.format(r,i(this.chart_args.y_axes[0]),{always_show_decimals:!0,inline:!0})}})}refresh_charts(){if(!this.chart||!this.chart_args)return;this.$charts_wrapper.removeClass("hidden");let{x_axis:e,y_axes:t,chart_type:i}=this.chart_args;this.build_chart_args(e,t,i),this.chart.update(this.chart_args)}get_editing_object(e,t,i,r){let s=this.render_editing_input(e,i,r);return s?(s.df.change=()=>s.set_focus(),{initValue:d=>s.set_value(d),setValue:d=>{let h=this.datatable.getCell(e,t),u=this.datatable.getColumn(e).docfield.fieldname,y=h.name,m=h.doctype;return s.set_value(d),this.set_control_value(m,y,u,d).then(b=>{let R=this.data.filter(x=>x.name===b.name).find(x=>m!=b.doctype&&x[m+":name"]==y||m==b.doctype);for(let x in R)if(x.includes(":")){let[C,w]=x.split(":"),O=Object.keys(b).filter(D=>Array.isArray(b[D])&&b[D].length&&b[D][0].doctype===C).map(D=>b[D])[0].filter(D=>D.name===R[C+":name"])[0];O&&(R[x]=O[w])}else R[x]=b[x]}).then(()=>this.refresh_charts())},getValue:()=>s.get_value()}):!1}set_control_value(e,t,i,r){return this.last_updated_doc=t,new Promise((s,d)=>{frappe.db.set_value(e,t,{[i]:r}).then(h=>{h.message?s(h.message):d()}).fail(d)})}render_editing_input(e,t,i){let r=this.datatable.getColumn(e),s=null;if(r.docfield.fieldtype==="Text Editor"){let d=new frappe.ui.Dialog({title:__("Edit {0}",[r.docfield.label]),fields:[r.docfield],primary_action:()=>{this.datatable.cellmanager.deactivateEditing(),d.hide()},on_hide:()=>{this.datatable.cellmanager.deactivateEditing(!1)}});d.show(),s=d.fields_dict[r.docfield.fieldname]}else s=frappe.ui.form.make_control({df:r.docfield,parent:i,render_input:!0}),s.set_value(t),s.toggle_label(!1),s.toggle_description(!1);return s}evaluate_read_only_depends_on(e,t){let i=null;if(typeof e=="boolean")i=e;else if(e.substr(0,5)=="eval:")try{i=frappe.utils.eval(e.substr(5),{doc:t}),parent&&parent.istable&&e.includes("is_submittable")&&(i=!0)}catch(s){frappe.throw(__('Invalid "depends_on" expression'))}else if(e.substr(0,3)=="fn:"&&this.frm)i=this.frm.script_manager.trigger(e.substr(3),this.doctype,this.docname);else{var r=t[e];$.isArray(r)?i=!!r.length:i=!!r}return i}is_editable(e,t){return e&&frappe.model.can_write(this.doctype)&&(t.docstatus!==1||e.allow_on_submit)&&t.docstatus!==2&&!e.read_only&&!e.is_virtual&&!e.hidden&&frappe.model.is_non_std_field(e.fieldname)?this.meta.fields.some(i=>i.fieldtype==="Table")||e.read_only_depends_on&&!this.evaluate_read_only_depends_on(e.read_only_depends_on,t):!1}get_data(e){return this.build_rows(e)}set_fields(){if(["name","docstatus"].map(e=>this._add_field(e)),this.report_name&&this.report_doc.json.fields){this.report_doc.json.fields.slice().forEach(t=>this._add_field(t[0],t[1]));return}else if(this.view_user_settings.fields){this.view_user_settings.fields.forEach(t=>this._add_field(t[0],t[1]));return}this.set_default_fields()}set_default_fields(){this.fields=this.fields||[];let e=i=>this._add_field(i);[this.meta.title_field,this.meta.image_field].map(e);let t=this.meta.fields.filter(i=>(i.in_list_view||i.in_standard_filter)&&frappe.perm.has_perm(this.doctype,i.permlevel,"read")&&frappe.model.is_value_type(i.fieldtype)&&!i.report_hide);t.map(e),t.filter(i=>i.fieldtype==="Currency"&&i.options).map(i=>{i.options.includes(":")?e(i.options.split(":")[1]):e(i.options)}),(this.settings.add_fields||[]).map(e)}build_fields(){super.build_fields()}reorder_fields(){let e=this.columns.map(r=>[r.field,r.docfield.parent]),t=e.filter(r=>this.fields.find(s=>r[0]==s[0]&&r[1]==s[1])),i=this.fields.filter(r=>!e.find(s=>r[0]==s[0]&&r[1]==s[1]));this.fields=[...t,...i]}get_fields(){let e=this.fields.map(i=>{let r=frappe.model.get_full_column_name(i[0],i[1]);return i[1]!==this.doctype&&(r=r+` as '${i[1]}:${i[0]}'`),r}),t=this.get_unique_cdt_in_view().map(i=>frappe.model.get_full_column_name("name",i)+` as '${i}:name'`);return e=e.concat(t),e}get_unique_cdt_in_view(){return this.fields.filter(e=>e[1]!==this.doctype).map(e=>e[1]).uniqBy(e=>e)}add_column_to_datatable(e,t,i){let r=[e,t];this.fields.splice(i,0,r),this.add_currency_column(e,t,i),this.build_fields(),this.setup_columns(),this.datatable&&this.datatable.destroy(),this.datatable=null,this.refresh()}add_currency_column(e,t,i){let r=frappe.meta.get_docfield(t,e);if(r&&r.fieldtype==="Currency"&&r.options&&!r.options.includes(":")&&frappe.meta.has_field(t,r.options)){let s=[r.options,t];i===void 0?this.fields.push(s):this.fields.splice(i,0,s);let d=frappe.meta.get_label(t,s[0]);frappe.show_alert(__("Also adding the dependent currency field {0}",[__(d).bold()]))}}add_status_dependency_column(e,t){if(e&&!this.fields.find(i=>i[0]===e)){let i=[e,t];this.fields.push(i),this.refresh();let r=frappe.meta.get_label(t,i[0]);frappe.show_alert(__("Also adding the status dependency field {0}",[__(r).bold()]))}}remove_column_from_datatable(e){let t=this.fields.findIndex(r=>e.field===r[0]);if(t===-1)return;this.fields[t][0]==="name"&&(this.refresh(),frappe.throw(__("Cannot remove ID field"))),this.fields.splice(t,1),this.build_fields(),this.setup_columns(),this.refresh()}switch_column(e,t){let i=this.fields.findIndex(h=>e.field===h[0]),r=this.fields.findIndex(h=>t.field===h[0]),s=this.fields.slice(),d=s[i];s[i]=s[r],s[r]=d,this.fields=s,this.build_fields(),this.setup_columns(),this.refresh()}get_columns_for_picker(){let e={},t=h=>!frappe.model.no_value_type.includes(h.fieldtype),i=frappe.meta.get_docfields(this.doctype).filter(t),r=frappe.model.std_fields.filter(h=>!["docstatus","_comments"].includes(h.fieldname)),s=!1;return this.data&&(s=frappe.get_indicator(this.data[0],this.doctype)),!frappe.meta.has_field(this.doctype,"status")&&s&&(i=[{label:__("Status"),fieldname:"docstatus",fieldtype:"Data"}].concat(i)),i=[{label:__("ID",null,"Label of name column in report"),fieldname:"name",fieldtype:"Data",reqd:1}].concat(i,r),e[this.doctype]=i,frappe.meta.get_table_fields(this.doctype).forEach(h=>{let u=h.options,y=frappe.meta.get_docfields(u).filter(t);e[u]=y,e[u].push({label:__("Index"),fieldname:"idx",fieldtype:"Int",parent:u})}),e}get_dialog_fields(){let e=[],t=this.get_columns_for_picker();return e.push({label:__(this.doctype),fieldname:this.doctype,fieldtype:"MultiCheck",columns:2,options:t[this.doctype].filter(r=>!r.hidden&&r.fieldname!=="name").map(r=>({label:__(r.label,null,r.parent),value:r.fieldname,checked:this.fields.find(s=>s[0]===r.fieldname&&s[1]===this.doctype)}))}),delete t[this.doctype],frappe.meta.get_table_fields(this.doctype).filter(r=>!r.hidden).forEach(r=>{let s=r.options;e.push({label:__(r.label,null,r.parent)+` (${__(s)})`,fieldname:r.options,fieldtype:"MultiCheck",columns:2,options:t[s].filter(d=>!d.hidden).map(d=>({label:__(d.label,null,d.parent),value:d.fieldname,checked:this.fields.find(h=>h[0]===d.fieldname&&h[1]===s)}))})}),e}is_column_added(e){return Boolean(this.fields.find(t=>t[0]===e.fieldname&&e.parent===t[1]))}setup_columns(){let e=null;this.columns&&(e=this.get_column_widths()),this.columns=[],this.columns_map={};for(let t of this.fields){let i;t[0]!=="docstatus"?i=this.build_column(t):!this.fields.includes(["status",this.doctype])&&!frappe.meta.has_field(this.doctype,"status")&&(i=this.build_column(["docstatus",this.doctype])),i&&(e&&(i.width=e[i.id]||i.width||120),this.columns.push(i),this.columns_map[i.id]=i)}}build_column(e){let[t,i]=e,r=frappe.meta.docfield_map[i||this.doctype][t];if(t==="_aggregate_column"&&(r=this.group_by_control.get_group_by_docfield()),t==="idx"&&i!==this.doctype&&(r={label:"Index",fieldtype:"Int",parent:i}),r||(r=frappe.model.get_std_field(t,!0),r&&(r.label||(r.label=toTitle(t),r.label.includes("_")&&(r.label=r.label.replace("_"," "))),r.parent=this.doctype,t=="name"&&(r.options=this.doctype),t=="docstatus"&&!frappe.meta.has_field(this.doctype,"status")&&(r.label="Status",r.fieldtype="Data",r.name="status"))),!r||r.report_hide)return;let s=__(r.label,null,r.parent);i!==this.doctype&&(s+=` (${__(i)})`);let d=frappe.model.is_non_std_field(t)&&!r.read_only&&!r.is_virtual,h=(()=>frappe.model.is_numeric_field(r)||r.fieldtype==="Date"?"right":"left")(),u=t;i!==this.doctype&&t!=="_aggregate_column"&&(u=`${i}:${t}`);let y=(r?cint(r.width):null)||null;this.report_doc&&(y=(this.report_doc.json.column_widths||{})[u]||y);let m=null;return r.fieldtype==="Date"&&(m=(b,R)=>{if(!b.content||R.length!==10)return null;let x=frappe.datetime.user_to_obj(R);return[+frappe.datetime.str_to_obj(b.content),+x]}),{id:u,field:t,name:s,content:s,docfield:r,width:y,editable:d,align:h,compareValue:m,format:(b,R,x,C)=>{let w=null;return Array.isArray(R)?w=R.reduce((O,D)=>(D.column.docfield&&(D.column.docfield.fieldtype=="Link"&&frappe.boot.link_title_doctypes.includes(D.column.docfield.options)&&(this.link_title_doctype_fields[D.content]=D.column.docfield.options),O[D.column.docfield.fieldname]=D.content),O),{}):w=R,frappe.format(b,x.docfield,{always_show_decimals:!0},w)}}}build_rows(e){let t=e.map(i=>this.build_row(i));if(this.add_totals_row){let i=this.get_columns_totals(e),r=this.columns.map((s,d)=>({name:__("Totals Row"),content:i[s.id],format:h=>{let u=frappe.format(h,s.docfield,{always_show_decimals:!0},e[0]);return d===0?this.format_total_cell(u,s):u}}));t.push(r)}return t}format_total_cell(e,t){let i=__("Totals").bold();return frappe.model.is_numeric_field(t.docfield)&&(i=`<span class="flex justify-between">
				${i} ${$(e).text()}
			</span>`),i}build_row(e){return this.columns.map(t=>{var i;if(t.docfield.parent!==this.doctype){let r=d=>`${t.docfield.parent}:${d}`,s=e[r("name")];return{name:s,doctype:t.docfield.parent,content:e[r(t.field)]||e[t.field],editable:Boolean(s&&this.is_editable(t.docfield,e)),format:d=>frappe.format(d,t.docfield,{always_show_decimals:!0},e)}}if(t.field==="docstatus"&&!frappe.meta.has_field(this.doctype,"status")){let r=frappe.get_indicator(e,this.doctype);if(r){let s=(i=r[2])==null?void 0:i.split(",")[0];return this.add_status_dependency_column(s,this.doctype),{name:e.name,doctype:t.docfield.parent,content:r[0],editable:!1}}else this.remove_column_from_datatable(t)}else if(t.field in e){let r=e[t.field];return{name:e.name,doctype:t.docfield.parent,content:r,editable:this.is_editable(t.docfield,e)}}return{content:""}})}get_checked_items(e){let i=this.datatable.rowmanager.getCheckedRows().map(r=>this.data[r]).filter(r=>r!=null);return e?i.map(r=>r.name):i}clear_checked_items(){this.datatable.rowmanager.checkAll(!1)}save_report(e){let t=i=>{let r={filters:this.filter_area.get(),fields:this.fields,order_by:this.sort_selector.get_sql_string(),add_totals_row:this.add_totals_row,page_length:this.page_length,column_widths:this.get_column_widths(),group_by:this.group_by_control.get_settings(),chart_args:this.get_chart_settings()};return frappe.call({method:"frappe.desk.reportview.save_report",args:{name:i,doctype:this.doctype,report_settings:JSON.stringify(r)},callback:s=>{if(s.exc){frappe.msgprint(__("Report was not saved (there were errors)"));return}if(s.message!=this.report_name){frappe.boot.user.all_reports[s.message]={ref_doctype:this.doctype,report_type:"Report Builder",title:s.message},frappe.set_route("List",this.doctype,"Report",s.message);return}this.report_doc.json=r,this.set_dirty_state_for_custom_report()}})};this.report_name&&e=="save"?t(this.report_name):frappe.prompt({fieldname:"name",label:__("New Report name"),reqd:1,fieldtype:"Data"},i=>{t(i.name)},__("Save As"))}delete_report(){return frappe.call({method:"frappe.desk.reportview.delete_report",args:{name:this.report_name},callback(e){e.exc||window.history.back()}})}get_column_widths(){return this.datatable?this.datatable.datamanager.getColumns(!0).reduce((e,t)=>(e[t.id]=parseInt(t.width),e),{}):{}}get_report_doc(){return new Promise(e=>{frappe.model.with_doc("Report",this.report_name,()=>{e(frappe.get_doc("Report",this.report_name))})})}get_filters_html_for_print(){let e=this.filter_area.get();return`<h5>${__("Filters:")}</h5>`+e.map(t=>{let[i,r,s,d]=t,h=frappe.meta.get_docfield(i,r),u=`<b>${__(frappe.meta.get_label(i,r))}</b>`;switch(s){case"=":return __("{0} is equal to {1}",[u,frappe.format(d,h)]);case"!=":return __("{0} is not equal to {1}",[__(u),frappe.format(d,h)]);case">":return __("{0} is greater than {1}",[__(u),frappe.format(d,h)]);case"<":return __("{0} is less than {1}",[__(u),frappe.format(d,h)]);case">=":return __("{0} is greater than or equal to {1}",[__(u),frappe.format(d,h)]);case"<=":return __("{0} is less than or equal to {1}",[__(u),frappe.format(d,h)]);case"Between":return __("{0} is between {1} and {2}",[__(u),frappe.format(d[0],h),frappe.format(d[1],h)]);case"Timespan":return __("{0} is within {1}",[__(u),__(d)]);case"in":return __("{0} is one of {1}",[__(u),frappe.utils.comma_or(d.map(y=>frappe.format(y,h)))]);case"not in":return __("{0} is not one of {1}",[__(u),frappe.utils.comma_or(d.map(y=>frappe.format(y,h)))]);case"like":return __("{0} is like {1}",[__(u),d]);case"not like":return __("{0} is not like {1}",[__(u),d]);case"is":return d==="set"?__("{0} is set",[__(u)]):__("{0} is not set",[__(u)]);default:return null}}).filter(Boolean).join("<br>")}get_columns_totals(e){if(!this.add_totals_row)return[];let t={};return this.columns.forEach((i,r)=>{let s=e.reduce((d,h)=>{if(i.id in h&&frappe.model.is_numeric_field(i.docfield))return d+=flt(h[i.id]),d},0);t[i.id]=s}),t}report_menu_items(){let e=[{label:__("Show Totals"),action:()=>{this.add_totals_row=!this.add_totals_row,this.save_view_user_settings({add_totals_row:this.add_totals_row}),this.datatable.refresh(this.get_data(this.data))}},{label:__("Print"),action:()=>{let i=this.datatable.datamanager.rowViewOrder.map(r=>{if(this.datatable.bodyRenderer.visibleRowIndices.includes(r))return this.data[r]}).filter(Boolean);if(this.add_totals_row){let r=this.get_columns_totals(this.data);r.name=__("Total"),r.is_total_row=!0,i.push(r)}frappe.ui.get_print_settings(!1,r=>{var s=this.report_name||__(this.doctype);frappe.render_grid({title:s,subtitle:this.get_filters_html_for_print(),print_settings:r,columns:this.columns,data:i,can_use_smaller_font:1})})}},{label:__("Toggle Chart"),action:()=>this.toggle_charts()},{label:__("Toggle Sidebar"),action:()=>this.toggle_side_bar(),shortcut:"Ctrl+K"},{label:__("Pick Columns"),action:()=>{let i=new frappe.ui.Dialog({title:__("Pick Columns"),fields:this.get_dialog_fields(),primary_action:r=>{let s=r[this.doctype].map(d=>[d,this.doctype]);delete r[this.doctype];for(let d in r)s=s.concat(r[d].map(h=>[h,d]));this.fields=[["name",this.doctype],...s],this.fields.map(d=>this.add_currency_column(d[0],d[1])),this.reorder_fields(),this.build_fields(),this.setup_columns(),this.datatable.destroy(),this.datatable=null,this.refresh(),i.hide()}});i.$body.prepend(`
						<div class="columns-search">
							<input type="text" placeholder="${__("Search")}" data-element="search" class="form-control input-xs">
						</div>
					`),frappe.utils.setup_search(i.$body,".unit-checkbox",".label-area"),i.show()}}];frappe.model.can_export(this.doctype)&&e.push({label:__("Export"),action:()=>{let i=this.get_args(),r=this.get_checked_items(!0),s=[];this.list_view_settings.disable_count?s=[{fieldtype:"Check",fieldname:"export_all_rows",label:__("Export all matching rows?")}]:this.total_count>(this.count_without_children||i.page_length)&&(s=[{fieldtype:"Check",fieldname:"export_all_rows",label:__("Export all {0} rows?",[`<b>${this.total_count}</b>`])}]),frappe.boot.lang!=="en"&&s.push({fieldtype:"Check",fieldname:"translate_values",label:__("Translate values"),default:1});let d=frappe.report_utils.get_export_dialog(__(this.doctype),s,h=>{i.cmd="frappe.desk.reportview.export_query",i.file_format_type=h.file_format,i.title=this.report_name||this.doctype,i.translate_values=h.translate_values,h.file_format=="CSV"&&(i.csv_delimiter=h.csv_delimiter,i.csv_quoting=h.csv_quoting,i.csv_decimal_sep=h.csv_decimal_sep),this.add_totals_row&&(i.add_totals_row=1),r.length>0&&(i.selected_items=r),h.export_all_rows?(delete i.start,delete i.page_length):(i.start=0,i.page_length=this.data.length),open_url_post(frappe.request.url,i),d.hide()});d.show()}}),e.push({label:__("Setup Auto Email"),action:()=>{this.report_name?frappe.set_route("List","Auto Email Report",{report:this.report_name}):frappe.msgprint(__("Please save the report first"))}});let t=i=>{let r=i=="delete"?"can_delete":"can_write";return this.report_doc&&this.report_doc.is_standard!=="Yes"&&(frappe.model[r]("Report")||this.report_doc.owner===frappe.session.user)};return t()&&e.push({label:__("Save"),action:()=>this.save_report("save")}),e.push({label:__("Save As"),action:()=>this.save_report("save_as")}),t("delete")&&e.push({label:__("Delete"),action:()=>frappe.confirm("Are you sure you want to delete this report?",()=>this.delete_report()),shortcut:"Shift+Ctrl+D"}),this.report_name&&frappe.user.has_role("System Manager")&&e.push({label:__("User Permissions"),action:()=>{let i={doctype:"Report",name:this.report_name};frappe.set_route("List","User Permission",i)}}),frappe.user.has_role("System Manager")&&this.get_view_settings&&e.push(this.get_view_settings()),e.map(i=>Object.assign(i,{standard:!0}))}get_search_params(){let e=super.get_search_params(),t=this.group_by_control.get_settings();return t&&e.append("_group_by",JSON.stringify([t.group_by,t.aggregate_on,t.aggregate_function])),e}parse_filters_from_route_options(){var e;if((e=frappe.route_options)!=null&&e._group_by)try{let t=JSON.parse(frappe.route_options._group_by);this.group_by_control.apply_settings({group_by:t[0],aggregate_on:t[1],aggregate_function:t[2]}),delete frappe.route_options._group_by}catch(t){console.warn("Failed to parse group by from URL",t)}return super.parse_filters_from_route_options()}};var rr=Pi(wi());window.DataTable=rr.default;frappe.provide("frappe.widget.utils");frappe.provide("frappe.views");frappe.provide("frappe.query_reports");frappe.standard_pages["query-report"]=function(){var n=frappe.container.add_page("query-report");frappe.ui.make_app_page({parent:n,title:__("Query Report"),single_column:!0}),frappe.query_report=new frappe.views.QueryReport({parent:n}),$(n).bind("show",function(){frappe.query_report.show()})};frappe.views.QueryReport=class extends frappe.views.BaseList{show(){this.init().then(()=>this.load())}init(){if(this.init_promise)return this.init_promise;let e=[this.setup_defaults,this.setup_page,this.setup_report_wrapper,this.setup_events].map(t=>t.bind(this));return this.init_promise=frappe.run_serially(e),this.init_promise}setup_defaults(){this.route=frappe.get_route(),this.page_name=frappe.get_route_str(),this.primary_action=null,this.refresh=frappe.utils.throttle(this.refresh,300),this.ignore_prepared_report=!1,this.menu_items=[]}update_url_with_filters(){frappe.get_route_str()==this.page_name&&window.history.replaceState(null,null,this.get_url_with_filters())}get_url_with_filters(){let e=new URLSearchParams;this.prepared_report_name?e.append("prepared_report_name",this.prepared_report_name):Object.entries(this.get_filter_values()).map(([i,r],s)=>{if(Array.isArray(r)){if(!r.length)return"";r=JSON.stringify(r)}e.append(i,r)});let t=window.location.href.replace(window.location.search,"");return e.toString()&&(t+="?"+e.toString()),t}set_default_secondary_action(){this.refresh_button&&this.refresh_button.remove(),this.refresh_button=this.page.add_action_icon("es-line-reload",()=>{this.setup_progress_bar(),this.refresh()},"",__("Reload Report"))}get_no_result_message(){return`<div class="msg-box no-border">
			<svg class="icon icon-xl mb-4" style="stroke: var(--text-light);">
				<use href="#icon-table"></use>
			</svg>
			<p>${__("Nothing to show")}</p>
		</div>`}setup_events(){frappe.realtime.on("report_generated",e=>{if(this.toggle_primary_button_disabled(!1),e.report_name)if(e.name==this.prepared_report_doc_name)this.refresh();else{let t=`Report ${this.report_name} generated.
						<a href="#query-report/${this.report_name}/?prepared_report_name=${e.name}">View</a>`;frappe.show_alert({message:t,indicator:"orange"})}}),this.page.wrapper.on("click","[data-action]",e=>{let t=$(e.currentTarget).data("action"),i=this[t];i.call&&i.call(this,e)})}load(){if(frappe.get_route().length<2){this.toggle_nothing_to_show(!0);return}let e={};e=Object.assign(e,frappe.route_options),this.report_name!==frappe.get_route()[1]?this.load_report(e):frappe.has_route_options()&&this.refresh_report(e)}load_report(e){this.page.clear_inner_toolbar(),this.route=frappe.get_route(),this.page_name=frappe.get_route_str(),this.report_name=this.route[1],this.page_title=__(this.report_name),this.show_save=!1,this.menu_items=this.get_menu_items(),this.datatable=null,this.export_dialog=null,frappe.run_serially([()=>this.get_report_doc(),()=>this.get_report_settings(),()=>this.add_translate_data_checkbox(),()=>this.setup_progress_bar(),()=>this.setup_page_head(),()=>this.refresh_report(e),()=>this.add_chart_buttons_to_toolbar(!0),()=>this.add_card_button_to_toolbar(!0)])}add_card_button_to_toolbar(){!frappe.model.can_create("Number Card")||this.page.add_inner_button(__("Create Card"),()=>{this.add_card_to_dashboard()},__("Actions"))}add_chart_buttons_to_toolbar(e){!frappe.model.can_create("Dashboard Chart")||(e?(this.create_chart_button&&this.create_chart_button.remove(),this.create_chart_button=this.page.add_inner_button(__("Set Chart"),()=>{this.open_create_chart_dialog()},__("Actions")),(this.chart_fields||this.chart_options)&&(this.add_to_dashboard_button&&this.add_to_dashboard_button.remove(),this.add_to_dashboard_button=this.page.add_inner_button(__("Add Chart to Dashboard"),()=>{this.add_chart_to_dashboard()},__("Actions")))):(this.create_chart_button&&this.create_chart_button.remove(),this.add_to_dashboard_button&&this.add_to_dashboard_button.remove()))}add_card_to_dashboard(){let e=frappe.report_utils.get_field_options_from_report(this.columns,this.raw_data),t=frappe.dashboard_utils.get_dashboard_link_field(),i=frappe.boot.developer_mode,r=new frappe.ui.Dialog({title:__("Create Card"),fields:[{fieldname:"report_field",label:__("Field"),fieldtype:"Select",options:e.numeric_fields},{fieldname:"cb_1",fieldtype:"Column Break"},{fieldname:"report_function",label:__("Function"),options:["Sum","Average","Minimum","Maximum"],fieldtype:"Select"},{fieldname:"sb_1",label:__("Add to Dashboard"),fieldtype:"Section Break"},t,{fieldname:"cb_2",fieldtype:"Column Break"},{fieldname:"label",label:__("Card Label"),fieldtype:"Data"}],primary_action_label:__("Add"),primary_action:s=>{s.label||(s.label=`${s.report_function} of ${toTitle(s.report_field)}`),this.create_number_card(s,s.dashboard,s.label,i),r.hide()}});r.show()}add_chart_to_dashboard(){if(this.chart_fields||this.chart_options){let e=frappe.dashboard_utils.get_dashboard_link_field(),t=frappe.boot.developer_mode,i=new frappe.ui.Dialog({title:__("Create Chart"),fields:[{fieldname:"dashboard_chart_name",label:__("Chart Name"),fieldtype:"Data"},e],primary_action_label:__("Add"),primary_action:r=>{this.create_dashboard_chart(this.chart_fields||this.chart_options,r.dashboard,r.dashboard_chart_name,t),i.hide()}});i.show()}else frappe.msgprint(__("Please Set Chart"))}create_number_card(e,t,i,r){let s={dashboard:t||null,type:"Report",report_name:this.report_name,filters_json:JSON.stringify(this.get_filter_values()),set_standard:r};Object.assign(s,e),this.add_to_dashboard("frappe.desk.doctype.number_card.number_card.create_report_number_card",s,t,i,"Number Card")}create_dashboard_chart(e,t,i,r){let s={dashboard:t||null,chart_type:"Report",report_name:this.report_name,type:e.chart_type||frappe.model.unscrub(e.type),color:e.color,filters_json:JSON.stringify(this.get_filter_values()),custom_options:{},set_standard:r};for(let d in e)d!="data"&&(s.custom_options[d]=e[d]);if(this.chart_fields){let d=toTitle(e.x_field),h=toTitle(e.y_fields[0]);i=i||`${this.report_name}: ${d} vs ${h}`,Object.assign(s,{chart_name:i,x_field:e.x_field,y_axis:e.y_axis_fields.map(u=>({y_field:u.y_field,color:u.color})),use_report_chart:0})}else i=i||this.report_name,Object.assign(s,{chart_name:i,use_report_chart:1});this.add_to_dashboard("frappe.desk.doctype.dashboard_chart.dashboard_chart.create_report_chart",s,t,i,"Dashboard Chart")}add_to_dashboard(e,t,i,r,s){frappe.xcall(e,{args:t}).then(()=>{let d;if(i){let h=`<a href="/app/dashboard-view/${i}">${i}</a>`;d=__("New {0} {1} added to Dashboard {2}",[__(s),r,h])}else d=__("New {0} {1} created",[__(s),r]);frappe.msgprint(d,__("New {0} Created",[__(s)]))})}refresh_report(e){return this.prepared_report_name=null,this.toggle_message(!0),this.toggle_report(!1),frappe.run_serially([()=>this.setup_filters(),()=>this._no_refresh=!0,()=>this.set_route_filters(e),()=>this.page.clear_custom_actions(),()=>this.report_settings.onload&&this.report_settings.onload(this),()=>this._no_refresh=!1,()=>this.refresh()])}get_report_doc(){return frappe.model.with_doc("Report",this.report_name).then(e=>{this.report_doc=e}).then(()=>{var e;return frappe.model.with_doctype((e=this.report_doc)==null?void 0:e.ref_doctype)})}get_report_settings(){return new Promise((e,t)=>{frappe.query_reports[this.report_name]?(this.report_settings=frappe.query_reports[this.report_name],e()):frappe.xcall("frappe.desk.query_report.get_script",{report_name:this.report_name}).then(i=>{frappe.dom.eval(i.script||""),frappe.after_ajax(()=>{this.report_settings=this.get_local_report_settings(i.custom_report_name),this.report_settings.html_format=i.html_format,this.report_settings.execution_time=i.execution_time||0,frappe.query_reports[this.report_name]=this.report_settings,this.report_doc.filters&&!this.report_settings.filters&&(this.report_settings.filters=this.report_doc.filters),e()})}).catch(t)})}get_local_report_settings(e){let t=this.report_doc.report_type==="Custom Report"?e||this.report_doc.reference_report:this.report_name;return frappe.query_reports[t]||{}}setup_progress_bar(){var i;let e=0,t=((i=this.report_settings)==null?void 0:i.execution_time)||0;t<5||(this.interval=setInterval(function(){e+=1,frappe.show_progress(__("Preparing Report"),e,t)},1e3))}refresh_filters_dependency(){this.filters.forEach(e=>{e.guardian_has_value=!0,e.df.depends_on&&(e.guardian_has_value=this.evaluate_depends_on_value(e.df.depends_on,e.df.label),e.guardian_has_value?e.df.hidden_due_to_dependency&&(e.df.hidden_due_to_dependency=!1,this.toggle_filter_display(e.df.fieldname,!1)):e.df.hidden_due_to_dependency||(e.df.hidden_due_to_dependency=!0,this.toggle_filter_display(e.df.fieldname,!0),e.set_value(e.df.default||null)))})}evaluate_depends_on_value(e,t){let i=null,r=this.get_filter_values();if(r)if(typeof e=="boolean")i=e;else if(e.substr(0,5)=="eval:")try{i=frappe.utils.eval(e.substr(5),{doc:r})}catch(d){frappe.throw(__('Invalid "depends_on" expression set in filter {0}',[t]))}else{var s=r[e];$.isArray(s)?i=!!s.length:i=!!s}return i}setup_filters(){this.clear_filters();let{filters:e=[]}=this.report_settings,t=this.page.page_form;this.filters=[],this.report_settings.seperate_check_filters&&this.setup_check_filter_area(),this.filters=e.map((i,r)=>{if(i.fieldtype==="Break")return;let s;return i.fieldtype==="Check"&&this.check_filter_area?s=this.page.add_field(i,this.check_filter_area):s=this.page.add_field(i,t),i.default&&s.set_input(i.default),i.get_query&&(s.get_query=i.get_query),i.on_change&&(s.on_change=i.on_change),i.onchange=()=>{this.refresh_filters_dependency();let d=this.get_filter_values();this.previous_filters&&JSON.stringify(this.previous_filters)===JSON.stringify(d)||(this.previous_filters=d,setTimeout(()=>this.previous_filters=null,1e4),s.on_change?s.on_change(this):this._no_refresh||this.refresh(!0))},s=Object.assign(s,i),s}).filter(Boolean),this.report_settings.seperate_check_filters&&this.move_check_filter_area(),this.report_settings.collapsible_filters&&(this.filters_hidden=!0,this.filter_row_length=this.get_filter_row_length(),this.add_collapse_button(),this.toggle_filter_visiblity()),this.refresh_filters_dependency(),this.filters.length===0?this.page.hide_form():this.page.show_form()}move_check_filter_area(){this.page.page_form.append(this.check_filter_area)}setup_check_filter_area(){let e="<div class='check-filter-area'> </div>";this.page.page_form.append(e),this.check_filter_area=this.page.page_form.find(".check-filter-area")}get_filter_row_length(){let e=document.documentElement.clientWidth,t=this.filters.map(r=>r.wrapper.getBoundingClientRect().x),i=t.reduce(function(r,s){return Math.abs(s-e)<Math.abs(r-e)?s:r});return t.indexOf(i)+1}toggle_filter_visiblity(){let e;if(this.filters_hidden){for(let t=this.filter_row_length;t<this.filters.length;t++)$(this.filters[t].wrapper).addClass("hidden");this.check_filter_area.css("display","none"),this.filters_hidden=!1,e="chevron-down"}else{for(let t=this.filter_row_length;t<this.filters.length;t++)$(this.filters[t].wrapper).removeClass("hidden");this.check_filter_area.css("display","flex"),this.filters_hidden=!0,e="chevron-up"}this.$collapse_button.find("use").attr("href",`#icon-${e}`)}add_collapse_button(){let e=this,t=this.filter_row_length-1;this.filters[t]&&(this.$collapse_button=$(`<div>${frappe.utils.icon("chevron-down","md")}</div>`),$(this.filters[t].wrapper).append(this.$collapse_button),$(this.filters[t].wrapper).css("display","flex"),$(this.filters[t].wrapper).css("align-items","center"),$(this.filters[t].wrapper).css("gap","5px"),this.$collapse_button.on("click",function(){e.toggle_filter_visiblity()}))}set_filters(e){this.filters.map(t=>{t.fieldtype=="MultiSelectList"?t.set_value(e[t.fieldname]):t.set_input(e[t.fieldname])})}set_route_filters(e){if(e||(e=frappe.route_options),e){let t=Object.keys(e),i=this.filters.filter(s=>t.includes(s.df.fieldname));this.prepared_report_name=e.prepared_report_name;let r=i.map(s=>async()=>{let d=e[s.df.fieldname];typeof d=="string"&&d[0]==="["&&(d=JSON.parse(d)),await s.set_value(d)});return r.push(()=>{frappe.route_options=null}),this.ignore_prepared_report=e.ignore_prepared_report||!1,frappe.run_serially(r)}}clear_filters(){this.page.clear_fields()}refresh(e){this.toggle_message(!0),this.toggle_report(!1);let t=this.get_filter_values(!this.prepared_report_name),i=this.filters.map(r=>!e&&(r.default===r.value||!r.default&&!r.value)).every(r=>r===!0);return this.show_loading_screen(),this.last_ajax&&this.last_ajax.abort(),this.prepared_report_name&&(t.prepared_report_name=this.prepared_report_name),new Promise(r=>{this.last_ajax=frappe.call({method:"frappe.desk.query_report.run",type:"GET",args:{report_name:this.report_name,filters:t,ignore_prepared_report:this.ignore_prepared_report,is_tree:this.report_settings.tree,parent_field:this.report_settings.parent_field,are_default_filters:i},callback:r,always:()=>this.page.btn_secondary.prop("disabled",!1)})}).then(r=>{let s=r.message;if(this.hide_status(),clearInterval(this.interval),this.execution_time=s.execution_time||.1,s.custom_filters&&(this.set_filters(s.custom_filters),this.previous_filters=s.custom_filters),s.prepared_report){if(this.prepared_report=!0,this.prepared_report_document=s.doc,this.prepared_report_name){let d=JSON.parse(s.doc.filters);Object.values(this.filters).forEach(function(h){d[h.fieldname]&&h.set_input(d[h.fieldname]),h.input&&(h.input.disabled=!0)})}this.add_prepared_report_buttons(s.doc)}s.report_summary&&(this.$summary.empty(),this.render_summary(s.report_summary)),s.message&&!s.prepared_report&&this.show_status(s.message),this.toggle_message(!1),s.result&&s.result.length?(this.prepare_report_data(s),this.chart_options=this.get_chart_options(s),this.$chart.empty(),this.chart_options?this.render_chart(this.chart_options):(this.$chart.empty(),this.chart_fields&&(this.chart_options=frappe.report_utils.make_chart_options(this.columns,this.raw_data,this.chart_fields),this.chart_options&&this.render_chart(this.chart_options))),this.render_datatable(),this.add_chart_buttons_to_toolbar(!0),this.add_card_button_to_toolbar(),this.$report.show()):(this.data=[],this.toggle_nothing_to_show(!0),this.add_chart_buttons_to_toolbar(!1)),this.show_footer_message(),frappe.hide_progress()}).finally(()=>{var r,s;this.hide_loading_screen(),this.update_url_with_filters(),(s=(r=this.report_settings).after_refresh)==null||s.call(r,this)})}render_summary(e){e.forEach(t=>{frappe.utils.build_summary_item(t).appendTo(this.$summary)}),this.$summary.show()}get_query_params(){let e=frappe.utils.get_query_string(frappe.get_route_str());return frappe.utils.get_query_params(e)}add_prepared_report_buttons(e){if(e){this.page.add_inner_button(__("Download Report"),function(){window.open(frappe.urllib.get_full_url("/api/method/frappe.core.doctype.prepared_report.prepared_report.download_attachment?dn="+encodeURIComponent(e.name)))},__("Actions"));let r=frappe.datetime.comment_when(e.report_end_time);frappe.datetime.get_day_diff(frappe.datetime.now_datetime(),e.report_end_time)>1&&(r=`<span style="color:var(--red-600)">${r}</span>`);let d=__("This report was generated {0}.",[r]),h=__("To get the updated report, click on {0}.",[__("Rebuild")]),u=__("See all past reports.");this.show_status(`
				<div class="indicator orange">
					<span>
						${d}
						${h}
						<a href="/app/List/Prepared%20Report?report_name=${this.report_name}"> ${u}</a>
					</span>
				</div>
			`)}this.primary_action_map={New:{label:__("Generate New Report"),click:()=>{this.show_warning_or_generate_report()}},Edit:{label:__("Edit"),click:()=>{frappe.set_route(frappe.get_route())}},Rebuild:{label:__("Rebuild"),click:()=>{this.show_warning_or_generate_report()}}};let t="New";this.prepared_report_name?t="Edit":e&&(t="Rebuild");let i=this.primary_action_map[t];(!this.primary_button||this.primary_button.text()!==i.label)&&(this.primary_button=this.page.set_primary_action(i.label,i.click))}toggle_primary_button_disabled(e){this.primary_button.prop("disabled",e)}show_warning_or_generate_report(){frappe.xcall("frappe.core.doctype.prepared_report.prepared_report.get_reports_in_queued_state",{filters:this.get_filter_values(),report_name:this.report_name}).then(e=>{if(this.queued_prepared_reports=e,e.length){let t=this.get_queued_prepared_reports_warning_message(e);this.prepared_report_dialog=frappe.warn(__("Reports already in Queue"),t,()=>this.generate_background_report(),__("Proceed Anyway"),!0),this.prepared_report_dialog.footer.prepend(`
					<button type="button" class="btn btn-sm btn-default pull-left" data-action="delete_old_queued_reports">
						${__("Delete and Generate New")}
					</button>`),frappe.utils.bind_actions_with_object(this.prepared_report_dialog.wrapper,this)}else this.generate_background_report()})}get_queued_prepared_reports_warning_message(e){let t=`/app/List/Prepared Report/List?status=Queued&report_name=${this.report_name}`,i=e.length==1?`<a class="underline" href="${t}">${__("1 Report")}</a>`:`<a class="underline" href="${t}">${__("{0} Reports",[e.length])}</a>`,r=e.length==1?`${__("There is {0} with the same filters already in the queue:",[i])}`:`${__("There are {0} with the same filters already in the queue:",[i])}`,s=`
			<p>
				${__("Are you sure you want to generate a new report?")}
				${r}
			</p>`,d=h=>`<a class="underline" href="/app/prepared-report/${h.name}">${h.name}</a>`;return s+=e.map(d).join(", "),s}delete_old_queued_reports(){this.prepared_report_dialog.hide(),frappe.xcall("frappe.core.doctype.prepared_report.prepared_report.delete_prepared_reports",{reports:this.queued_prepared_reports}).then(()=>this.generate_background_report())}generate_background_report(){if(this.toggle_primary_button_disabled(!0),!this.filters.filter(i=>i.df.reqd).filter(i=>!i.get_value()).length){let i=this.get_filter_values(!0);return new Promise(r=>frappe.call({method:"frappe.core.doctype.prepared_report.prepared_report.make_prepared_report",args:{report_name:this.report_name,filters:i},callback:r})).then(r=>{let s=r.message;this.prepared_report_doc_name=s.name;let d=`<a href='/app/prepared-report/${s.name}'>`+__("Report initiated, click to view status")+"</a>";frappe.show_alert({message:d,indicator:"orange"},10),this.toggle_nothing_to_show(!0)})}}prepare_report_data(e){this.raw_data=e,this.columns=this.prepare_columns(e.columns),this.custom_columns=[],this.data=this.prepare_data(e.result),this.linked_doctypes=this.get_linked_doctypes(),this.tree_report=this.data.some(t=>"indent"in t)}render_datatable(){let e=this.data,t=this.columns.filter(i=>!i.hidden);if(e.length>(cint(frappe.boot.sysdefaults.max_report_rows)||1e5)){let i=__("This report contains {0} rows and is too big to display in browser, you can {1} this report instead.",[cstr(format_number(e.length,null,0)).bold(),__("export").bold()]);this.toggle_message(!0,`${frappe.utils.icon("solid-warning")} ${i}`);return}if(this.raw_data.add_total_row&&!this.report_settings.tree&&(e=e.slice(),e.splice(-1,1)),this.$report.show(),this.datatable&&this.datatable.options&&this.datatable.options.showTotalRow===this.raw_data.add_total_row)this.datatable.options.treeView=this.tree_report,this.datatable.refresh(e,t);else{let i={columns:t,data:e,inlineFilters:!0,language:frappe.boot.lang,translations:frappe.utils.datatable.get_translations(),treeView:this.tree_report,layout:"fixed",cellHeight:33,showTotalRow:this.raw_data.add_total_row&&!this.report_settings.tree,direction:frappe.utils.is_rtl()?"rtl":"ltr",hooks:{columnTotal:frappe.utils.report_column_total}};this.report_settings.get_datatable_options&&(i=this.report_settings.get_datatable_options(i)),this.datatable=new window.DataTable(this.$report[0],i)}typeof this.report_settings.initial_depth=="number"&&this.datatable.rowmanager.setTreeDepth(this.report_settings.initial_depth),this.report_settings.after_datatable_render&&this.report_settings.after_datatable_render(this.datatable)}show_loading_screen(){let e=`<div class="msg-box no-border">
			<svg class="icon icon-xl mb-4" style="stroke: var(--text-light);">
				<use href="#icon-table"></use>
			</svg>
			<p>${__("Loading")}...</p>
		</div>`;this.$loading.find("div").html(e),this.$report.hide(),this.$loading.show()}hide_loading_screen(){this.$loading.hide()}get_chart_options(e){let t=this.report_settings.get_chart_data?this.report_settings.get_chart_data(e.columns,e.result):e.chart?e.chart:void 0;if(!!(t&&t.data&&t.data.labels&&t.data.labels.length>0))return t.fieldtype&&(t.tooltipOptions={formatTooltipY:i=>frappe.format(i,{fieldtype:t.fieldtype,options:t.options},t.options,t)}),t.axisOptions={shortenYAxisNumbers:1,numberFormatter:frappe.utils.format_chart_axis_number},t.height=280,t}render_chart(e){this.$chart.empty(),this.$chart.show(),this.chart=new frappe.Chart(this.$chart[0],e)}open_create_chart_dialog(){let e=this,t=frappe.report_utils.get_field_options_from_report(this.columns,this.raw_data);function i(d){return d.y_fields=[],d.colors=[],d.y_axis_fields&&d.y_axis_fields.map(h=>{d.y_fields.push(h.y_field),d.colors.push(h.color)}),d.y_fields=d.y_fields.map(h=>h.trim()).filter(Boolean),d}function r(){let d=$(s.fields_dict.chart_preview.wrapper),h=s.get_values(!0);if(h=i(h),h.x_field&&h.y_fields.length){let u=frappe.report_utils.make_chart_options(e.columns,e.raw_data,h);e.chart_fields=h,d.empty(),new frappe.Chart(d[0],u),d.find(".chart-container .title, .chart-container .sub-title").hide(),d.show(),s.fields_dict.create_dashoard_chart.df.hidden=0,s.refresh()}else d[0].innerHTML=`<div class="flex justify-center align-center text-muted" style="height: 120px; display: flex;">
					<div>${__("Please select X and Y fields")}</div>
				</div>`}let s=new frappe.ui.Dialog({title:__("Create Chart"),fields:[{fieldname:"x_field",label:"X Field",fieldtype:"Select",default:e.chart_fields?e.chart_fields.x_field:null,options:t.non_numeric_fields},{fieldname:"cb_1",fieldtype:"Column Break"},{fieldname:"chart_type",label:"Type of Chart",fieldtype:"Select",options:["Bar","Line","Percentage","Pie","Donut"],default:e.chart_fields?e.chart_fields.chart_type:"Bar"},{fieldname:"sb_1",fieldtype:"Section Break",label:"Y Axis"},{fieldname:"y_axis_fields",fieldtype:"Table",fields:[{fieldtype:"Select",fieldname:"y_field",name:"y_field",label:__("Y Field"),options:t.numeric_fields,in_list_view:1},{fieldtype:"Color",fieldname:"color",name:"color",label:__("Color"),in_list_view:1}]},{fieldname:"preview_chart_button",fieldtype:"Button",label:"Preview Chart",click:r},{fieldname:"sb_2",fieldtype:"Section Break",label:"Chart Preview"},{fieldname:"chart_preview",label:"Chart Preview",fieldtype:"HTML"},{fieldname:"create_dashoard_chart",label:"Add Chart to Dashboard",fieldtype:"Button",hidden:1,click:()=>{s.hide(),this.add_chart_to_dashboard()}}],primary_action_label:__("Create"),primary_action:d=>{d=i(d);let h=frappe.report_utils.make_chart_options(this.columns,this.raw_data,d);e.chart_fields=d;let u=t.numeric_fields.filter(m=>m.value==d.y_fields[0])[0].label,y=t.non_numeric_fields.filter(m=>m.value==d.x_field)[0].label;h.title=__("{0}: {1} vs {2}",[this.report_name,u,y]),this.render_chart(h),this.add_chart_buttons_to_toolbar(!0),s.hide()}});s.show(),setTimeout(r,500)}prepare_columns(e){let t=this.report_doc.query&&this.report_doc.query!=null&&this.report_doc.query!="";return e.map(i=>{var d;i=frappe.report_utils.prepare_field_from_column(i);let r=(h,u,y,m)=>{if(y.isHeader&&!m&&this.data){let b=1;if(this.report_settings.get_datatable_options){let R=this.report_settings.get_datatable_options({});R&&R.checkboxColumn&&(b=2)}y.colIndex===b&&!h?(h=__("Total"),y={fieldtype:"Data"}):["Currency","Float"].includes(y.fieldtype)&&(m=this.data[0])}return frappe.format(h,y,{for_print:!1,always_show_decimals:!0},m)},s=null;return i.fieldtype==="Date"&&(s=(h,u)=>{if(!h.content||u.length!==10)return null;let y=frappe.datetime.user_to_obj(u);return[+frappe.datetime.str_to_obj(h.content),+y]}),Object.assign(i,{id:i.fieldname,name:t?__(i.label):i.label,width:parseInt(i.width)||null,editable:(d=i.editable)!=null?d:!1,compareValue:s,format:(h,u,y,m,b)=>this.report_settings.formatter?this.report_settings.formatter(h,u,y,m,r,b):r(h,u,y,m)})})}prepare_data(e){return e.map(t=>{let i={};return Array.isArray(t)?(this.columns.forEach((r,s)=>{i[r.id]=t[s]}),i):t})}get_visible_columns(){return this.datatable.datamanager.getColumns(!0).map(t=>t.id).map(t=>this.columns.find(i=>i.id===t)).filter(Boolean)}get_filter_values(e){if(e&&this.filters.filter(r=>r.df.reqd||r.df.mandatory).filter(r=>!r.get_value()).length>0){let r=__("Please set filters");throw this.hide_loading_screen(),this.toggle_message(e,r),"Filter missing"}return e&&this.toggle_message(!1),this.filters.filter(t=>{var i;return(i=t.get_value)==null?void 0:i.call(t)}).map(t=>{var i=t.get_value();return t.df.hidden&&(i=t.value),i==="%"&&(i=null),t.df.wildcard_filter&&(i=`%${i}%`),{[t.df.fieldname]:i}}).reduce((t,i)=>(Object.assign(t,i),t),{})}get_filter(e){let t=(this.filters||[]).find(i=>i.df.fieldname===e);return t||console.warn(`[Query Report] Invalid filter: ${e}`),t}get_filter_value(e){let t=this.get_filter(e);return t?t.get_value():null}set_filter_value(e,t){let i={};typeof e=="string"?i[e]=t:i=e,this._no_refresh=!0,Object.keys(i).forEach((r,s,d)=>{let h=i[r];s===d.length-1&&(this._no_refresh=!1),this.get_filter(r).set_value(h)})}set_breadcrumbs(){if(!this.report_doc||!this.report_doc.ref_doctype)return;let e=frappe.get_meta(this.report_doc.ref_doctype);frappe.breadcrumbs.add(e.module)}make_access_log(e,t){frappe.call("frappe.core.doctype.access_log.access_log.make_access_log",{doctype:this.doctype||"",report_name:this.report_name,filters:this.get_filter_values(),file_type:t,method:e})}async print_report(e){let t=this.report_settings.html_format||null,i=this.get_filters_html_for_print(),r=e.orientation=="Landscape";e.report&&(t=await this.get_report_print_format(e.report)),this.make_access_log("Print","PDF"),frappe.render_grid({template:e.columns?"print_grid":t,title:__(this.report_name),subtitle:i,print_settings:e,landscape:r,filters:this.get_filter_values(),data:this.get_data_for_print(),columns:this.get_columns_for_print(e,t),original_data:this.data,report:this,can_use_smaller_font:this.report_doc.is_standard==="Yes"&&t?0:1})}async pdf_report(e){let t=frappe.urllib.get_base_url(),i=frappe.boot.print_css,r=e.orientation=="Landscape",s=this.report_settings.html_format||null,d=this.get_columns_for_print(e,s),h=this.get_data_for_print(),u=this.get_filter_values();e.report&&(s=await this.get_report_print_format(e.report));let y=this.get_filters_html_for_print(),m=e.columns||!s?"print_grid":s,b=frappe.render_template(m,{title:__(this.report_name),subtitle:y,filters:u,data:h,original_data:this.data,columns:d,report:this}),R=frappe.render_template("print_template",{title:__(this.report_name),content:b,base_url:t,print_css:i,print_settings:e,landscape:r,columns:d,lang:frappe.boot.lang,layout_direction:frappe.utils.is_rtl()?"rtl":"ltr",can_use_smaller_font:this.report_doc.is_standard==="Yes"&&s?0:1}),x=[],C=0;for(var w of Object.keys(u)){if(C=C+u[w].toString().length,C>200)break;x.push(u[w])}x.length?e.report_name=`${__(this.report_name)}_${x.join("_")}.pdf`:e.report_name=`${__(this.report_name)}.pdf`,frappe.render_pdf(R,e)}async get_report_print_format(e){let t={name:e,disabled:0},i=await frappe.db.get_value("Print Format",t,["html","css"]);if(i&&i.message&&i.message.html){let r=i.message.css||"",s=i.message.html||"";return`<style>${r}</style>${s}`}else return frappe.msgprint(__("Print Format not found")),null}get_filters_html_for_print(){let e=this.get_filter_values();return Object.keys(e).map(t=>{let i=frappe.query_report.get_filter(t).df,r=e[t];return frappe.utils.is_empty(r)||i.hidden_due_to_dependency?null:`<div class="filter-row">
					<b>${__(i.label,null,i.parent)}:</b> ${frappe.format(r,i)}
				</div>`}).join("")}export_report(){if(this.export_dialog){this.export_dialog.clear(),this.export_dialog.show();return}let e=[];if(this.tree_report&&e.push({label:__("Include indentation"),fieldname:"include_indentation",fieldtype:"Check"}),this.filters.length>0&&e.push({label:__("Include filters"),fieldname:"include_filters",fieldtype:"Check"}),this.report_settings.export_hidden_cols){let t=[];this.columns.forEach(i=>{i.hidden&&t.push(i.label)}),t.length&&e.push({fieldname:"column_break_1",fieldtype:"Column Break"},{label:__("Include hidden columns"),fieldname:"include_hidden_columns",description:__("Hidden columns include: {0}",[t.join(", ")]),fieldtype:"Check"})}this.export_dialog=frappe.report_utils.get_export_dialog(__(this.report_name),e,({file_format:t,include_indentation:i,include_filters:r,include_hidden_columns:s,csv_delimiter:d,csv_quoting:h,csv_decimal_sep:u})=>{var C,w,O;this.make_access_log("Export",t);let y=this.get_filter_values(!0),m={1:__("Yes"),0:__("No")},b={};for(let[D,B]of Object.entries(y)){let Y=frappe.query_report.get_filter(D).df;Y.hidden_due_to_dependency||(b[Y.label]=Y.fieldtype==="Check"?m[B]:B)}this.prepared_report_name&&(y.prepared_report_name=this.prepared_report_name);let R=((C=this.datatable)==null?void 0:C.bodyRenderer.visibleRowIndices)||[];R.length+1===((w=this.data)==null?void 0:w.length)&&R.push(R.length);let x={cmd:"frappe.desk.query_report.export_query",report_name:this.report_name,custom_columns:(O=this.custom_columns)!=null&&O.length?this.custom_columns:[],file_format_type:t,filters:y,applied_filters:b,visible_idx:R,csv_delimiter:d,csv_quoting:h,csv_decimal_sep:u,include_indentation:i,include_filters:r,include_hidden_columns:s};open_url_post(frappe.request.url,x),this.export_dialog.hide()}),this.export_dialog.show()}get_data_for_csv(e){let t=this.datatable.bodyRenderer.visibleRows;return this.raw_data.add_total_row&&t.push(this.datatable.bodyRenderer.getTotalRow()),t.map(i=>{let r=this.datatable.datamanager.getStandardColumnCount();return i.slice(r).map((s,d)=>{var h,u;return s.column.fieldtype==="Duration"&&(s.content=frappe.utils.get_formatted_duration(s.content)),e&&d===0&&(s.content="   ".repeat(i.meta.indent)+((h=s.content)!=null?h:"")),(u=s.content)!=null?u:""})})}get_data_for_print(){var t;if(!this.data.length)return[];let e=this.datatable.datamanager.rowViewOrder.map(i=>{if(this.datatable.bodyRenderer.visibleRowIndices.includes(i))return this.data[i]}).filter(Boolean);if(this.raw_data.add_total_row&&!this.report_settings.tree){let i=this.datatable.bodyRenderer.getTotalRow().reduce((r,s)=>(r[s.column.id]=s.content,r.is_total_row=!0,r),{});!(i!=null&&i.currency)&&((t=e[0])==null?void 0:t.currency)&&(i.currency=e[0].currency),e.push(i)}return e}get_columns_for_print(e,t){let i=[];return e&&e.columns?i=this.get_visible_columns().filter(r=>e.columns.includes(r.fieldname)):i=t?this.columns:this.get_visible_columns(),i}get_menu_items(){let e=[{label:__("Refresh"),action:()=>this.refresh(),class:"visible-xs"},{label:__("Edit"),action:()=>frappe.set_route("Form","Report",this.report_name),condition:()=>frappe.user.is_report_manager(),standard:!0},{label:__("Print"),action:()=>{let t=frappe.ui.get_print_settings(!1,i=>this.print_report(i),this.report_doc.letter_head,this.get_visible_columns());this.add_portrait_warning(t)},condition:()=>frappe.model.can_print(this.report_doc.ref_doctype),standard:!0},{label:__("PDF"),action:()=>{let t=frappe.ui.get_print_settings(!1,i=>this.pdf_report(i),this.report_doc.letter_head,this.get_visible_columns());this.add_portrait_warning(t)},condition:()=>frappe.model.can_print(this.report_doc.ref_doctype),standard:!0},{label:__("Export"),action:()=>this.export_report(),condition:()=>frappe.model.can_export(this.report_doc.ref_doctype),standard:!0},{label:__("Setup Auto Email"),action:()=>frappe.set_route("List","Auto Email Report",{report:this.report_name}),standard:!0},{label:__("Add Column"),action:()=>{var i;let t=new frappe.ui.Dialog({title:__("Add Column"),fields:[{fieldtype:"Select",fieldname:"doctype",label:__("From Document Type"),options:(i=this.linked_doctypes)==null?void 0:i.map(r=>({label:r.doctype+" ("+frappe.unscrub(r.fieldname)+")",value:JSON.stringify({doctype:r.doctype,fieldname:r.fieldname})})),change:()=>{let{doctype:r,fieldname:s}=JSON.parse(t.get_value("doctype"));frappe.model.with_doctype(r,()=>{let d=frappe.meta.get_docfields(r).filter(frappe.model.is_value_type).map(h=>({label:h.label,value:h.fieldname}));t.set_df_property("field","options",d.sort(function(h,u){return h.label<u.label?-1:h.label>u.label?1:0}))})}},{fieldtype:"Select",label:__("Field"),fieldname:"field",options:[]},{fieldtype:"Select",label:__("Insert After"),fieldname:"insert_after",options:this.columns.map(r=>r.label)}],primary_action:r=>{let s=[],{doctype:d,fieldname:h}=JSON.parse(r.doctype);Object.assign(r,{doctype:d,fieldname:h});let u=frappe.meta.get_docfield(r.doctype,r.field),y=this.columns.findIndex(m=>m.label===r.insert_after);s.push({fieldname:this.columns.map(m=>m.fieldname).includes(u.fieldname)?u.fieldname+"-"+frappe.scrub(r.doctype):u.fieldname,fieldtype:u.fieldtype,label:u.label,insert_after_index:y,link_field:this.doctype_field_map[r.doctype],doctype:r.doctype,options:u.options,width:100}),this.custom_columns=this.custom_columns.concat(s),frappe.call({method:"frappe.desk.query_report.get_data_for_custom_field",args:{field:r.field,doctype:r.doctype,names:Array.from(this.doctype_field_map[r.doctype].names)},callback:m=>{let b=m.message;this.add_custom_column(s,b,r,y),t.hide()}}),this.set_menu_items()}});t.show()},standard:!0},{label:__("User Permissions"),action:()=>frappe.set_route("List","User Permission",{doctype:"Report",name:this.report_name}),condition:()=>frappe.user.has_role("System Manager"),standard:!0}];return frappe.user.is_report_manager()&&e.push({label:__("Save"),action:()=>{let t=new frappe.ui.Dialog({title:__("Save Report"),fields:[{fieldtype:"Data",fieldname:"report_name",label:__("Report Name"),default:this.report_doc.is_standard=="No"?this.report_name:"",reqd:!0}],primary_action:i=>{frappe.call({method:"frappe.desk.query_report.save_report",args:{reference_report:this.report_name,report_name:i.report_name,columns:this.get_visible_columns(),filters:this.get_filter_values()},callback:function(r){this.show_save=!1,t.hide(),frappe.set_route("query-report",r.message)}})}});t.show()},standard:!0}),e}add_portrait_warning(e){this.columns.length>10&&e.set_df_property("orientation","change",()=>{let i=e.get_value("orientation")==="Portrait"?__("Report with more than 10 columns looks better in Landscape mode."):"";e.set_df_property("orientation","description",i)})}add_custom_column(e,t,i,r){let s=this.prepare_columns(e),d=i.field;this.columns.splice(r+1,0,s[0]),this.data.forEach(h=>{s[0].fieldname.includes("-")?h[d+"-"+frappe.scrub(i.doctype)]=t[h[i.fieldname]]:h[d]=t[h[i.fieldname]]}),this.render_datatable()}get_linked_doctypes(){let e=[],t=[],i=new Set;return this.doctype_field_map={},this.columns.forEach(r=>{r.fieldtype=="Link"&&r.options&&r.options!="Currency"?e.push({doctype:r.options,fieldname:r.fieldname}):r.fieldtype=="Dynamic Link"&&r.options&&t.push({link_name:r.options,fieldname:r.fieldname})}),this.data.forEach(r=>{t.forEach(s=>{r[s.link_name]&&i.add(r[s.link_name]+":"+s.fieldname)})}),e=e.concat(Array.from(i).map(r=>{let s=r.split(":");return{doctype:s[0],fieldname:s[1]}})),e.forEach(r=>{this.doctype_field_map[r.doctype]={fieldname:r.fieldname,names:new Set}}),this.data.forEach(r=>{e.forEach(s=>{this.doctype_field_map[s.doctype].names.add(r[s.fieldname])})}),e}setup_report_wrapper(){if(this.$report)return;$(".page-head-content").removeClass("border-bottom");let e=this.page.main.find(".page-form");this.$status=$('<div class="form-message text-muted small"></div>').hide().insertAfter(e),this.$summary=$('<div class="report-summary"></div>').hide().appendTo(this.page.main),this.$chart=$('<div class="chart-wrapper">').hide().appendTo(this.page.main),this.$loading=$(this.message_div("")).hide().appendTo(this.page.main),this.$report=$('<div class="report-wrapper">').appendTo(this.page.main),this.$message=$(this.message_div("")).hide().appendTo(this.page.main)}show_status(e){this.$status.html(e).show()}hide_status(){this.$status.hide()}show_footer_message(){this.$report_footer&&this.$report_footer.remove(),this.$report_footer=$('<div class="report-footer text-muted"></div>').appendTo(this.page.main),this.tree_report&&(this.$tree_footer=$(`<div class="tree-footer col-md-3">
				<div class="input-group">
				  <input id="tree-level" type="number" class="form-control" aria-label="Tree Level" value="2">
					<button class="btn btn-xs btn-secondary" data-action="set_tree_level">
						${__("Set Level")}</button>
					<button class="btn btn-xs btn-secondary" data-action="expand_all_rows">
						${__("Expand All")}</button>
					<button class="btn btn-xs btn-secondary" data-action="collapse_all_rows">
						${__("Collapse All")}</button>
				</div>
			</div>`),$(this.$report_footer).append(this.$tree_footer),this.$tree_footer.find("[data-action=collapse_all_rows]").show(),this.$tree_footer.find("[data-action=expand_all_rows]").hide());let e=__("For comparison, use >5, <10 or =324. For ranges, use 5:10 (for values between 5 & 10)."),t=__("Execution Time: {0} sec",[this.execution_time||.1]);this.$report_footer.append(`<div class="col-md-12">
			<span">${e}</span><span class="pull-right">${t}</span>
		</div>`)}expand_all_rows(){this.$tree_footer.find("[data-action=expand_all_rows]").hide();var i=this.datatable.rowmanager.datamanager.getRows().reduce((r,s)=>Math.max(r,s.meta.indent||0),0)+1;this.$tree_footer.find("#tree-level").val(i),this.datatable.rowmanager.expandAllNodes(),this.$tree_footer.find("[data-action=collapse_all_rows]").show()}collapse_all_rows(){this.$tree_footer.find("[data-action=collapse_all_rows]").hide(),this.$tree_footer.find("#tree-level").val(1),this.datatable.rowmanager.collapseAllNodes(),this.$tree_footer.find("[data-action=expand_all_rows]").show()}set_tree_level(){var e=parseInt(this.$tree_footer.find("#tree-level").val(),10)||0;let i=this.datatable.rowmanager.datamanager.getRows().reduce((d,h)=>Math.max(d,h.meta.indent||0),0);var r=Math.min(i+1,Math.max(1,e)),s=r-1;this.$tree_footer.find("#tree-level").val(r),s===0?this.$tree_footer.find("[data-action=collapse_all_rows]").hide():this.$tree_footer.find("[data-action=collapse_all_rows]").show(),this.datatable.rowmanager.setTreeDepth(s),s===0?this.$tree_footer.find("[data-action=expand_all_rows]").show():this.$tree_footer.find("[data-action=expand_all_rows]").hide()}message_div(e){return`<div class='flex justify-center align-center text-muted' style='height: calc(100vh - 280px);'>
			<div>${e}</div>
		</div>`}toggle_nothing_to_show(e){let t=this.prepared_report&&!this.prepared_report_document?__("This is a background report. Please set the appropriate filters and then generate a new one."):this.get_no_result_message();this.toggle_message(e,t),e&&this.prepared_report&&(this.primary_button.is(":visible")||this.add_prepared_report_buttons())}toggle_message(e,t){e?(this.$message.find("div").html(t),this.$message.show()):this.$message.hide()}toggle_filter_display(e,t){this.$page.find(`div[data-fieldname=${e}]`).toggleClass("hide-control",t)}toggle_report(e){this.$report.toggle(e),this.$chart.toggle(e),this.$summary.toggle(e)}get_checked_items(e){return this.datatable.rowmanager.getCheckedRows().reduce((i,r)=>{if(r===void 0)return i;let s=this.data[r];return i.push(e?s.name:s),i},[])}get get_values(){return this.get_filter_values}add_translate_data_checkbox(){if(this.report_doc.add_translate_data){let e={fieldname:"translate_data",fieldtype:"Check",label:__("Translate Data")};this.report_settings.filters.push(e)}}};frappe.templates.print_grid=`<!-- title -->
{% if title %}
<h2>{{ __(title) }}</h2>
<hr>
{% endif %}
{% if subtitle %}
{{ subtitle }}
<hr>
{% endif %}
<table class="table table-bordered">
	<!-- heading -->
	<thead>
		<tr>
		<th> # </th>
		{% for col in columns %}
			{% if col.name && col._id !== "_check" %}
			<th
				{% if col.minWidth %}
					style="min-width: {{ col.minWidth }}px"
				{% endif %}
				{% if col.docfield && frappe.model.is_numeric_field(col.docfield) %}
					class="text-right"
				{% endif %}
			>
				{{ __(col.name) }}</th>
			{% endif %}
		{% endfor %}
		</tr>
	</thead>
	<!-- body -->
	<tbody>
		{% for row in data %}
			<tr style="height: 30px">
			<td {% if row.bold == 1 %} style="font-weight: bold" {% endif %}>
				<span> {{ row._index + 1 }} </span>
			</td>
			{% for col in columns %}
				{% if col.name && col._id !== "_check" %}
					{% var value = col.fieldname ? row[col.fieldname] : row[col.id] %}
					{% var longest_word = cstr(value).split(' ').reduce((longest, word) => word.length > longest.length ? word : longest, ''); %}
					<td {% if row.bold == 1 %} style="font-weight: bold" {% endif %} {% if longest_word.length > 45 %} class="overflow-wrap-anywhere" {% endif %}>
						<span {% if col._index == 0 %} style="padding-left: {%= cint(row.indent) * 2 %}em" {% endif %}>
							{% format_data = row.is_total_row && ["Currency", "Float"].includes(col.fieldtype) ? data[0] : row %}
							{% if (row.is_total_row && col._index == 0) { %}
								{{ __("Total") }}
							{% } else { %}
								{{
									col.formatter
										? col.formatter(row._index, col._index, value, col, format_data, true)
										: col.format
											? col.format(value, row, col, format_data)
											: col.docfield
												? frappe.format(value, col.docfield)
												: value
								}}
							{% } %}
						</span>
					</td>
				{% endif %}
			{% endfor %}
			</tr>
		{% endfor %}
	</tbody>
</table>
`;frappe.templates.print_tree=`<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="">
		<meta name="author" content="">
		<title>{{ title }}</title>
		<link href="{{ base_url }}/assets/frappe/css/bootstrap.css" rel="stylesheet">
		<link type="text/css" rel="stylesheet"
			href="{{ base_url }}/assets/frappe/css/fonts/fontawesome/font-awesome.min.css">
		<link rel="stylesheet" type="text/css" href="{{ base_url }}/assets/frappe/css/tree.css">
		<link rel="stylesheet" type="text/css" href="{{ base_url }}{{ print_format_css_path }}">
		<style>
			{{ print_css }}
		</style>
		<style>
			.tree.opened::before,
			.tree-node.opened::before,
			.tree:last-child::after,
			.tree-node:last-child::after {
				z-index: 1;
				border-left: 1px solid #d1d8dd;
				background: none;
			}
			.tree a,
			.tree-link {
				text-decoration: none;
				cursor: default;
			}
			.tree.opened > .tree-children > .tree-node > .tree-link::before,
			.tree-node.opened > .tree-children > .tree-node > .tree-link::before {
				border-top: 1px solid #d1d8dd;
				z-index: 1;
				background: none;
			}
			i.fa.fa-fw.fa-folder {
				z-index: 2;
				position: relative;
			}
			.tree:last-child::after, .tree-node:last-child::after {
				display: none;
			}
			.tree-node-toolbar {
				display: none;
			}
			i.octicon.octicon-primitive-dot.text-extra-muted {
				width: 7px;
				height: 7px;
				border-radius: 50%;
				background: #d1d8dd;
				display: inline-block;
				position: relative;
				z-index: 2;
			}

			@media (max-width: 767px) {
				ul.tree-children {
					padding-left: 20px;
				}
			}
		</style>
  	</head>
	<body>
		<svg id="frappe-symbols" aria-hidden="true" style="position: absolute; width: 0; height: 0; overflow: hidden;" class="d-block" xmlns="http://www.w3.org/2000/svg">
			<symbol viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg" id="icon-primitive-dot">
				<path d="M9.5 6a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0z"></path>
			</symbol>

			<symbol viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" id="icon-folder-open">
				<path d="M8.024 6.5H3a.5.5 0 0 0-.5.5v8a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V9.5A.5.5 0 0 0 17 9h-6.783a.5.5 0 0 1-.417-.224L8.441 6.724a.5.5 0 0 0-.417-.224z" stroke="var(--icon-stroke)" stroke-miterlimit="10" stroke-linecap="square"></path>
				<path d="M3.88 4.5v-1a.5.5 0 0 1 .5-.5h11.24a.5.5 0 0 1 .5.5V7" stroke="var(--icon-stroke)" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path>
			</symbol>

			<symbol viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" id="icon-folder-normal">
				<path d="M2.5 4v10a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V6.5a1 1 0 0 0-1-1h-6.283a.5.5 0 0 1-.417-.224L8.441 3.224A.5.5 0 0 0 8.024 3H3.5a1 1 0 0 0-1 1z" stroke="var(--icon-stroke)" stroke-miterlimit="10" stroke-linecap="square"></path>
			</symbol>
		</svg>
		<div class="print-format-gutter">
			{% if print_settings.repeat_header_footer %}
				<div id="footer-html" class="visible-pdf">
					{% if print_settings.letter_head && print_settings.letter_head.footer %}
						<div class="letter-head-footer">
							{{ print_settings.letter_head.footer }}
						</div>
					{% endif %}
					<p class="text-center small page-number visible-pdf">
						{{ __("Page {0} of {1}", [\`<span class="page"></span>\`, \`<span class="topage"></span>\`]) }}
					</p>
				</div>
			{% endif %}

			<div class="print-format {% if landscape %} landscape {% endif %}">
				{% if print_settings.letter_head %}
				<div {% if print_settings.repeat_header_footer %} id="header-html" class="hidden-pdf" {% endif %}>
					<div class="letter-head">{{ print_settings.letter_head.header }}</div>
				</div>
					{% endif %}
					<div class="tree opened">
						{{ tree }}
					</div>
			</div>
		</div>
	</body>
</html>
`;frappe.templates.group_by=`<div class="group-by-box">
	<div class="visible-xs flex justify-flex-end">
		<span class="remove-group-by">
			{{ __("Remove") }}
		</span>
	</div>
	<div class="list_groupby row">
		<div class="col-sm-8 form-group">
			<select class="group-by form-control input-xs">
				<option value="" disabled selected>{{ __("Select Group By...") }}</option>
				{% for (var parent_doctype in group_by_conditions) { %}
					{% for (var val of group_by_conditions[parent_doctype]) { %}
						{% field_name = val.label || val.fieldname %}
						{% if(val.parent && doctype != val.parent) field_name += " ("+parent_doctype+")"  %}
						<option
							data-doctype="{{parent_doctype}}"
							value="{{val.fieldname}}"
							data-parent-doctype="{{doctype}}"
						>
							{{ __(field_name, null, val.parent ) }}
						</option>
					{% } %}
				{% } %}
			</select>
		</div>
		<div class="col-sm-3 form-group">
			<select class="aggregate-function form-control input-xs">
				{% for condition in aggregate_function_conditions %}
				<option value="{{condition.name}}">{{ __(condition.label) }}</option>
				{% endfor %}
			</select>
		</div>
		<div class="col-sm-4 col-xs-12" style="display: none">
			<select class="aggregate-on form-control input-xs">
				<option value="" disabled selected>{{ __("Select Field...") }}</option>
			</select>
		</div>
		<div class="groupby-actions pull-left col-sm-1 hidden-xs">
			<span class="remove-group-by">
				<svg class="icon icon-sm">
					<use href="#icon-close"></use>
				</svg>
			</span>
		</div>
	</div>
</div>
`;frappe.provide("frappe.views");frappe.ui.GroupBy=class{constructor(n){this.report_view=n,this.page=n.page,this.doctype=n.doctype,this.make()}make(){this.make_group_by_button(),this.init_group_by_popover(),this.set_popover_events()}init_group_by_popover(){let n=[{name:"count",label:__("Count")},{name:"sum",label:__("Sum")},{name:"avg",label:__("Average")}],e=$(frappe.render_template("group_by",{doctype:this.doctype,group_by_conditions:this.get_group_by_fields(),aggregate_function_conditions:n}));this.group_by_button.popover({content:e,template:`
				<div class="group-by-popover popover">
					<div class="arrow"></div>
					<div class="popover-body popover-content">
					</div>
				</div>
			`,html:!0,trigger:"manual",container:"body",placement:"bottom",offset:"-100px, 0"})}set_popover_events(){$(document.body).on("click",n=>{this.wrapper&&this.wrapper.is(":visible")&&$(n.target).parents(".group-by-popover").length===0&&$(n.target).parents(".group-by-box").length===0&&$(n.target).parents(".group-by-button").length===0&&!$(n.target).is(this.group_by_button)&&this.wrapper&&this.group_by_button.popover("hide")}),this.group_by_button.on("click",()=>{this.group_by_button.popover("toggle")}),this.group_by_button.on("shown.bs.popover",()=>{this.wrapper||(this.wrapper=$(".group-by-popover"),this.setup_group_by_area())}),this.group_by_button.on("hidden.bs.popover",()=>{this.update_group_by_button()}),frappe.router.on("change",()=>{this.group_by_button.popover("hide")})}setup_group_by_area(){this.aggregate_on_html="",this.group_by_select=this.wrapper.find("select.group-by"),this.group_by_field&&this.group_by_select.val(this.group_by_field),this.aggregate_function_select=this.wrapper.find("select.aggregate-function"),this.aggregate_on_select=this.wrapper.find("select.aggregate-on"),this.remove_group_by_button=this.wrapper.find(".remove-group-by"),this.aggregate_function?this.aggregate_function_select.val(this.aggregate_function):(this.aggregate_function_select.val("count"),this.aggregate_function="count"),this.toggle_aggregate_on_field(),this.aggregate_on&&this.aggregate_on_select.val(this.aggregate_on_field),this.set_group_by_events()}set_group_by_events(){this.group_by_select.on("change",()=>{this.group_by_field=this.group_by_select.val(),this.group_by_doctype=this.group_by_select.find(":selected").attr("data-doctype"),this.apply_group_by_and_refresh()}),this.aggregate_function_select.on("change",()=>{this.toggle_aggregate_on_field(),this.aggregate_function=this.aggregate_function_select.val(),this.apply_group_by_and_refresh()}),this.aggregate_on_select.on("change",()=>{this.aggregate_on_field=this.aggregate_on_select.val(),this.aggregate_on_doctype=this.aggregate_on_select.find(":selected").attr("data-doctype"),this.apply_group_by_and_refresh()}),this.remove_group_by_button.on("click",()=>{this.group_by&&(this.remove_group_by(),this.toggle_aggregate_on_field_display(!1))})}toggle_aggregate_on_field(){let n=this.aggregate_function_select.val();if(n==="sum"||n==="avg"){if(!this.aggregate_on_html.length){this.aggregate_on_html=`<option value="" disabled selected>
						${__("Select Field...")}
					</option>`;for(let e in this.all_fields)this.all_fields[e].forEach(i=>{if(frappe.model.is_numeric_field(i.fieldtype)){let r=i.label||frappe.model.unscrub(i.fieldname),s=e==this.doctype?__(r,null,i.parent):`${__(r,null,i.parent)} (${__(e)})`;this.aggregate_on_html+=`<option data-doctype="${e}"
								value="${i.fieldname}">${s}</option>`}})}this.aggregate_on_select.html(this.aggregate_on_html),this.toggle_aggregate_on_field_display(!0)}else this.toggle_aggregate_on_field_display(!1)}toggle_aggregate_on_field_display(n){this.group_by_select.parent().toggleClass("col-sm-5",n),this.group_by_select.parent().toggleClass("col-sm-8",!n),this.aggregate_function_select.parent().toggleClass("col-sm-2",n),this.aggregate_function_select.parent().toggleClass("col-sm-3",!n),this.aggregate_on_select.parent().toggle(n)}get_settings(){return this.group_by?{group_by:this.group_by,aggregate_function:this.aggregate_function,aggregate_on:this.aggregate_on}:null}apply_settings(n){let e=i=>i.split(".")[1].replace(/`/g,""),t=i=>i.split(".")[0].replace(/`/g,"").replace("tab","");if(n.group_by.startsWith("`tab")||(n.group_by="`tab"+this.doctype+"`.`"+n.group_by+"`"),n.aggregate_on&&!n.aggregate_on.startsWith("`tab")){let i=this.get_aggregate_on_doctype(n);n.aggregate_on="`tab"+i+"`.`"+n.aggregate_on+"`"}this.group_by_field=e(n.group_by),this.group_by_doctype=t(n.group_by),this.aggregate_function=n.aggregate_function,n.aggregate_on&&(this.aggregate_on_field=e(n.aggregate_on),this.aggregate_on_doctype=t(n.aggregate_on)),this.apply_group_by(),this.update_group_by_button()}get_aggregate_on_doctype(n){for(let e of Object.keys(this.all_fields))if(this.all_fields[e].find(i=>i.fieldname==n.aggregate_on))return e}make_group_by_button(){this.page.wrapper.find(".sort-selector").before($(`<div class="group-by-selector">
				<button class="btn btn-default btn-sm group-by-button ellipsis">
					<span class="group-by-icon button-icon">
						${frappe.utils.icon("es-line-folder-alt")}
					</span>
					<span class="button-label hidden-xs">
						${__("Add Group")}
					</span>
				</button>
			</div>`)),this.group_by_button=this.page.wrapper.find(".group-by-button")}apply_group_by(){return this.group_by_doctype&&this.aggregate_on_doctype&&this.aggregate_on_doctype!=this.doctype&&this.group_by_doctype!=this.aggregate_on_doctype?(frappe.msgprint(__("Parent-to-child or child-to-different-child grouping is not allowed.")),!1):(this.group_by="`tab"+this.group_by_doctype+"`.`"+this.group_by_field+"`",this.aggregate_function==="count"?(this.aggregate_on_field=null,this.aggregate_on_doctype=null):this.aggregate_on="`tab"+this.aggregate_on_doctype+"`.`"+this.aggregate_on_field+"`",!(!this.group_by||!this.aggregate_function||!this.aggregate_on_field&&this.aggregate_function!=="count"))}apply_group_by_and_refresh(){this.apply_group_by()&&this.report_view.refresh()}set_args(n){this.aggregate_function&&this.group_by&&(this.report_view.group_by=this.group_by,this.report_view.sort_by="_aggregate_column",this.report_view.sort_order="desc",this.report_view.fields.map(e=>e[0]).includes("_aggregate_column")||(this.original_fields=this.report_view.fields.map(e=>e)),this.report_view.fields=[[this.group_by_field,this.group_by_doctype]],n.fields=this.report_view.get_fields(),this.report_view.fields.push(["_aggregate_column",this.aggregate_on_doctype||this.doctype]),this.report_view.setup_columns(),Object.assign(n,{with_comment_count:!1,aggregate_on_field:this.aggregate_on_field||"name",aggregate_on_doctype:this.aggregate_on_doctype||this.doctype,aggregate_function:this.aggregate_function||"count",group_by:this.report_view.group_by||null,order_by:"_aggregate_column desc"}))}get_group_by_docfield(){let n={};return this.aggregate_function==="count"?n={fieldtype:"Int",label:__("Count"),parent:this.doctype,width:200}:(n=Object.assign({},frappe.meta.docfield_map[this.aggregate_on_doctype][this.aggregate_on_field]),this.aggregate_function==="sum"?n.label=__("Sum of {0}",[__(n.label,null,n.parent)]):(n.fieldtype=="Int"&&(n.fieldtype="Float"),n.label=__("Average of {0}",[__(n.label,null,n.parent)]))),n.fieldname="_aggregate_column",n}remove_group_by(){this.order_by="",this.group_by=null,this.group_by_field=null,this.report_view.group_by=null,this.aggregate_function="count",this.aggregate_on=null,this.aggregate_on_field=null,this.group_by_select.val(""),this.aggregate_function_select.val("count"),this.aggregate_on_select.empty().val(""),this.aggregate_on_select.parent().hide(),this.original_fields?this.report_view.fields=this.original_fields:this.report_view.set_default_fields(),this.report_view.setup_columns(),this.original_fields=null,this.report_view.refresh()}get_group_by_fields(){this.group_by_fields={},this.all_fields={};let n=["_liked_by","idx","name"],e=frappe.model.std_fields.filter(s=>!n.includes(s.fieldname)),t=this.report_view.meta.fields.concat(e).filter(s=>["Select","Link","Data","Int","Check","Dynamic Link","Autocomplete","Date"].includes(s.fieldtype));this.group_by_fields[this.doctype]=t.sort((s,d)=>__(cstr(s.label)).localeCompare(cstr(__(d.label)))),this.all_fields[this.doctype]=this.report_view.meta.fields;let i=s=>!frappe.model.no_value_type.includes(s.fieldtype)&&!s.report_hide;return frappe.meta.get_table_fields(this.doctype).filter(s=>!s.hidden).forEach(s=>{let d=s.options,h=frappe.meta.get_docfields(d).filter(i).sort((u,y)=>__(cstr(u.label)).localeCompare(__(cstr(y.label))));this.group_by_fields[d]=h,this.all_fields[d]=h}),this.group_by_fields}update_group_by_button(){let n=Boolean(this.group_by_field),e=n?__("Grouped by <span style='font-weight:600;'>{0}</b>",[this.get_group_by_field_label()]):__("Add Group");this.group_by_button.toggleClass("btn-default",!n).toggleClass("btn-primary-light",n),this.group_by_button.find(".group-by-icon").toggleClass("active",n),this.group_by_button.find(".button-label").html(e),this.group_by_button.attr("title",`Results are Grouped by ${this.get_group_by_field_label()}`)}get_group_by_field_label(){var e;let n=(e=this.group_by_fields[this.group_by_doctype])==null?void 0:e.find(t=>t.fieldname==this.group_by_field);return n!=null&&n.label?__(n.label,null,n.parent):n==null?void 0:n.fieldname}};frappe.provide("frappe.report_utils");frappe.report_utils={make_chart_options:function(n,e,{y_fields:t,x_field:i,chart_type:r,colors:s,height:d}){let h=r.toLowerCase(),u=e.result.filter(x=>Object.keys(x).length),y=b(i),m=t.map(x=>({name:R(x),values:b(x).map(C=>Number(C))}));return e.add_total_row&&(y=y.slice(0,-1),m.forEach(x=>{x.values=x.values.slice(0,-1)})),{data:{labels:y.length?y:null,datasets:m},truncateLegends:1,type:h,height:d||280,colors:s,axisOptions:{shortenYAxisNumbers:1,xAxisMode:"tick",numberFormatter:frappe.utils.format_chart_axis_number}};function b(x){if(Array.isArray(u[0])){let C=n.findIndex(w=>w.fieldname==x);return u.map(w=>w[C])}else return u.map(C=>C[x])}function R(x){var w;let C=n.find(O=>O.fieldname===x);return(w=C==null?void 0:C.label)!=null?w:__(frappe.model.unscrub(x))}},get_field_options_from_report:function(n,e){let t=e.result.filter(m=>Object.keys(m).length),r=(Array.isArray(t[0])?t[0]:n.map(m=>t[0][m.fieldname])).reduce((m,b,R)=>(Number.isFinite(b)&&m.push(R),m),[]);function s(m){return m.map(b=>b.fieldname?{label:b.label,value:b.fieldname}:(b=frappe.report_utils.prepare_field_from_column(b),{label:b.label,value:b.fieldname}))}let d=n.filter((m,b)=>r.includes(b)),h=n.filter((m,b)=>!r.includes(b)),u=s(d),y=s(h);return{numeric_fields:u,non_numeric_fields:y}},prepare_field_from_column:function(n){if(typeof n=="string")if(n.includes(":")){let[e,t,i]=n.split(":"),r;t.includes("/")&&([t,r]=t.split("/")),n={label:e,fieldname:e,fieldtype:t,width:i,options:r}}else n={label:n,fieldname:n,fieldtype:"Data"};return n},get_report_filters:function(n){if(frappe.query_reports[n]){let e=frappe.query_reports[n].filters;return Promise.resolve(e)}return frappe.xcall("frappe.desk.query_report.get_script",{report_name:n}).then(e=>(frappe.dom.eval(e.script||""),frappe.after_ajax(()=>frappe.query_reports[n]&&!frappe.query_reports[n].filters&&e.filters?frappe.query_reports[n].filters=e.filters:frappe.query_reports[n]&&frappe.query_reports[n].filters)))},get_filter_values(n){return n.map(e=>{var t=e.default;return{[e.fieldname]:t}}).reduce((e,t)=>(Object.assign(e,t),e),{})},get_result_of_fn(n,e){return{Minimum:i=>i.reduce((r,s)=>Math.min(r,s),i[0]),Maximum:i=>i.reduce((r,s)=>Math.max(r,s),i[0]),Average:i=>i.reduce((r,s)=>r+s,0)/i.length,Sum:i=>i.reduce((r,s)=>r+s,0)}[n](e)},get_export_dialog(n,e,t){let i=[{label:"File Format",fieldname:"file_format",fieldtype:"Select",options:["Excel","CSV"],default:"Excel",reqd:1},{fieldtype:"Section Break",fieldname:"csv_settings",label:"Settings",collapsible:1,depends_on:"eval:doc.file_format=='CSV'"},{fieldtype:"Data",label:"CSV Delimiter",fieldname:"csv_delimiter",default:",",length:1,depends_on:"eval:doc.file_format=='CSV'"},{fieldtype:"Select",label:"CSV Quoting",fieldname:"csv_quoting",options:[{value:0,label:"Minimal"},{value:1,label:"All"},{value:2,label:"Non-numeric"},{value:3,label:"None"}],default:2,depends_on:"eval:doc.file_format=='CSV'"},{fieldtype:"Data",label:"CSV Decimal Separator",fieldname:"csv_decimal_sep",default:".",length:1,depends_on:"eval:doc.file_format=='CSV' && doc.csv_quoting != 2"},{fieldtype:"Small Text",label:"CSV Preview",fieldname:"csv_preview",read_only:1,depends_on:"eval:doc.file_format=='CSV'"}];e&&i.push({fieldtype:"Section Break",fieldname:"extra_fields",collapsible:0},...e);let r=new frappe.ui.Dialog({title:__("Export Report: {0}",[n],"Export report"),fields:i,primary_action_label:__("Download",null,"Export report"),primary_action:t});function s(d){let h=frappe.get_route()[0]==="query-report",u=h?frappe.query_report:cur_list,y=u.columns.filter(b=>b.hidden!==1),m=[y.map(b=>__(h?b.label:b.name)),...u.data.slice(0,3).map(b=>y.map(R=>b[h?R.fieldname:R.field]))];d.set_value("csv_preview",frappe.report_utils.get_csv_preview(m,d.get_value("csv_quoting"),d.get_value("csv_delimiter"),d.get_value("csv_decimal_sep")))}return r.fields_dict.file_format.df.onchange=()=>s(r),r.fields_dict.csv_quoting.df.onchange=()=>s(r),r.fields_dict.csv_delimiter.df.onchange=()=>{r.get_value("csv_delimiter")||r.set_value("csv_delimiter",","),s(r)},r.fields_dict.csv_decimal_sep.df.onchange=()=>{r.get_value("csv_decimal_sep")||r.set_value("csv_decimal_sep","."),s(r)},r},get_csv_preview(n,e,t,i){e=cint(e);let r={Minimal:0,All:1,NonNumeric:2,None:3};return t.length>1&&frappe.throw(__("Delimiter must be a single character")),i.length>1&&frappe.throw(__("Decimal Separator must be a single character")),(0>e||e>3)&&frappe.throw(__("Quoting must be between 0 and 3")),i!=="."&&e===r.NonNumeric&&frappe.throw(__("Decimal Separator must be '.' when Quoting is set to Non-numeric")),n.map(s=>s.map(d=>{if(d===null)return"";switch(typeof d=="string"&&d.includes('"')&&(d=d.replace(/"/g,'""')),typeof d=="number"&&i!=="."&&(d=d.toString().replace(".",i)),e){case r.Minimal:return typeof d=="string"&&d.includes(t)?`"${d}"`:`${d}`;case r.All:return`"${d}"`;case r.NonNumeric:return isNaN(d)?`"${d}"`:`${d}`;case r.None:return`${d}`}}).join(t)).join(`
`)}};})();
/*! Sortable 1.15.0 - MIT | git://github.com/SortableJS/Sortable.git */
//# sourceMappingURL=report.bundle.47ICM77K.js.map
